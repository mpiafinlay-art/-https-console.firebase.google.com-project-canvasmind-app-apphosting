(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[872],{58781:function(e,t,n){Promise.resolve().then(n.bind(n,44678))},44678:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return nb}});var r=n(57437),a=n(2265),o=n(99376),s=n(53459),l=n(63996),i=n(3011),c=n(5978),d=n(738),u=n(89799);let p=()=>{let e;return e=(0,d.C6)().length?(0,d.Mq)():(0,d.ZF)(u.q),(0,c.ad)(e)},m=(0,i.U)((e,t)=>({elements:[],board:null,selectedElementIds:[],isLoading:!0,error:null,unsubscribeElements:null,loadBoard:async(n,r)=>{let{unsubscribeElements:a}=t();a&&(a(),e({unsubscribeElements:null})),e({isLoading:!0,error:null});try{let t;let a=p(),o=(0,c.JU)(a,"users",r,"canvasBoards",n),s=await (0,c.QT)(o);if(!s.exists())throw Error("El tablero no existe o no tienes permiso para verlo.");let l=s.data(),i={id:s.id,...l,userId:l.userId||l.ownerId||r},d=(0,c.hJ)(a,"users",r,"canvasBoards",n,"canvasElements");try{let n=(0,c.IO)(d,(0,c.Xo)("zIndex","asc"));t=(0,c.cf)(n,t=>{let n=t.docs.map(e=>({id:e.id,...e.data()}));e({elements:n,isLoading:!1})},n=>{console.error("Error en listener de elementos:",n),t&&t();let r=(0,c.cf)(d,t=>{let n=t.docs.map(e=>({id:e.id,...e.data()}));n.sort((e,t)=>{let n=e.zIndex||0,r=t.zIndex||0;return n-r}),e({elements:n,isLoading:!1})},t=>{console.error("Error en listener de elementos (fallback):",t),e({isLoading:!1,error:t.message})});e({unsubscribeElements:r})})}catch(n){console.warn("orderBy fall\xf3, usando sin orden:",n),t=(0,c.cf)(d,t=>{let n=t.docs.map(e=>({id:e.id,...e.data()}));n.sort((e,t)=>{let n=e.zIndex||0,r=t.zIndex||0;return n-r}),e({elements:n,isLoading:!1})},t=>{console.error("Error en listener de elementos:",t),e({isLoading:!1,error:t.message})})}return e({board:i,unsubscribeElements:t,selectedElementIds:[]}),console.log("✅ [boardStore] Tablero cargado exitosamente:",{boardId:n,userId:r,boardName:i.name}),n}catch(t){return console.error("❌ [boardStore] Error al cargar el tablero:",t),e({isLoading:!1,error:t.message,board:null,elements:[]}),null}},cleanup:()=>{let{unsubscribeElements:n}=t();n&&(n(),e({unsubscribeElements:null}))},createBoard:async function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Mi Primer Tablero";e({isLoading:!0});let r={name:n,userId:t,createdAt:new Date,updatedAt:new Date};try{let n=p(),a=await (0,c.ET)((0,c.hJ)(n,"users",t,"canvasBoards"),r);return console.log("Nuevo tablero creado con ID:",a.id),e({isLoading:!1}),a.id}catch(t){return console.error("Error al crear el tablero:",t),e({error:"No se pudo crear el tablero.",isLoading:!1}),""}},addElement:async e=>{let{board:n}=t();if(!n)return;let r=n.userId||n.ownerId;if(!r){console.error("No se pudo obtener userId para a\xf1adir elemento");return}try{let t=p(),a=(0,c.hJ)(t,"users",r,"canvasBoards",n.id,"canvasElements");await (0,c.ET)(a,e)}catch(e){console.error("Error al a\xf1adir el elemento:",e)}},updateElement:async(e,n)=>{let{board:r}=t();if(!r)return;let a=r.userId||r.ownerId;if(!a){console.error("No se pudo obtener userId para actualizar elemento");return}try{let t=p(),o=(0,c.JU)(t,"users",a,"canvasBoards",r.id,"canvasElements",e);await (0,c.r7)(o,n)}catch(e){console.error("Error al actualizar el elemento:",e)}},deleteElement:async e=>{let{board:n}=t();if(!n)return;let r=n.userId||n.ownerId;if(!r){console.error("No se pudo obtener userId para eliminar elemento");return}try{let t=p(),a=(0,c.JU)(t,"users",r,"canvasBoards",n.id,"canvasElements",e);await (0,c.oe)(a)}catch(e){console.error("Error al eliminar el elemento:",e)}},setSelectedElementIds:t=>{e({selectedElementIds:t})}}));var h=n(23340);let g=e=>{let[t,n]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{let t=window.matchMedia(e),r=()=>n(t.matches);return r(),t.addEventListener("change",r),()=>t.removeEventListener("change",r)},[e]),t};var x=n(60062);async function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return new Promise((n,r)=>{let a=new FileReader;a.onload=a=>{var o;let s=new Image;s.onload=()=>{let a=document.createElement("canvas"),o=s.width,l=s.height;if((o>1920||l>1920)&&(o>l?(l=l/o*1920,o=1920):(o=o/l*1920,l=1920)),o>720||l>720){let e=o/l;o>l?l=(o=720)/e:o=(l=720)*e}a.width=o,a.height=l;let i=a.getContext("2d");if(!i){r(Error("No se pudo obtener el contexto del canvas"));return}i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high",i.drawImage(s,0,0,o,l);let c=s=>{a.toBlob(a=>{if(!a){r(Error("Error al comprimir la imagen"));return}let i=a.size/1024;if(i<=t||s<=.1){let r=new File([a],e.name,{type:"image/jpeg",lastModified:Date.now()});i>t&&console.warn("⚠️ Imagen comprimida pero a\xfan excede ".concat(t,"KB: ").concat(i.toFixed(2),"KB")),console.log("✅ Imagen comprimida a 72 DPI efectivo: ".concat((e.size/1024).toFixed(2),"KB → ").concat(i.toFixed(2),"KB (").concat(o,"x").concat(l,"px)")),n(r)}else c(Math.max(.1,s-.1))},"image/jpeg",s)};c(.9)},s.onerror=()=>{r(Error("Error al cargar la imagen"))},(null===(o=a.target)||void 0===o?void 0:o.result)&&(s.src=a.target.result)},a.onerror=()=>{r(Error("Error al leer el archivo"))},a.readAsDataURL(e)})}async function v(e,t,n){if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp","image/svg+xml"].includes(e.type))return{success:!1,url:"",path:"",fileName:"",size:0,type:e.type,error:"Tipo de archivo no permitido. Solo se permiten im\xe1genes (JPEG, PNG, GIF, WebP, SVG)"};if(e.size>10485760)return{success:!1,url:"",path:"",fileName:"",size:e.size,type:e.type,error:"El archivo es demasiado grande. El tama\xf1o m\xe1ximo es 10MB"};if(!n)return{success:!1,url:"",path:"",fileName:"",size:e.size,type:e.type,error:"Firebase Storage no est\xe1 disponible. Verifica tu conexi\xf3n."};try{console.log("\uD83D\uDCE4 uploadFile: Iniciando subida directa a Firebase Storage:",{fileName:e.name,size:e.size,type:e.type,userId:t});let r=e;if(e.type.startsWith("image/")&&!e.type.includes("svg")){console.log("\uD83D\uDCE6 Comprimiendo imagen a m\xe1ximo 200KB y 72 DPI efectivo...");try{let t=(r=await f(e,200)).size/1024;if(t>200){console.error("❌ ERROR: Archivo comprimido excede 200KB: ".concat(t.toFixed(2),"KB"));let n=(r=await f(e,200)).size/1024;if(n>200)return{success:!1,url:"",path:"",fileName:"",size:r.size,type:e.type,error:"No se pudo comprimir la imagen a menos de 200KB. Tama\xf1o final: ".concat(n.toFixed(2),"KB")}}console.log("✅ Imagen comprimida a 72 DPI efectivo: ".concat((e.size/1024).toFixed(2),"KB → ").concat(t.toFixed(2),"KB"))}catch(t){if(console.warn("⚠️ Error al comprimir imagen, subiendo original:",t),e.size>204800)return{success:!1,url:"",path:"",fileName:"",size:e.size,type:e.type,error:"Error al comprimir imagen. El archivo original (".concat((e.size/1024).toFixed(2),"KB) excede el l\xedmite de 200KB.")}}}else if(e.size>204800)return{success:!1,url:"",path:"",fileName:"",size:e.size,type:e.type,error:"El archivo (".concat((e.size/1024).toFixed(2),"KB) excede el l\xedmite m\xe1ximo de 200KB permitido.")};let a=Date.now(),o=Math.random().toString(36).substring(2,15),s=r.name.split(".").pop()||"jpg",l="".concat(a,"_").concat(o,".").concat(s),i="users/".concat(t,"/images/").concat(l),c=(0,x.iH)(n,i),d={contentType:r.type,customMetadata:{originalName:e.name,originalSize:e.size.toString(),compressedSize:r.size.toString(),uploadedBy:t,uploadedAt:new Date().toISOString()}};console.log("\uD83D\uDCE4 uploadFile: Subiendo bytes a Storage...");let u=await (0,x.KV)(c,r,d);console.log("\uD83D\uDCE4 uploadFile: Archivo subido, obteniendo URL de descarga...");let p=await (0,x.Jt)(u.ref);return console.log("✅ uploadFile: Subida exitosa:",{url:p,path:i}),{success:!0,url:p,path:i,fileName:l,size:r.size,type:r.type}}catch(n){console.error("❌ uploadFile: Error al subir:",n);let t="Error al subir el archivo.";return"storage/unauthorized"===n.code?t="No tienes permisos para subir archivos. Verifica que est\xe9s autenticado correctamente.":"storage/quota-exceeded"===n.code?t="Se ha excedido la cuota de almacenamiento.":"storage/unauthenticated"===n.code?t="Debes estar autenticado para subir archivos.":n.message&&(t=n.message),{success:!1,url:"",path:"",fileName:"",size:e.size,type:e.type,error:t}}}var b=n(24457),w=n.n(b),y=n(93448),j=n(12381),N=n(49902),C=n(60895),k=n(56477),E=n(99049),z=n(41936),T=n(3289),D=n(13195),S=n(90759);let I=a.forwardRef((e,t)=>{let{className:n,orientation:a="horizontal",decorative:o=!0,...s}=e;return(0,r.jsx)(S.f,{ref:t,decorative:o,orientation:a,className:(0,y.cn)("shrink-0 bg-border","horizontal"===a?"h-[1px] w-full":"h-full w-[1px]",n),...s})});function P(e){let{zoomIn:t,zoomOut:n,resetZoom:a,scale:o,centerOnElements:s,goToHome:l,selectedElement:i,onBringToFront:c,onSendToBack:d,onMoveBackward:u,isMobile:p}=e,m=(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(j.z,{variant:"ghost",size:"icon",onClick:n,className:"h-8 w-8",children:[(0,r.jsx)(N.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Alejar"})]}),(0,r.jsxs)("button",{onClick:a,className:"flex h-8 w-12 items-center justify-center rounded-sm text-sm font-medium text-muted-foreground transition-colors hover:bg-accent hover:text-accent-foreground",children:[Math.round(100*o),"%"]}),(0,r.jsxs)(j.z,{variant:"ghost",size:"icon",onClick:t,className:"h-8 w-8",children:[(0,r.jsx)(C.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Acercar"})]}),(0,r.jsx)(I,{orientation:"vertical",className:"h-6"}),(0,r.jsxs)(j.z,{variant:"ghost",size:"icon",onClick:s,className:"h-8 w-8",children:[(0,r.jsx)(k.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Centrar en Contenido"})]}),(0,r.jsxs)(j.z,{variant:"ghost",size:"icon",onClick:l,className:"h-8 w-8",children:[(0,r.jsx)(E.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Ir al Inicio"})]}),i&&"frame"!==i.type&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(I,{orientation:"vertical",className:"h-6 mx-1"}),(0,r.jsxs)(j.z,{variant:"ghost",size:"icon",onClick:()=>c(i.id),className:"h-8 w-8",title:"Traer al frente",children:[(0,r.jsx)(z.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Traer al frente"})]}),(0,r.jsxs)(j.z,{variant:"ghost",size:"icon",onClick:()=>u(i.id),className:"h-8 w-8",title:"Enviar hacia atr\xe1s",children:[(0,r.jsx)(T.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Enviar hacia atr\xe1s"})]}),(0,r.jsxs)(j.z,{variant:"ghost",size:"icon",onClick:()=>d(i.id),className:"h-8 w-8",title:"Enviar al fondo",children:[(0,r.jsx)(D.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Enviar al fondo"})]})]})]});return(0,r.jsx)("div",{className:(0,y.cn)("absolute z-[10002] flex items-center gap-1 rounded-lg border bg-background p-1 shadow-md",p?"bottom-4 left-1/2 -translate-x-1/2":"bottom-4 right-4"),children:m})}I.displayName=S.f.displayName;var R=n(43728),M=n(27860),F=n(7880);let B=F.fC,A=F.xz,Z=F.h_,L=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(F.aV,{className:(0,y.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",n),...a,ref:t})});L.displayName=F.aV.displayName;let O=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsxs)(Z,{children:[(0,r.jsx)(L,{}),(0,r.jsx)(F.VY,{ref:t,className:(0,y.cn)("fixed left-[50%] top-[50%] z-[50001] grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",n),...a})]})});O.displayName=F.VY.displayName;let U=e=>{let{className:t,...n}=e;return(0,r.jsx)("div",{className:(0,y.cn)("flex flex-col space-y-2 text-center sm:text-left",t),...n})};U.displayName="AlertDialogHeader";let H=e=>{let{className:t,...n}=e;return(0,r.jsx)("div",{className:(0,y.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...n})};H.displayName="AlertDialogFooter";let _=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(F.Dx,{ref:t,className:(0,y.cn)("text-lg font-semibold",n),...a})});_.displayName=F.Dx.displayName;let K=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(F.dk,{ref:t,className:(0,y.cn)("text-sm text-muted-foreground",n),...a})});K.displayName=F.dk.displayName;let q=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(F.aU,{ref:t,className:(0,y.cn)((0,j.d)(),n),...a})});q.displayName=F.aU.displayName;let W=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(F.$j,{ref:t,className:(0,y.cn)((0,j.d)({variant:"outline"}),"mt-2 sm:mt-0",n),...a})});function V(e){let{isOpen:t,onOpenChange:n,onConfirm:a}=e;return(0,r.jsx)(B,{open:t,onOpenChange:n,children:(0,r.jsxs)(O,{children:[(0,r.jsxs)(U,{children:[(0,r.jsx)(_,{children:"\xbfEst\xe1s seguro?"}),(0,r.jsx)(K,{children:"Esta acci\xf3n no se puede deshacer. Se eliminar\xe1 permanentemente el elemento."})]}),(0,r.jsxs)(H,{children:[(0,r.jsx)(W,{onClick:()=>n(!1),children:"Cancelar"}),(0,r.jsx)(q,{onClick:a,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"S\xed, eliminar"})]})]})})}W.displayName=F.$j.displayName;let G=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,y.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",n),...a})});G.displayName="Card";let J=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,y.cn)("flex flex-col space-y-1.5 p-6",n),...a})});J.displayName="CardHeader",a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,y.cn)("text-2xl font-semibold leading-none tracking-tight",n),...a})}).displayName="CardTitle",a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,y.cn)("text-sm text-muted-foreground",n),...a})}).displayName="CardDescription";let Y=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,y.cn)("p-6 pt-0",n),...a})});Y.displayName="CardContent";let X=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,y.cn)("flex items-center p-6 pt-0",n),...a})});X.displayName="CardFooter";var Q=n(82521),$=n(76848),ee=n(69626),et=n(24926),en=n(78868),er=n(35465),ea=n(99342),eo=n(96888),es=n(25229),el=n(37287),ei=n(25518),ec=n(14787),ed=n(26254),eu=n(40339),ep=n(95490),em=n(44986),eh=n(28119),eg=n(59559),ex=n(78084);let ef=eh.fC,ev=eh.xz;eh.ZA,eh.Uv;let eb=eh.Tr;eh.Ee;let ew=a.forwardRef((e,t)=>{let{className:n,inset:a,children:o,...s}=e;return(0,r.jsxs)(eh.fF,{ref:t,className:(0,y.cn)("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",a&&"pl-8",n),...s,children:[o,(0,r.jsx)($.Z,{className:"ml-auto"})]})});ew.displayName=eh.fF.displayName;let ey=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(eh.tu,{ref:t,className:(0,y.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...a})});ey.displayName=eh.tu.displayName;let ej=a.forwardRef((e,t)=>{let{className:n,sideOffset:a=4,...o}=e;return(0,r.jsx)(eh.Uv,{children:(0,r.jsx)(eh.VY,{ref:t,sideOffset:a,className:(0,y.cn)("z-[50001] min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...o})})});ej.displayName=eh.VY.displayName;let eN=a.forwardRef((e,t)=>{let{className:n,inset:a,...o}=e;return(0,r.jsx)(eh.ck,{ref:t,className:(0,y.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",a&&"pl-8",n),...o})});eN.displayName=eh.ck.displayName,a.forwardRef((e,t)=>{let{className:n,children:a,checked:o,...s}=e;return(0,r.jsxs)(eh.oC,{ref:t,className:(0,y.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),checked:o,...s,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(eh.wU,{children:(0,r.jsx)(eg.Z,{className:"h-4 w-4"})})}),a]})}).displayName=eh.oC.displayName,a.forwardRef((e,t)=>{let{className:n,children:a,...o}=e;return(0,r.jsxs)(eh.Rk,{ref:t,className:(0,y.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),...o,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(eh.wU,{children:(0,r.jsx)(ex.Z,{className:"h-2 w-2 fill-current"})})}),a]})}).displayName=eh.Rk.displayName,a.forwardRef((e,t)=>{let{className:n,inset:a,...o}=e;return(0,r.jsx)(eh.__,{ref:t,className:(0,y.cn)("px-2 py-1.5 text-sm font-semibold",a&&"pl-8",n),...o})}).displayName=eh.__.displayName;let eC=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(eh.Z0,{ref:t,className:(0,y.cn)("-mx-1 my-1 h-px bg-muted",n),...a})});eC.displayName=eh.Z0.displayName;var ek=n(64014);function eE(e){let{isOpen:t,onOpenChange:n,onConfirm:a}=e;return(0,r.jsx)(B,{open:t,onOpenChange:n,children:(0,r.jsxs)(O,{onMouseDown:e=>e.stopPropagation(),children:[(0,r.jsxs)(U,{children:[(0,r.jsx)(_,{children:"\xbfEliminar este cuaderno?"}),(0,r.jsx)(K,{children:"Esta acci\xf3n no se puede deshacer. Se eliminar\xe1 permanentemente el cuaderno y todo su contenido."})]}),(0,r.jsxs)(H,{children:[(0,r.jsx)(W,{onClick:()=>n(!1),children:"Cancelar"}),(0,r.jsx)(q,{onClick:a,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"S\xed, eliminar"})]})]})})}function ez(e){let{getContent:t,onSave:n,debounceMs:r=2e3,disabled:o=!1,compareContent:s}=e,[l,i]=(0,a.useState)("idle"),c=(0,a.useRef)(null),d=(0,a.useRef)(null),u=(0,a.useRef)(!1),p=(0,a.useRef)(null),m=(0,a.useCallback)((e,t)=>e===t,[]);(0,a.useEffect)(()=>()=>{c.current&&clearTimeout(c.current),p.current&&clearTimeout(p.current)},[]);let h=(0,a.useCallback)(async()=>{if(!u.current)try{u.current=!0;let e=t(),r=e=>{if("string"==typeof e)return e.replace(/\s+/g," ").replace(/>\s+</g,"><").trim();if("object"==typeof e&&null!==e)try{return JSON.stringify(e)}catch(e){}return e},a=r(e),o=null!==d.current?r(d.current):null;if(null!==o&&a===o){u.current=!1;return}i("saving"),await n(e),d.current=e,i("saved"),p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{i("idle")},2e3)}catch(e){console.error("Error al guardar:",e),i("error"),p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{i("idle")},3e3)}finally{u.current=!1}},[t,n,s||m]),g=(0,a.useCallback)(()=>{c.current&&(clearTimeout(c.current),c.current=null)},[]);return{saveStatus:l,forceSave:(0,a.useCallback)(async()=>{g(),await h()},[g,h]),handleBlur:(0,a.useCallback)(async()=>{g(),await h()},[g,h]),handleChange:(0,a.useCallback)(()=>{o||(g(),c.current=setTimeout(()=>{h()},r))},[o,g,h,r]),cancelPendingSave:g}}var eT=n(24287),eD=n(25309),eS=n(74587);function eI(e){let{status:t,className:n,size:a="sm"}=e,o={sm:"w-3 h-3",md:"w-4 h-4",lg:"w-5 h-5"}[a],l=()=>{switch(t){case"saving":return"Guardando...";case"saved":return"Guardado";case"error":return"Error";default:return""}};return(0,r.jsxs)("div",{className:(0,y.cn)("flex items-center gap-1 text-xs text-muted-foreground",n),title:l(),children:[(()=>{switch(t){case"saving":return(0,r.jsx)(s.Z,{className:(0,y.cn)(o,"animate-spin text-blue-500")});case"saved":return(0,r.jsx)(eT.Z,{className:(0,y.cn)(o,"text-green-500")});case"error":return(0,r.jsx)(eD.Z,{className:(0,y.cn)(o,"text-red-500")});default:return(0,r.jsx)(eS.Z,{className:(0,y.cn)(o,"text-gray-400")})}})(),"idle"!==t&&(0,r.jsx)("span",{className:"text-[10px] leading-none",children:l()})]})}var eP=n(53375),eR=n(74291),eM=n(9270);let eF=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(eM.fC,{ref:t,className:(0,y.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",n),...a,children:(0,r.jsx)(eM.z$,{className:(0,y.cn)("flex items-center justify-center text-current"),children:(0,r.jsx)(eg.Z,{className:"h-4 w-4"})})})});eF.displayName=eM.fC.displayName;var eB=n(75060);function eA(e){let{isOpen:t,onOpenChange:n,totalPages:o,onExport:s}=e,[l,i]=(0,a.useState)([]);(0,a.useEffect)(()=>{t&&i(Array.from({length:o},(e,t)=>t))},[t,o]);let c=e=>{i(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e].sort((e,t)=>e-t))};return(0,r.jsx)(eR.Vq,{open:t,onOpenChange:n,children:(0,r.jsxs)(eR.cZ,{className:"max-w-md",children:[(0,r.jsx)(eR.fK,{children:(0,r.jsx)(eR.$N,{children:"Exportar P\xe1ginas a PDF"})}),(0,r.jsxs)("div",{className:"py-4",children:[(0,r.jsx)("div",{className:"mb-4",children:(0,r.jsx)(j.z,{variant:"outline",size:"sm",onClick:()=>{l.length===o?i([]):i(Array.from({length:o},(e,t)=>t))},className:"w-full",children:l.length===o?"Deseleccionar Todas":"Seleccionar Todas"})}),(0,r.jsx)("div",{className:"max-h-64 overflow-y-auto space-y-2",children:Array.from({length:o},(e,t)=>(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(eF,{id:"page-".concat(t),checked:l.includes(t),onCheckedChange:()=>c(t)}),(0,r.jsxs)(eB._,{htmlFor:"page-".concat(t),className:"flex-1 cursor-pointer",children:["P\xe1gina ",t+1]})]},t))}),(0,r.jsx)("p",{className:"mt-4 text-sm text-muted-foreground",children:0===l.length?"Selecciona al menos una p\xe1gina para exportar":"Se exportar\xe1n ".concat(l.length," p\xe1gina").concat(l.length>1?"s":"")})]}),(0,r.jsxs)(eR.cN,{children:[(0,r.jsx)(j.z,{variant:"outline",onClick:()=>n(!1),children:"Cancelar"}),(0,r.jsx)(j.z,{onClick:()=>{0!==l.length&&(s(l),n(!1))},disabled:0===l.length,children:"Exportar PDF"})]})]})})}n(55392);var eZ=n(36692);function eL(e){let{elementRef:t,isListening:r,liveTranscript:o,finalTranscript:s="",interimTranscript:l="",isSelected:i=!1,enabled:c=!0}=e,d=(0,a.useRef)({lastInsertedText:"",lastFinalText:""});(0,a.useEffect)(()=>{if(!c||!r||!t.current)return;let e=t.current,n=document.activeElement===e;if((n||i&&e.isContentEditable)&&(o||s||l))try{if(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement)(0,eZ.insertDictationTextToInput)(e,o||"",s||"",d.current);else if(e.isContentEditable){if(!n&&i)e.focus(),setTimeout(()=>{if(t.current){(0,eZ.insertDictationTextToContentEditable)(t.current,o||"",s||"",l||"",d.current);let e=new Event("input",{bubbles:!0});t.current.dispatchEvent(e)}},50);else{(0,eZ.insertDictationTextToContentEditable)(e,o||"",s||"",l||"",d.current);let t=new Event("input",{bubbles:!0});e.dispatchEvent(t)}}}catch(e){console.error("Error insertando dictado:",e)}},[r,o,s,l,i,c,t]),(0,a.useEffect)(()=>{if(!r&&t.current&&t.current.isContentEditable){let{finalizeInterimText:e}=n(36692);e(t.current)}if(s&&t.current&&t.current.isContentEditable){let{finalizeInterimText:e}=n(36692);e(t.current)}},[r,s,t]),(0,a.useEffect)(()=>{r||(d.current={lastInsertedText:"",lastFinalText:""})},[r])}let eO=e=>{let{currentPage:t,totalPages:n,onPageChange:a,onAddPage:o}=e;return(0,r.jsxs)("div",{className:"flex items-center justify-center gap-1",children:[(0,r.jsx)(j.z,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>a(t-1),disabled:0===t,children:(0,r.jsx)(Q.Z,{className:"h-4 w-4"})}),(0,r.jsxs)("span",{className:"text-sm font-medium text-muted-foreground",children:[t+1," / ",n]}),(0,r.jsx)(j.z,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>a(t+1),disabled:t>=n-1,children:(0,r.jsx)($.Z,{className:"h-4 w-4"})}),(0,r.jsx)(j.z,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:o,disabled:n>=20,children:(0,r.jsx)(ee.Z,{className:"h-4 w-4"})})]})};var eU=n(51777);let eH=eU.fC,e_=eU.xz,eK=a.forwardRef((e,t)=>{let{className:n,align:a="center",sideOffset:o=4,...s}=e;return(0,r.jsx)(eU.h_,{children:(0,r.jsx)(eU.VY,{ref:t,align:a,sideOffset:o,className:(0,y.cn)("z-[60000] w-auto rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...s})})});eK.displayName=eU.VY.displayName;var eq=n(77269),eW=n(81022),eV=n(25567);let eG=["#FF6900","#FCB900","#7BDCB5","#00D084","#8ED1FC","#0693E3","#ABB8C3","#EB144C","#F78DA7","#9900EF"],eJ={yellow:"#fffb8b",pink:"#ffc2d4",blue:"#bce8f1",green:"#d4edda",orange:"#ffeeba",purple:"#e9d5ff",white:"#ffffff"};var eY=n(40279),eX=n(17900),eQ=n(80659),e$=n(45736),e0=n(82762);let e1=[{name:"white",label:"Blanco",value:"#ffffff"},{name:"yellow",label:"Amarillo",value:"#fffb8b"},{name:"pink",label:"Rosa",value:"#ffc2d4"},{name:"blue",label:"Azul",value:"#bce8f1"},{name:"green",label:"Verde",value:"#d4edda"},{name:"orange",label:"Naranja",value:"#ffeeba"},{name:"purple",label:"Morado",value:"#e9d5ff"}];var e2=n(33145),e4=n(93529),e3=n(16859);function e5(e){let{tag:t,isEditing:n,onSave:o,onCancel:s}=e,[l,i]=(0,a.useState)(t),c=(0,a.useRef)(null);return((0,a.useEffect)(()=>{i(t),n&&c.current&&(c.current.focus(),c.current.select())},[t,n]),n)?(0,r.jsx)("div",{className:"absolute -top-10 left-0 z-30",onMouseDown:e=>e.stopPropagation(),children:(0,r.jsx)(eY.I,{ref:c,id:"floating-tag-input",name:"floating-tag-input",type:"text",value:l,onChange:e=>i(e.target.value),onKeyDown:e=>{"Enter"===e.key?o(l):"Escape"===e.key&&s()},onBlur:()=>{o(l)},className:"h-8 w-48 bg-black text-white border-primary placeholder:text-gray-400",placeholder:"A\xf1adir etiqueta..."})}):t?(0,r.jsx)("div",{className:"absolute -top-8 left-0 z-20 bg-black text-white text-xs rounded-md px-2 py-1 cursor-default pointer-events-none",children:(0,r.jsx)("p",{className:"break-words leading-tight",children:t})}):null}var e8=n(76618),e7=n.n(e8),e6=n(5820),e9=n(59022);let te=[{name:"white",label:"Blanco",value:"#ffffff"},{name:"yellow",label:"Amarillo",value:"#fffb8b"},{name:"pink",label:"Rosa",value:"#ffc2d4"},{name:"blue",label:"Azul",value:"#bce8f1"},{name:"green",label:"Verde",value:"#d4edda"},{name:"orange",label:"Naranja",value:"#ffeeba"},{name:"purple",label:"Morado",value:"#e9d5ff"}];var tt=n(98012),tn=n(47677),tr=n(23818),ta=n(13147);function to(e){return"object"==typeof e&&null!==e&&("text"in e||"content"in e)}var ts=n(46087),tl=n(20271);let ti=tl.fC,tc=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(tl.aV,{ref:t,className:(0,y.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",n),...a})});tc.displayName=tl.aV.displayName;let td=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(tl.xz,{ref:t,className:(0,y.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",n),...a})});td.displayName=tl.xz.displayName;let tu=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(tl.VY,{ref:t,className:(0,y.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",n),...a})});tu.displayName=tl.VY.displayName;var tp=n(13134);let tm=tp.fC,th=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(tp.ck,{ref:t,className:(0,y.cn)("border-b",n),...a})});th.displayName="AccordionItem";let tg=a.forwardRef((e,t)=>{let{className:n,children:a,...o}=e;return(0,r.jsx)(tp.h4,{className:"flex",children:(0,r.jsxs)(tp.xz,{ref:t,className:(0,y.cn)("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",n),...o,children:[a,(0,r.jsx)(T.Z,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})})});tg.displayName=tp.xz.displayName;let tx=a.forwardRef((e,t)=>{let{className:n,children:a,...o}=e;return(0,r.jsx)(tp.VY,{ref:t,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...o,children:(0,r.jsx)("div",{className:(0,y.cn)("pb-4 pt-0",n),children:a})})});function tf(e){let{value:t,onChange:n,isListening:o,liveTranscript:s,finalTranscript:l,interimTranscript:i}=e,[c,d]=(0,a.useState)(!1),u=(0,a.useRef)(null);return((0,a.useEffect)(()=>{if(c&&u.current){u.current.focus();let e=u.current.value.length;u.current.setSelectionRange(e,e)}},[c]),eL({elementRef:u,isListening:o&&c||!1,liveTranscript:s||"",finalTranscript:l||"",interimTranscript:i||"",isSelected:c,enabled:c}),c)?(0,r.jsx)("input",{ref:u,type:"text",value:t,onChange:e=>n(e.target.value),onBlur:()=>d(!1),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),d(!1))},className:"flex-1 bg-transparent border-none outline-none font-medium text-sm",onClick:e=>e.stopPropagation(),onFocus:e=>{let t=e.target.value.length;e.target.setSelectionRange(t,t)}}):(0,r.jsx)("span",{onClick:e=>{e.stopPropagation(),d(!0)},className:"cursor-text text-sm",children:t||"Nuevo Item"})}function tv(e){let{value:t,onChange:n,isListening:o,liveTranscript:s,finalTranscript:l,interimTranscript:i,isSelected:c}=e,d=(0,a.useRef)(null),{handleBlur:u,handleChange:p}=ez({getContent:()=>{var e;return((null===(e=d.current)||void 0===e?void 0:e.innerHTML)||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()},onSave:async e=>{e!==(t||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()&&await n(e)},debounceMs:500,compareContent:(e,t)=>(e||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()===(t||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()});return(0,a.useEffect)(()=>{if(d.current&&t!==d.current.innerHTML){if(document.activeElement===d.current)return;let n=window.getSelection(),r=null;if(n&&n.rangeCount>0&&(r=n.getRangeAt(0).cloneRange()),d.current.innerHTML=t||"",r&&d.current.firstChild)try{let t=d.current.firstChild;if(t.nodeType===Node.TEXT_NODE){var e;let a=(null===(e=t.textContent)||void 0===e?void 0:e.length)||0,o=Math.min(r.startOffset,a),s=document.createRange();s.setStart(t,o),s.collapse(!0),null==n||n.removeAllRanges(),null==n||n.addRange(s)}}catch(e){}}},[t]),eL({elementRef:d,isListening:o||!1,liveTranscript:s||"",finalTranscript:l||"",interimTranscript:i||"",isSelected:c||!1,enabled:!0}),(0,r.jsx)("div",{ref:d,contentEditable:!0,onBlur:u,onInput:p,className:"min-h-[50px] p-2 border border-slate-200 rounded focus:outline-none focus:ring-2 focus:ring-primary/20 text-sm",dangerouslySetInnerHTML:{__html:t||""}})}tx.displayName=tp.VY.displayName;var tb=n(50471);let tw=e=>{let{currentPage:t,totalPages:n,onPageChange:a,onAddPage:o}=e;return(0,r.jsxs)("div",{className:"flex items-center justify-center gap-1",children:[(0,r.jsx)(j.z,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>a(t-1),disabled:0===t,children:(0,r.jsx)(Q.Z,{className:"h-4 w-4"})}),(0,r.jsxs)("span",{className:"text-sm font-medium text-muted-foreground",children:[t+1," / ",n]}),(0,r.jsx)(j.z,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>a(t+1),disabled:t>=n-1,children:(0,r.jsx)($.Z,{className:"h-4 w-4"})}),(0,r.jsx)(j.z,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:o,disabled:n>=20,children:(0,r.jsx)(ee.Z,{className:"h-4 w-4"})})]})};var ty=n(77101),tj=n(65265),tN=n(48678);let tC=[5,10,15,20,30,40,60],tk=[{name:"yellow",value:"#fffb8b",label:"Amarillo"},{name:"green",value:"#d4edda",label:"Verde"},{name:"blue",value:"#bce8f1",label:"Azul"},{name:"cyan",value:"#cae3e1",label:"Calipso"},{name:"orange",value:"#ffeeba",label:"Naranjo"},{name:"purple",value:"#e9d5ff",label:"Morado"}],tE={notepad:function(e){var t,n,o;let{id:s,content:l,properties:i,onUpdate:c,deleteElement:d,isPreview:u=!1,onFormatToggle:p,isListening:m,liveTranscript:g,finalTranscript:x,interimTranscript:f,isSelected:v,minimized:b,onChangeNotepadFormat:N,onEditElement:C}=e,k=l||{},E=(0,a.useRef)(null),z=(0,a.useRef)(null),{toast:T}=(0,h.pm)(),[D,S]=(0,a.useState)(!1),[I,P]=(0,a.useState)(!1),[M,F]=(0,a.useState)(!1),[B,A]=(0,a.useState)(!1),[Z,L]=(0,a.useState)(!1),O=null!==(o=k.currentPage)&&void 0!==o?o:0,{saveStatus:U,handleBlur:H,handleChange:_,forceSave:K}=ez({getContent:()=>u||!z.current?"":z.current.innerHTML.replace(/\s+/g," ").replace(/>\s+</g,"><").trim(),onSave:async e=>{if(u||!z.current)return;let t=k.pages||[""];if(e!==(t[O]||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()){let n=[...t];n[O]=e,await c(s,{content:{...k,pages:n}})}},debounceMs:2e3,disabled:u,compareContent:(e,t)=>{let n=((k.pages||[""])[O]||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim(),r=(e||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim();return r===(t||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()&&r===n}}),q=(0,a.useCallback)(async()=>{await K()},[K]);(0,a.useEffect)(()=>{if(z.current&&document.activeElement!==z.current){var e,t;let n=null!==(t=null===(e=k.pages)||void 0===e?void 0:e[O])&&void 0!==t?t:"",r="<div><br></div>"===n||"<div></div>"===n||""===n.trim()?"":n;document.activeElement!==z.current&&z.current.innerHTML!==r&&(z.current.innerHTML=r)}},[k.pages,O]),eL({elementRef:z,isListening:m||!1,liveTranscript:g||"",finalTranscript:x||"",interimTranscript:f||"",isSelected:v||!1,enabled:!0});let W=(0,a.useCallback)(()=>{u||C(s)},[u,C,s]),{handleBlur:V}=ez({getContent:()=>{var e;return(null===(e=E.current)||void 0===e?void 0:e.innerText)||""},onSave:async e=>{!u&&E.current&&k.title!==e&&c(s,{content:{...k,title:e}})},debounceMs:1e3,disabled:u}),J=(0,a.useCallback)(async()=>{!u&&E.current&&await V()},[u,V]),Q=(0,a.useCallback)(e=>{e.preventDefault();let t=e.clipboardData.getData("text/plain");t&&document.execCommand("insertText",!1,t)},[]),$=(0,a.useCallback)(e=>{var t;!u&&e>=0&&e<((null===(t=k.pages)||void 0===t?void 0:t.length)||0)&&(q(),c(s,{content:{...k,currentPage:e}}))},[u,k,c,s,q]),ee=(0,a.useCallback)(()=>{var e;if(!u&&20>((null===(e=k.pages)||void 0===e?void 0:e.length)||0)){q();let e=[...k.pages||[],""];c(s,{content:{...k,pages:e,currentPage:e.length-1}})}},[u,k,c,s,q]),eh=(0,a.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),u||(q(),setTimeout(()=>{let e=!!b,t=(null==i?void 0:i.size)||{width:794,height:1021},n={width:"number"==typeof t.width?t.width:parseFloat(String(t.width))||794,height:"number"==typeof t.height?t.height:parseFloat(String(t.height))||1021};if(e){let{originalSize:e,...t}=i||{};c(s,{minimized:!1,properties:{...t,size:e||{width:794,height:1021}}})}else{let e="number"==typeof t.width?t.width:parseFloat(String(t.width))||794;c(s,{minimized:!0,properties:{...i,size:{width:e,height:48},originalSize:n}})}},100))},[u,b,i,c,s,q]),eg=(0,a.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),u||(q(),c(s,{hidden:!0}))},[u,q,c,s]),ex=(0,a.useCallback)(async e=>{if(e.stopPropagation(),e.preventDefault(),!u)try{let e=document.querySelector('[data-element-id="'.concat(s,'"]'));if(!e){T({variant:"destructive",title:"Error",description:"No se pudo encontrar el elemento para exportar."});return}S(!0),T({title:"Exportando...",description:"Generando imagen PNG de alta resoluci\xf3n del cuaderno."}),(await w()(e,{backgroundColor:"#ffffff",scale:3,useCORS:!0,logging:!1,allowTaint:!1,windowWidth:e.scrollWidth,windowHeight:e.scrollHeight})).toBlob(e=>{if(!e){T({variant:"destructive",title:"Error",description:"No se pudo generar la imagen."}),S(!1);return}let t=URL.createObjectURL(e),n=document.createElement("a");n.href=t;let r=k.title||"cuaderno";n.download="".concat(r,"_").concat(Date.now(),".png"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t),T({title:"Exportado",description:"El cuaderno se ha exportado como PNG de alta resoluci\xf3n."}),S(!1)},"image/png",1)}catch(e){console.error("Error al exportar cuaderno:",e),T({variant:"destructive",title:"Error",description:e.message||"No se pudo exportar el cuaderno."}),S(!1)}},[T,s,u,k.title]),eb=(0,a.useCallback)(async e=>{if(!u)try{P(!0),T({title:"Exportando...",description:"Generando PDF con ".concat(e.length," p\xe1gina").concat(e.length>1?"s":"",".")});let t=document.querySelector('[data-element-id="'.concat(s,'"]'));if(!t){T({variant:"destructive",title:"Error",description:"No se pudo encontrar el elemento para exportar."}),P(!1);return}let n=new eP.ZP({orientation:"portrait",unit:"px",format:[794,1021]}),r=k.currentPage||0;for(let a=0;a<e.length;a++){let o=e[a];c&&o!==r&&(c(s,{content:{...k,currentPage:o}}),await new Promise(e=>setTimeout(e,100)));let l=await w()(t,{backgroundColor:"#ffffff",scale:2,useCORS:!0,logging:!1,allowTaint:!1,windowWidth:t.scrollWidth,windowHeight:t.scrollHeight}),i=l.toDataURL("image/png");a>0&&n.addPage();let d=n.internal.pageSize.getWidth(),u=n.internal.pageSize.getHeight(),p=l.width,m=l.height,h=Math.min(d/p,u/m),g=p*h,x=m*h,f=(d-g)/2,v=(u-x)/2;n.addImage(i,"PNG",f,v,g,x)}c&&r!==k.currentPage&&c(s,{content:{...k,currentPage:r}});let a=k.title||"cuaderno";n.save("".concat(a,"_").concat(Date.now(),".pdf")),T({title:"Exportado",description:"PDF exportado con ".concat(e.length," p\xe1gina").concat(e.length>1?"s":"",".")}),P(!1)}catch(e){console.error("Error al exportar cuaderno a PDF:",e),T({variant:"destructive",title:"Error",description:e.message||"No se pudo exportar el cuaderno a PDF."}),P(!1)}},[T,s,u,k,c]);(0,a.useEffect)(()=>{let e=E.current;e&&e.innerText!==(k.title||"")&&(e.innerText=k.title||"")},[k.title]);let ew=(0,a.useCallback)((e,t,n)=>{e.preventDefault(),e.stopPropagation(),z.current&&(z.current.focus(),document.execCommand(t,!1,null!=n?n:void 0))},[]),ey=(0,a.useCallback)(e=>ew(e,"removeFormat"),[ew]),eC=(0,a.useCallback)(e=>ew(e,"insertHTML",'<span style="color: #a0a1a6;">-- '.concat((0,ek.WU)(new Date,"dd/MM/yy")," </span>")),[ew]),eT=(0,a.useCallback)(e=>{if(e.preventDefault(),e.stopPropagation(),z.current){z.current.focus();let e=document.createRange();e.selectNodeContents(z.current);let t=window.getSelection();t&&(t.removeAllRanges(),t.addRange(e))}},[]),eD=(0,a.useCallback)(()=>{d(s),L(!1)},[d,s]),eS="object"==typeof i&&null!==i?i:{},eR="10x15"===((null==eS?void 0:eS.format)||"letter");if(b)return(0,r.jsx)(G,{className:"notepad-card w-full h-full flex items-center shadow-lg rounded-lg bg-card border-2 border-primary/50 group","data-element-id":s,children:(0,r.jsxs)("div",{className:"p-2 flex flex-row items-center gap-1 w-full cursor-grab active:cursor-grabbing drag-handle",children:[(0,r.jsx)("div",{className:"p-1",children:(0,r.jsx)(et.Z,{className:"size-5 text-muted-foreground"})}),(0,r.jsx)("p",{className:"font-headline text-sm font-semibold truncate flex-grow",children:k.title||"Sin t\xedtulo"}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:"Maximizar",onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),eh(e)},children:(0,r.jsx)(en.Z,{className:"size-4"})})]})});let eM="oyDN2LIr8z7VyYA5727F"===s||"FdQ656GJ94TePuHpotbY"===s||"Iz0UWQ5gQwXlkX1kGBf1"===s||"kRfKpBDg946Y99668Tih"===s?"#f8f0ad":"#ffffff",eF=(0,a.useCallback)(e=>{if(e.target.closest(".drag-handle"))return;let t=(null==eS?void 0:eS.zIndex)||1;c(s,{properties:{...eS,zIndex:9999}}),setTimeout(()=>{v||c(s,{properties:{...eS,zIndex:t}})},2e3)},[s,eS,c,v]);return(0,r.jsxs)(G,{"data-element-id":s,className:"notepad-card w-full h-full flex flex-col shadow-lg rounded-lg group",style:{backgroundColor:eM},onClick:eF,children:[(0,r.jsxs)("div",{className:"p-2 border-b flex flex-row items-center gap-1 cursor-grab active:cursor-grabbing drag-handle",children:[(0,r.jsx)("div",{className:"p-1",children:(0,r.jsx)(et.Z,{className:"size-5 text-muted-foreground"})}),(0,r.jsx)("div",{ref:E,contentEditable:!u,spellCheck:"true",suppressContentEditableWarning:!0,onFocus:W,onBlur:J,className:"bg-transparent flex-grow outline-none cursor-text font-headline text-sm font-semibold p-1","data-placeholder":"T\xedtulo",onMouseDown:e=>e.stopPropagation()}),!u&&(0,r.jsxs)("div",{onMouseDown:e=>e.stopPropagation(),className:"flex items-center",children:[(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:"Guardar",onClick:q,children:(0,r.jsx)(er.Z,{className:"size-4"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:"Info",onClick:()=>A(!B),children:(0,r.jsx)(ea.Z,{className:"size-4"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:"Seleccionar Todo",onClick:eT,children:(0,r.jsx)(eo.Z,{className:"size-4"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:"Limpiar Formato",onClick:ey,children:(0,r.jsx)(es.Z,{className:"size-4"})}),p&&(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:"Herramientas de Formato",onClick:p,children:(0,r.jsx)(el.Z,{className:"size-4"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:"Insertar Fecha",onClick:eC,children:(0,r.jsx)(ei.Z,{className:"size-4"})}),(0,r.jsxs)(ef,{modal:!1,children:[(0,r.jsx)(ev,{asChild:!0,children:(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",children:(0,r.jsx)(ec.Z,{className:"size-4"})})}),(0,r.jsxs)(ej,{children:[(0,r.jsxs)(eN,{onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),ex(e)},disabled:D,children:[(0,r.jsx)(ed.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:D?"Exportando...":"Exportar a PNG: alta resoluci\xf3n"})]}),(0,r.jsxs)(eN,{onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),F(!0)},disabled:I,children:[(0,r.jsx)(ed.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:I?"Exportando PDF...":"Exportar p\xe1ginas a PDF"})]}),N&&(0,r.jsxs)(eN,{onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),N(s)},children:[(0,r.jsx)(eu.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Cambiar formato..."})]})]})]}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:b?"Maximizar":"Minimizar",onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),eh(e)},children:b?(0,r.jsx)(en.Z,{className:"size-4"}):(0,r.jsx)(ep.Z,{className:"size-4"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7 text-destructive hover:text-destructive",title:"Eliminar Cuaderno",onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),L(!0)},children:(0,r.jsx)(R.Z,{className:"size-4"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:"Cerrar",onMouseDown:eg,children:(0,r.jsx)(em.Z,{className:"size-4"})})]})]}),!b&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Y,{className:(0,y.cn)("p-0 flex-grow relative font-body","overflow-y-auto"),style:{backgroundColor:"rzBhqCTd8wwZmD8JCNEk"===s?"#fafad7":eM},children:(0,r.jsxs)("div",{className:(0,y.cn)("notepad-content-container",eR&&"small-format",("oyDN2LIr8z7VyYA5727F"===s||"FdQ656GJ94TePuHpotbY"===s||"Iz0UWQ5gQwXlk1kGBf1"===s||"kRfKpBDg946Y99668Tih"===s||"EktERYKT8kyk3JWymwbu"===s||"rzBhqCTd8wwZmD8JCNEk"===s)&&"small-typography"),"data-element-id":s,children:[(0,r.jsx)("div",{className:(0,y.cn)("notepad-lines-background",eR&&"small-format",("oyDN2LIr8z7VyYA5727F"===s||"FdQ656GJ94TePuHpotbY"===s||"Iz0UWQ5gQwXlk1kGBf1"===s||"kRfKpBDg946Y99668Tih"===s||"EktERYKT8kyk3JWymwbu"===s||"rzBhqCTd8wwZmD8JCNEk"===s)&&"small-typography"),"data-element-id":s}),!u&&(0,r.jsx)("div",{className:"absolute w-1 h-1 bg-red-500 rounded-full",style:{left:eR?"18px":"38px",top:eR?"calc(100% - 30px)":"calc(100% - 48px)"},title:"Indicador de fin de p\xe1gina visible"}),B&&(0,r.jsxs)("div",{className:"absolute inset-0 bg-white/95 z-20 p-4 text-xs overflow-y-auto",onClick:()=>A(!1),children:[(0,r.jsx)("h3",{className:"font-bold mb-2 text-base",children:"Comandos de Dictado por Voz"}),(0,r.jsx)("p",{children:"WIP"}),(0,r.jsx)("p",{className:"text-center mt-4 text-gray-500",children:"Haz clic en cualquier lugar para cerrar"})]}),(0,r.jsx)("div",{ref:z,contentEditable:!u,spellCheck:"true",suppressContentEditableWarning:!0,onPaste:Q,onFocus:()=>C(s),onInput:_,onBlur:H,className:(0,y.cn)("notepad-content-editable",eR&&"small-format",("oyDN2LIr8z7VyYA5727F"===s||"FdQ656GJ94TePuHpotbY"===s||"Iz0UWQ5gQwXlk1kGBf1"===s||"kRfKpBDg946Y99668Tih"===s||"EktERYKT8kyk3JWymwbu"===s||"rzBhqCTd8wwZmD8JCNEk"===s)&&"small-typography","kRfKpBDg946Y99668Tih"===s&&"infinite-scroll",!eR&&"p-[32px_24px_16px_0px]",eR&&"p-[16px_12px_8px_0px]"),"data-element-id":s}),!u&&(0,r.jsx)("div",{className:"absolute top-2 right-2 z-20",children:(0,r.jsx)(eI,{status:U,size:"sm"})})]})}),!u&&(0,r.jsx)(X,{className:"p-2 border-t justify-center",onMouseDown:e=>e.stopPropagation(),children:(0,r.jsx)(eO,{currentPage:O,totalPages:(null===(t=k.pages)||void 0===t?void 0:t.length)||1,onPageChange:$,onAddPage:ee})})]}),(0,r.jsx)(eE,{isOpen:Z,onOpenChange:L,onConfirm:eD}),(0,r.jsx)(eA,{isOpen:M,onOpenChange:F,totalPages:(null===(n=k.pages)||void 0===n?void 0:n.length)||1,onExport:eb})]})},"notepad-simple":function(e){let{id:t,content:n,onUpdate:o,onEditElement:s,deleteElement:l,isListening:i,liveTranscript:c,finalTranscript:d,interimTranscript:u,isSelected:p}=e,m=(0,a.useRef)(null),h=(0,a.useRef)(null),g=(0,a.useRef)(null),[x,f]=(0,a.useState)(""),v="string"==typeof n?n:to(n)&&(n.text||n.content)||"",b=to(n)&&n.title||"Nuevo Notepad",{saveStatus:w,handleBlur:N,handleChange:C}=ez({getContent:()=>{var e;return(null===(e=m.current)||void 0===e?void 0:e.value)||""},onSave:async e=>{e!==v&&o(t,{content:{...to(n)?n:{},text:e,content:e}})},debounceMs:2e3,compareContent:(e,t)=>e===t}),{saveStatus:k,handleBlur:E,handleChange:z}=ez({getContent:()=>{var e;return(null===(e=h.current)||void 0===e?void 0:e.value)||b},onSave:async e=>{e!==b&&o(t,{content:{...to(n)?n:{},title:e}})},debounceMs:1e3,compareContent:(e,t)=>e===t}),T=async()=>{await N()},D=(0,a.useRef)({lastInsertedText:"",lastFinalText:""});(0,a.useEffect)(()=>{if(!i||!p){i||(D.current={lastInsertedText:"",lastFinalText:""});return}(d||u)&&m.current&&document.activeElement===m.current&&((0,eZ.insertDictationTextToInput)(m.current,c||"",d||"",D.current),C())},[i,c,d,u,p,C]),(0,a.useEffect)(()=>{let e=m.current;if(!e)return;let t=()=>{let{scrollTop:t,scrollHeight:n,clientHeight:r}=e;n-t-r<100&&(e.style.minHeight="".concat(n+500,"px"))};return e.addEventListener("scroll",t),()=>e.removeEventListener("scroll",t)},[]);let S=()=>{if(m.current){let e=(0,ek.WU)(new Date,"dd/MM/yy"),t=m.current.selectionStart||m.current.value.length,n=m.current.value.substring(0,t),r=m.current.value.substring(t);m.current.value=n+e+" "+r,m.current.setSelectionRange(t+e.length+1,t+e.length+1),C(),m.current.focus()}},I=()=>{l&&l(t)};return(0,r.jsxs)("div",{ref:g,className:(0,y.cn)("w-full h-full flex flex-col rounded-lg shadow-lg overflow-hidden drag-handle","cursor-grab active:cursor-grabbing"),style:{backgroundColor:"#ffff00"},onClick:()=>s(t),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 border-b border-gray-300 bg-white flex-shrink-0",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,r.jsx)("div",{className:"drag-handle cursor-grab active:cursor-grabbing flex-shrink-0",children:(0,r.jsx)("div",{className:"grid grid-cols-3 gap-0.5 w-4 h-4",children:Array.from({length:9}).map((e,t)=>(0,r.jsx)("div",{className:"w-1 h-1 bg-gray-700 rounded-full"},t))})}),(0,r.jsx)("input",{ref:h,type:"text",value:b,onChange:e=>{o(t,{content:{...to(n)?n:{},title:e.target.value}}),z()},onBlur:E,className:"text-sm font-semibold text-gray-800 bg-transparent border-none outline-none flex-1 min-w-0 px-2",placeholder:"Nuevo Notepad",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),style:{fontFamily:"inherit"}}),(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)(eI,{status:k,size:"sm"})})]}),(0,r.jsx)("div",{className:"flex items-center gap-2 mx-4 flex-shrink-0",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(tr.Z,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-500 pointer-events-none"}),(0,r.jsx)("input",{type:"text",value:x,onChange:e=>f(e.target.value),placeholder:"Buscar...",className:"pl-8 pr-2 py-1 text-xs border border-gray-300 rounded bg-white text-gray-700 placeholder-gray-400 outline-none focus:ring-1 focus:ring-blue-500",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),style:{width:"120px"}})]})}),(0,r.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",children:[(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-7 w-7 hover:bg-gray-100",onClick:e=>{e.stopPropagation(),S()},title:"Insertar Fecha",children:(0,r.jsx)(ta.Z,{className:"h-4 w-4 text-gray-700"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-7 w-7 hover:bg-red-50 text-red-600 hover:text-red-700",onClick:e=>{e.stopPropagation(),I()},title:"Eliminar",children:(0,r.jsx)(R.Z,{className:"h-4 w-4"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-7 w-7 hover:bg-gray-100",onClick:e=>{e.stopPropagation()},title:"Cerrar",children:(0,r.jsx)(em.Z,{className:"h-4 w-4 text-gray-700"})})]})]}),(0,r.jsxs)("div",{className:"flex-1 relative overflow-hidden",style:{backgroundColor:"#ffff00"},children:[(0,r.jsx)("div",{className:"absolute inset-0 pointer-events-none z-0",style:{backgroundImage:"linear-gradient(#3b82f6 1px, transparent 1px)",backgroundSize:"100% 24px",backgroundPosition:"0 60px"}}),(0,r.jsx)("div",{className:"absolute top-0 bottom-0 pointer-events-none z-0",style:{left:"50px",width:"1px",backgroundColor:"#fca5a5",top:"60px"}}),(0,r.jsx)("textarea",{ref:m,value:v,onChange:e=>{C()},onBlur:T,className:"absolute inset-0 w-full h-full bg-transparent text-sm resize-none outline-none z-10 font-mono",style:{paddingLeft:"70px",paddingTop:"60px",paddingRight:"16px",paddingBottom:"16px",lineHeight:"24px",fontSize:"14px",color:"#1e293b",fontFamily:"monospace",whiteSpace:"pre-wrap",wordWrap:"break-word",minHeight:"100%"},placeholder:"Escribe aqu\xed...",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation()}),(0,r.jsx)("div",{className:"absolute top-2 right-2 z-20",children:(0,r.jsx)(eI,{status:w,size:"sm"})})]})]})},"test-notepad":function(e){var t,n,o;let{id:s,content:l,properties:i,onUpdate:c,deleteElement:d,isPreview:u=!1,onFormatToggle:p,isListening:m,liveTranscript:g,isSelected:x,minimized:f,onChangeNotepadFormat:v,onEditElement:b}=e,N=l||{},C=(0,a.useRef)(null),k=(0,a.useRef)(null),{toast:E}=(0,h.pm)(),[z,T]=(0,a.useState)(!1),[D,S]=(0,a.useState)(!1),[I,P]=(0,a.useState)(!1),[M,F]=(0,a.useState)(!1),[B,A]=(0,a.useState)(!1),Z=null!==(o=N.currentPage)&&void 0!==o?o:0,{saveStatus:L,handleBlur:O,handleChange:U,forceSave:H}=ez({getContent:()=>u||!k.current?"":k.current.innerHTML,onSave:async e=>{if(u||!k.current)return;let t=N.pages||[""];if(e!==(t[Z]||"")){let n=[...t];n[Z]=e,c(s,{content:{...N,pages:n}})}},debounceMs:2e3,disabled:u,compareContent:(e,t)=>e===((N.pages||[""])[Z]||"")}),_=(0,a.useCallback)(async()=>{await H()},[H]);(0,a.useEffect)(()=>{if(k.current&&document.activeElement!==k.current){var e,t;let n=null!==(t=null===(e=N.pages)||void 0===e?void 0:e[Z])&&void 0!==t?t:"<div><br></div>";k.current.innerHTML!==n&&(k.current.innerHTML=n)}},[N.pages,Z]),(0,a.useEffect)(()=>{m&&x&&k.current&&document.activeElement===k.current&&document.execCommand("insertText",!1,g)},[m,g,x]);let K=(0,a.useCallback)(()=>{u||b(s)},[u,b,s]),{handleBlur:q}=ez({getContent:()=>{var e;return(null===(e=C.current)||void 0===e?void 0:e.innerText)||""},onSave:async e=>{!u&&C.current&&N.title!==e&&c(s,{content:{...N,title:e}})},debounceMs:1e3,disabled:u}),W=(0,a.useCallback)(async()=>{!u&&C.current&&await q()},[u,q]),V=(0,a.useCallback)(e=>{e.preventDefault();let t=e.clipboardData.getData("text/plain");t&&document.execCommand("insertText",!1,t)},[]),J=(0,a.useCallback)(e=>{var t;!u&&e>=0&&e<((null===(t=N.pages)||void 0===t?void 0:t.length)||0)&&(_(),c(s,{content:{...N,currentPage:e}}))},[u,N,c,s,_]),Q=(0,a.useCallback)(()=>{var e;if(!u&&20>((null===(e=N.pages)||void 0===e?void 0:e.length)||0)){_();let e=[...N.pages||[],"<div><br></div>"];c(s,{content:{...N,pages:e,currentPage:e.length-1}})}},[u,N,c,s,_]),$=(0,a.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),u||(_(),setTimeout(()=>{let e=!!f,t=(null==i?void 0:i.size)||{width:794,height:1021},n={width:"number"==typeof t.width?t.width:parseFloat(String(t.width))||794,height:"number"==typeof t.height?t.height:parseFloat(String(t.height))||1021};if(e){let{originalSize:e,...t}=i||{};c(s,{minimized:!1,properties:{...t,size:e||{width:794,height:1021}}})}else{let e="number"==typeof t.width?t.width:parseFloat(String(t.width))||794;c(s,{minimized:!0,properties:{...i,size:{width:e,height:48},originalSize:n}})}},100))},[u,f,i,c,s,_]),ee=(0,a.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),u||(_(),c(s,{hidden:!0}))},[u,_,c,s]),eh=(0,a.useCallback)(async e=>{if(e.stopPropagation(),e.preventDefault(),!u)try{let e=document.querySelector('[data-element-id="'.concat(s,'"]'));if(!e){E({variant:"destructive",title:"Error",description:"No se pudo encontrar el elemento para exportar."});return}T(!0),E({title:"Exportando...",description:"Generando imagen PNG de alta resoluci\xf3n del cuaderno."}),(await w()(e,{backgroundColor:"#ffffff",scale:3,useCORS:!0,logging:!1,allowTaint:!1,windowWidth:e.scrollWidth,windowHeight:e.scrollHeight})).toBlob(e=>{if(!e){E({variant:"destructive",title:"Error",description:"No se pudo generar la imagen."}),T(!1);return}let t=URL.createObjectURL(e),n=document.createElement("a");n.href=t;let r=N.title||"cuaderno-test";n.download="".concat(r,"_").concat(Date.now(),".png"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t),E({title:"Exportado",description:"El cuaderno se ha exportado como PNG de alta resoluci\xf3n."}),T(!1)},"image/png",1)}catch(e){console.error("Error al exportar cuaderno:",e),E({variant:"destructive",title:"Error",description:e.message||"No se pudo exportar el cuaderno."}),T(!1)}},[E,s,u,N.title]),eg=(0,a.useCallback)(async e=>{if(!u)try{S(!0),E({title:"Exportando...",description:"Generando PDF con ".concat(e.length," p\xe1gina").concat(e.length>1?"s":"",".")});let t=document.querySelector('[data-element-id="'.concat(s,'"]'));if(!t){E({variant:"destructive",title:"Error",description:"No se pudo encontrar el elemento para exportar."}),S(!1);return}let n=new eP.ZP({orientation:"portrait",unit:"px",format:[794,1021]}),r=N.currentPage||0;for(let a=0;a<e.length;a++){let o=e[a];c&&o!==r&&(c(s,{content:{...N,currentPage:o}}),await new Promise(e=>setTimeout(e,100)));let l=await w()(t,{backgroundColor:"#ffffff",scale:2,useCORS:!0,logging:!1,allowTaint:!1,windowWidth:t.scrollWidth,windowHeight:t.scrollHeight}),i=l.toDataURL("image/png");a>0&&n.addPage();let d=n.internal.pageSize.getWidth(),u=n.internal.pageSize.getHeight(),p=l.width,m=l.height,h=Math.min(d/p,u/m),g=p*h,x=m*h,f=(d-g)/2,v=(u-x)/2;n.addImage(i,"PNG",f,v,g,x)}c&&r!==N.currentPage&&c(s,{content:{...N,currentPage:r}});let a=N.title||"cuaderno-test";n.save("".concat(a,"_").concat(Date.now(),".pdf")),E({title:"Exportado",description:"PDF exportado con ".concat(e.length," p\xe1gina").concat(e.length>1?"s":"",".")}),S(!1)}catch(e){console.error("Error al exportar cuaderno a PDF:",e),E({variant:"destructive",title:"Error",description:e.message||"No se pudo exportar el cuaderno a PDF."}),S(!1)}},[E,s,u,N,c]);(0,a.useEffect)(()=>{let e=C.current;e&&e.innerText!==(N.title||"")&&(e.innerText=N.title||"")},[N.title]);let ex=(0,a.useCallback)((e,t,n)=>{e.preventDefault(),e.stopPropagation(),k.current&&(k.current.focus(),document.execCommand(t,!1,null!=n?n:void 0))},[]),eb=(0,a.useCallback)(e=>ex(e,"removeFormat"),[ex]),ew=(0,a.useCallback)(e=>ex(e,"insertHTML",'<span style="color: #a0a1a6;">-- '.concat((0,ek.WU)(new Date,"dd/MM/yy")," </span>")),[ex]),ey=(0,a.useCallback)(e=>{if(e.preventDefault(),e.stopPropagation(),k.current){k.current.focus();let e=document.createRange();e.selectNodeContents(k.current);let t=window.getSelection();t&&(t.removeAllRanges(),t.addRange(e))}},[]),eC=(0,a.useCallback)(()=>{d(s),A(!1)},[d,s]),eT="object"==typeof i&&null!==i?i:{},eD="10x15"===((null==eT?void 0:eT.format)||"letter");return f?(0,r.jsx)(G,{className:"notepad-card w-full h-full flex items-center shadow-lg rounded-lg bg-card border-2 border-primary/50 group","data-element-id":s,children:(0,r.jsxs)("div",{className:"p-2 flex flex-row items-center gap-1 w-full cursor-grab active:cursor-grabbing drag-handle",children:[(0,r.jsx)("div",{className:"p-1",children:(0,r.jsx)(et.Z,{className:"size-5 text-muted-foreground"})}),(0,r.jsx)("p",{className:"font-headline text-sm font-semibold truncate flex-grow",children:N.title||"Cuaderno Test"}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:"Maximizar",onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),$(e)},children:(0,r.jsx)(en.Z,{className:"size-4"})})]})}):(0,r.jsxs)(G,{"data-element-id":s,className:"notepad-card w-full h-full flex flex-col shadow-lg rounded-lg bg-card group",children:[(0,r.jsxs)("div",{className:"p-2 border-b flex flex-row items-center gap-1 cursor-grab active:cursor-grabbing drag-handle",children:[(0,r.jsx)("div",{className:"p-1",children:(0,r.jsx)(et.Z,{className:"size-5 text-muted-foreground"})}),(0,r.jsx)("div",{ref:C,contentEditable:!u,spellCheck:"true",suppressContentEditableWarning:!0,onFocus:K,onBlur:W,className:"bg-transparent flex-grow outline-none cursor-text font-headline text-sm font-semibold p-1","data-placeholder":"Cuaderno Test",onMouseDown:e=>e.stopPropagation()}),!u&&(0,r.jsxs)("div",{onMouseDown:e=>e.stopPropagation(),className:"flex items-center",children:[(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:"Guardar",onClick:_,children:(0,r.jsx)(er.Z,{className:"size-4"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:"Info",onClick:()=>F(!M),children:(0,r.jsx)(ea.Z,{className:"size-4"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:"Seleccionar Todo",onClick:ey,children:(0,r.jsx)(eo.Z,{className:"size-4"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:"Limpiar Formato",onClick:eb,children:(0,r.jsx)(es.Z,{className:"size-4"})}),p&&(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:"Herramientas de Formato",onClick:p,children:(0,r.jsx)(el.Z,{className:"size-4"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:"Insertar Fecha",onClick:ew,children:(0,r.jsx)(ei.Z,{className:"size-4"})}),(0,r.jsxs)(ef,{modal:!1,children:[(0,r.jsx)(ev,{asChild:!0,children:(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",children:(0,r.jsx)(ec.Z,{className:"size-4"})})}),(0,r.jsxs)(ej,{children:[(0,r.jsxs)(eN,{onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),eh(e)},disabled:z,children:[(0,r.jsx)(ed.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:z?"Exportando...":"Exportar a PNG: alta resoluci\xf3n"})]}),(0,r.jsxs)(eN,{onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),P(!0)},disabled:D,children:[(0,r.jsx)(ed.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:D?"Exportando PDF...":"Exportar p\xe1ginas a PDF"})]}),v&&(0,r.jsxs)(eN,{onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),v(s)},children:[(0,r.jsx)(eu.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Cambiar formato..."})]})]})]}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:f?"Maximizar":"Minimizar",onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),$(e)},children:f?(0,r.jsx)(en.Z,{className:"size-4"}):(0,r.jsx)(ep.Z,{className:"size-4"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7 text-destructive hover:text-destructive",title:"Eliminar Cuaderno",onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),A(!0)},children:(0,r.jsx)(R.Z,{className:"size-4"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"size-7",title:"Cerrar",onMouseDown:ee,children:(0,r.jsx)(em.Z,{className:"size-4"})})]})]}),!f&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Y,{className:"p-0 flex-grow relative bg-card font-body overflow-y-auto",children:(0,r.jsxs)("div",{className:(0,y.cn)("notepad-content-container",eD&&"small-format"),children:[(0,r.jsx)("div",{className:(0,y.cn)("notepad-lines-background",eD&&"small-format")}),!u&&(0,r.jsx)("div",{className:"absolute w-1 h-1 bg-red-500 rounded-full",style:{left:eD?"18px":"38px",top:eD?"calc(100% - 30px)":"calc(100% - 48px)"},title:"Indicador de fin de p\xe1gina visible"}),M&&(0,r.jsxs)("div",{className:"absolute inset-0 bg-white/95 z-20 p-4 text-xs overflow-y-auto",onClick:()=>F(!1),children:[(0,r.jsx)("h3",{className:"font-bold mb-2 text-base",children:"Comandos de Dictado por Voz"}),(0,r.jsx)("p",{children:"WIP"}),(0,r.jsx)("p",{className:"text-center mt-4 text-gray-500",children:"Haz clic en cualquier lugar para cerrar"})]}),(0,r.jsx)("div",{ref:k,contentEditable:!u,spellCheck:"true",suppressContentEditableWarning:!0,onPaste:V,onFocus:()=>b(s),onInput:U,onBlur:O,className:(0,y.cn)("notepad-content-editable",eD&&"small-format",!eD&&"p-[32px_24px_16px_0px]",eD&&"p-[16px_12px_8px_0px]")}),!u&&(0,r.jsx)("div",{className:"absolute top-2 right-2 z-20",children:(0,r.jsx)(eI,{status:L,size:"sm"})})]})}),!u&&(0,r.jsx)(X,{className:"p-2 border-t justify-center",onMouseDown:e=>e.stopPropagation(),children:(0,r.jsx)(tw,{currentPage:Z,totalPages:(null===(t=N.pages)||void 0===t?void 0:t.length)||1,onPageChange:J,onAddPage:Q})})]}),(0,r.jsx)(eE,{isOpen:B,onOpenChange:A,onConfirm:eC}),(0,r.jsx)(eA,{isOpen:I,onOpenChange:P,totalPages:(null===(n=N.pages)||void 0===n?void 0:n.length)||1,onExport:eg})]})},sticky:function(e){let{id:t,content:n,properties:o,isSelected:s,onUpdate:l,onEditElement:i,deleteElement:c,isListening:d,liveTranscript:u,finalTranscript:p,interimTranscript:m}=e,h="object"==typeof o&&null!==o?o:{},g=("string"==typeof h.color?h.color:"yellow")||"yellow",x=eJ[g]||(g.startsWith("#")?g:"#fffb8b"),f=h.rotation||0,v=(0,a.useRef)(null),b="string"==typeof n?n:"",{saveStatus:w,handleBlur:N,handleChange:C}=ez({getContent:()=>{var e;return((null===(e=v.current)||void 0===e?void 0:e.innerHTML)||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()},onSave:async e=>{e!==(b||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()&&await l(t,{content:e})},debounceMs:2e3,compareContent:(e,t)=>(e||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()===(t||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()});(0,a.useEffect)(()=>{v.current&&b!==v.current.innerHTML&&document.activeElement!==v.current&&(v.current.innerHTML=b||"")},[b]),eL({elementRef:v,isListening:d||!1,liveTranscript:u||"",finalTranscript:p||"",interimTranscript:m||"",isSelected:s||!1,enabled:!0});let k=async()=>{await N()};return(0,r.jsxs)(G,{className:(0,y.cn)("w-full h-full flex flex-col relative group overflow-hidden","min-w-[200px] min-h-[150px] max-w-[400px] max-h-[500px]","rounded-lg shadow-md border-none"),style:{backgroundColor:x},onClick:()=>i(t),children:[(0,r.jsxs)("div",{className:"absolute top-2 right-2 flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity z-10",children:[(0,r.jsx)("div",{className:"drag-handle cursor-grab active:cursor-grabbing p-1 hover:bg-black/10 rounded",children:(0,r.jsx)(et.Z,{className:"h-4 w-4 text-gray-700"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-6 w-6 p-1 hover:bg-black/10 rounded",onClick:e=>{if(e.stopPropagation(),v.current){v.current.focus();let e=window.getSelection();if(e&&e.rangeCount>0){let t=e.getRangeAt(0);t.collapse(!1);let n=document.createElement("br");t.insertNode(n),t.setStartAfter(n),t.collapse(!0),e.removeAllRanges(),e.addRange(t)}}},onMouseDown:e=>e.stopPropagation(),children:(0,r.jsx)(ee.Z,{className:"h-4 w-4 text-gray-700"})}),s&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(eH,{children:[(0,r.jsx)(e_,{asChild:!0,children:(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-6 w-6 p-1 hover:bg-black/10 rounded",onClick:e=>e.stopPropagation(),children:(0,r.jsx)(eW.Z,{className:"h-4 w-4 text-gray-700"})})}),(0,r.jsx)(eK,{onClick:e=>e.stopPropagation(),className:"w-auto p-0 border-none",children:(0,r.jsx)(eq.e8,{colors:eG,color:x,onChangeComplete:e=>{l(t,{properties:{...h,color:e.hex}})}})})]}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-6 w-6 p-1 hover:bg-black/10 rounded",onClick:e=>{e.stopPropagation(),l(t,{properties:{...h,rotation:((f||0)+15)%360}})},onMouseDown:e=>e.stopPropagation(),title:"Rotar 15\xb0",children:(0,r.jsx)(eV.Z,{className:"h-4 w-4 text-gray-700"})})]}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-6 w-6 p-1 hover:bg-black/10 rounded",onClick:e=>{e.stopPropagation(),e.preventDefault(),c&&c(t)},onMouseDown:e=>e.stopPropagation(),children:(0,r.jsx)(em.Z,{className:"h-4 w-4 text-gray-700"})})]}),(0,r.jsxs)("div",{className:"relative flex-grow",children:[(0,r.jsx)("div",{ref:v,contentEditable:!0,suppressContentEditableWarning:!0,onInput:()=>{C()},onBlur:k,className:"text-base font-medium break-words outline-none cursor-text p-4 pt-6",style:{color:"#333",minHeight:"calc(100% - 1rem)"}}),(0,r.jsx)("div",{className:"absolute top-2 right-2 z-10",children:(0,r.jsx)(eI,{status:w,size:"sm"})})]})]})},todo:function(e){let{id:t,content:n,properties:o,onUpdate:s,onEditElement:l,isSelected:i,deleteElement:c,onLocateElement:d,onEditComment:u,isListening:p,liveTranscript:m,finalTranscript:g,interimTranscript:x}=e,{toast:f}=(0,h.pm)(),v=(0,a.useRef)(null),[b,N]=(0,a.useState)(""),[C,k]=(0,a.useState)(!1),E="object"==typeof o&&null!==o?o:{},z=E.backgroundColor||"#ffffff",T="object"==typeof n&&null!==n&&"items"in n?n:{title:"Lista de Tareas",items:[]},{title:D,items:S}=T,{saveStatus:I,handleChange:P}=ez({getContent:()=>T,onSave:async e=>{JSON.stringify(T)!==JSON.stringify(e)&&s(t,{content:e})},debounceMs:2e3,compareContent:(e,t)=>JSON.stringify(e)===JSON.stringify(t)}),M=e=>{let n=[...S];n[e]={...n[e],completed:!n[e].completed},s(t,{content:{...T,items:n}}),P()},F=(e,n)=>{let r=[...S];r[e]={...r[e],text:n},s(t,{content:{...T,items:r}}),P()},B=()=>{if(""!==b.trim()){let e=[...S,{id:"item-".concat(Date.now()),text:b,completed:!1}];s(t,{content:{...T,items:e}}),N(""),P()}},A=e=>{let n=S.filter((t,n)=>n!==e);s(t,{content:{...T,items:n}}),P()},Z=e=>{s(t,{properties:{...E,backgroundColor:e}}),k(!1)},L=async()=>{try{let e="*".concat(D||"Lista de Tareas","*\n\n");S.forEach(t=>{t.completed?e+="✅ ".concat(t.text,"\n"):e+="⬜ ".concat(t.text,"\n")}),await navigator.clipboard.writeText(e),f({title:"Lista copiada",description:"La lista se ha copiado al portapapeles."})}catch(e){console.error("Error al copiar:",e),f({variant:"destructive",title:"Error",description:"No se pudo copiar la lista."})}},O=async()=>{try{if(!v.current){f({variant:"destructive",title:"Error",description:"No se pudo capturar el elemento."});return}f({title:"Exportando...",description:"Generando imagen PNG de la lista."}),(await w()(v.current,{scale:2.1,backgroundColor:z,useCORS:!0,logging:!1,allowTaint:!1})).toBlob(e=>{if(!e){f({variant:"destructive",title:"Error",description:"No se pudo generar la imagen."});return}let t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="".concat(D||"lista",".png"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t),f({title:"Exportado",description:"La lista se ha exportado como PNG."})},"image/png")}catch(e){console.error("Error al exportar:",e),f({variant:"destructive",title:"Error",description:e.message||"No se pudo exportar la lista."})}},U=(0,a.useRef)({lastInsertedText:"",lastFinalText:""});return(0,a.useEffect)(()=>{if(!p||!i){p||(U.current={lastInsertedText:"",lastFinalText:""});return}if(!g&&!x)return;let e=document.activeElement;e&&("INPUT"===e.tagName||"TEXTAREA"===e.tagName)&&v.current&&v.current.contains(e)&&(0,eZ.insertDictationTextToInput)(e,m||"",g||"",U.current)},[p,m,g,x,i]),(0,r.jsxs)(G,{ref:v,className:(0,y.cn)("w-full h-full flex flex-col relative group overflow-hidden","min-w-[200px] min-h-[150px]","rounded-lg shadow-md border-none"),style:{backgroundColor:z},onClick:()=>l(t),children:[(0,r.jsx)("div",{className:"absolute top-2 right-2 z-10",children:(0,r.jsx)(eI,{status:I,size:"sm"})}),(0,r.jsx)(J,{className:"p-2 pb-2 border-b border-gray-200/50",children:(0,r.jsxs)("div",{className:"flex items-center justify-between gap-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1 flex-1 min-w-0",children:[(0,r.jsx)("div",{className:"drag-handle cursor-grab active:cursor-grabbing flex-shrink-0",children:(0,r.jsx)(et.Z,{className:"h-3 w-3 text-gray-400"})}),(0,r.jsx)(eY.I,{type:"text",value:D||"",onChange:e=>{s(t,{content:{...T,title:e.target.value}}),P()},className:"text-sm font-semibold border-none shadow-none focus-visible:ring-0 p-1 bg-transparent flex-1 min-w-0",placeholder:"T\xedtulo...",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation()})]}),(0,r.jsxs)("div",{className:"flex items-center gap-0.5 flex-shrink-0",children:[(0,r.jsxs)(eH,{open:C,onOpenChange:k,children:[(0,r.jsx)(e_,{asChild:!0,children:(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:e=>{e.stopPropagation(),k(!0)},title:"Cambiar color de fondo",children:(0,r.jsx)(eX.Z,{className:"h-3 w-3"})})}),(0,r.jsx)(eK,{className:"w-auto p-2",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),children:(0,r.jsx)("div",{className:"grid grid-cols-4 gap-1.5",children:e1.map(e=>(0,r.jsx)("button",{className:(0,y.cn)("w-6 h-6 rounded-full border-2 transition-all hover:scale-110",z===e.value?"border-gray-800 scale-110":"border-gray-300"),style:{backgroundColor:e.value},onClick:t=>{t.stopPropagation(),Z(e.value)},title:e.label},e.name))})})]}),(0,r.jsxs)(ef,{children:[(0,r.jsx)(ev,{asChild:!0,children:(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:e=>e.stopPropagation(),title:"M\xe1s opciones",children:(0,r.jsx)(ec.Z,{className:"h-3 w-3"})})}),(0,r.jsxs)(ej,{align:"end",onClick:e=>e.stopPropagation(),className:"text-sm",children:[(0,r.jsxs)(eN,{onClick:L,className:"text-sm",children:[(0,r.jsx)(eQ.Z,{className:"mr-2 h-3 w-3"}),(0,r.jsx)("span",{children:"Copiar lista como texto"})]}),(0,r.jsxs)(eN,{onClick:O,className:"text-sm",children:[(0,r.jsx)(e$.Z,{className:"mr-2 h-3 w-3"}),(0,r.jsx)("span",{children:"Exportar a PNG: alta resoluci\xf3n"})]}),(0,r.jsx)(eC,{}),(0,r.jsxs)(eN,{onClick:()=>{c&&c(t)},className:"text-sm text-destructive focus:text-destructive",children:[(0,r.jsx)(R.Z,{className:"mr-2 h-3 w-3"}),(0,r.jsx)("span",{children:"Eliminar Lista"})]})]})]})]})]})}),(0,r.jsx)(Y,{className:"flex-grow overflow-y-auto p-2",children:(0,r.jsx)(e0.Z5,{onDragEnd:e=>{if(!e.destination)return;let n=Array.from(S),[r]=n.splice(e.source.index,1);n.splice(e.destination.index,0,r),s(t,{content:{...T,items:n}}),P()},children:(0,r.jsx)(e0.bK,{droppableId:"droppable-".concat(t),children:e=>(0,r.jsxs)("div",{...e.droppableProps,ref:e.innerRef,className:"space-y-0.5",children:[0===S.length?(0,r.jsx)("p",{className:"text-xs text-gray-400 italic py-2 text-center",children:"No hay tareas. Agrega una nueva..."}):S.map((e,t)=>(0,r.jsx)(e0._l,{draggableId:e.id,index:t,children:(n,a)=>(0,r.jsxs)("div",{ref:n.innerRef,...n.draggableProps,className:(0,y.cn)("flex items-center gap-1 p-1 rounded transition-colors group/item",a.isDragging?"bg-gray-100 shadow-md":"hover:bg-gray-50/50",i&&"hover:bg-gray-50"),children:[(0,r.jsx)("div",{...n.dragHandleProps,className:"cursor-grab active:cursor-grabbing p-0.5 opacity-50 hover:opacity-100 flex-shrink-0",children:(0,r.jsx)(et.Z,{className:"h-3 w-3 text-gray-400"})}),(0,r.jsx)(eF,{checked:e.completed,onCheckedChange:()=>M(t),className:"flex-shrink-0 h-3 w-3",onClick:e=>e.stopPropagation()}),(0,r.jsx)("input",{type:"text",value:e.text,onChange:e=>F(t,e.target.value),className:(0,y.cn)("flex-grow text-sm border-none shadow-none focus:outline-none focus:ring-0 p-1 bg-transparent",e.completed?"line-through text-gray-500":"text-gray-900"),placeholder:"Tarea...",onClick:e=>e.stopPropagation()}),i&&(0,r.jsx)(j.z,{variant:"ghost",size:"icon",onClick:e=>{e.stopPropagation(),A(t)},className:"h-5 w-5 opacity-0 group-hover/item:opacity-100 hover:opacity-100 transition-opacity flex-shrink-0",children:(0,r.jsx)(em.Z,{className:"h-2.5 w-2.5 text-gray-400"})})]})},e.id)),e.placeholder]})})})}),(0,r.jsx)(X,{className:"p-2 pt-1.5 border-t border-gray-200/50",children:(0,r.jsxs)("div",{className:"flex items-center gap-1 w-full",children:[(0,r.jsx)("input",{type:"text",value:b,onChange:e=>N(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),B())},placeholder:"Agregar tarea...",className:"flex-grow text-sm border-none shadow-none focus:outline-none focus:ring-0 p-1 bg-transparent",onClick:e=>e.stopPropagation()}),(0,r.jsx)(j.z,{onClick:e=>{e.stopPropagation(),B()},size:"sm",className:"flex-shrink-0 h-6 w-6 p-0",children:(0,r.jsx)(ee.Z,{className:"h-3 w-3"})})]})})]})},image:function(e){let{isSelected:t,properties:n,id:o,onUpdate:s,onEditElement:l,onSelectElement:i,content:c,isListening:d,liveTranscript:u}=e,p=("object"==typeof c&&null!==c&&"url"in c&&"string"==typeof c.url?c:{url:""}).url,m="object"==typeof n&&null!==n?n:{},h=(null==m?void 0:m.rotation)||0,g=(null==m?void 0:m.showFloatingTag)||!1,x=(null==m?void 0:m.floatingTag)||"",f=(null==m?void 0:m.label)||"",v=(0,a.useRef)(null),[b,w]=(0,a.useState)(!1);(0,a.useEffect)(()=>{v.current&&v.current.innerText!==f&&(v.current.innerText=f||"")},[f]),(0,a.useEffect)(()=>{if(b&&v.current){v.current.focus();let e=document.createRange(),t=window.getSelection();e.selectNodeContents(v.current),e.collapse(!1),null==t||t.removeAllRanges(),null==t||t.addRange(e)}},[b]);let{saveStatus:N,handleBlur:C,handleChange:k}=ez({getContent:()=>{var e;return(null===(e=v.current)||void 0===e?void 0:e.innerText)||f},onSave:async e=>{e!==f&&v.current&&s(o,{properties:{...m,label:e}})},debounceMs:2e3,compareContent:(e,t)=>e===t});return(0,a.useEffect)(()=>{d&&t&&b&&v.current&&document.activeElement===v.current&&(document.execCommand("insertText",!1,u||""),k())},[d,u,t,b,k]),(0,r.jsxs)("div",{className:"group/image flex flex-col w-full h-full",onDoubleClick:e=>{e.stopPropagation(),t&&(l(o),w(!0))},onMouseDown:e=>i(o,e.shiftKey||e.ctrlKey||e.metaKey),children:[(0,r.jsxs)("div",{className:"relative w-full flex-grow flex flex-col",children:[(t||g||x)&&(0,r.jsx)(e5,{tag:x||"",isEditing:!!g,onSave:e=>{s(o,{properties:{...m,floatingTag:e,showFloatingTag:!1}})},onCancel:()=>{s(o,{properties:{...m,showFloatingTag:!1}})}}),(0,r.jsx)("div",{onMouseDown:e=>e.stopPropagation(),className:(0,y.cn)("absolute top-1 left-1 z-20 opacity-0 group-hover/image:opacity-100 transition-opacity",t&&"opacity-100"),children:(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:e=>{e.stopPropagation(),l(o),s(o,{properties:{...m,showFloatingTag:!g}})},children:(0,r.jsx)(e4.Z,{className:"h-4 w-4"})})}),(0,r.jsx)("div",{onMouseDown:e=>e.stopPropagation(),className:"absolute bottom-1 left-1 z-20 opacity-0 group-hover/image:opacity-100 transition-opacity",children:(0,r.jsx)(j.z,{variant:"default",size:"icon",className:"h-6 w-6 rounded-full shadow-lg",onClick:e=>{e.stopPropagation(),window.open(p,"_blank","noopener,noreferrer")},title:"Abrir imagen original",children:(0,r.jsx)(e3.Z,{className:"h-3 w-3"})})}),(0,r.jsx)("div",{className:(0,y.cn)("relative flex-grow rounded-lg overflow-hidden drag-handle","cursor-grab active:cursor-grabbing"),style:{transform:"rotate(".concat(h||0,"deg)")},children:(0,r.jsx)("div",{className:"relative w-full h-full bg-card",children:(0,r.jsx)(e2.default,{src:"/api/proxy?url=".concat(encodeURIComponent(p)),alt:f||"Canvas Image",fill:!0,className:"object-cover pointer-events-none"})})})]}),(b||f&&""!==f.trim())&&(0,r.jsx)("div",{className:"w-full pt-2 flex justify-center items-center",onMouseDown:e=>e.stopPropagation(),children:(0,r.jsxs)("div",{className:"relative inline-flex items-center gap-2",children:[(0,r.jsx)("div",{ref:v,contentEditable:b,suppressContentEditableWarning:!0,onBlur:()=>{C(),w(!1)},onInput:k,onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),e.target.blur())},className:(0,y.cn)("text-white text-xs rounded-md px-3 py-1 whitespace-nowrap outline-none max-w-full",b?"ring-1 ring-primary cursor-text":"cursor-pointer"),style:{backgroundColor:"#2eb1ca"}}),b&&(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)(eI,{status:N,size:"sm"})})]})})]})},text:function(e){let{id:t,content:n,properties:o,onUpdate:s,onEditElement:l,isSelected:i,isListening:c,liveTranscript:d,finalTranscript:u,interimTranscript:p}=e,m=(0,a.useRef)(null),[h,g]=(0,a.useState)(!1),x="object"==typeof o&&null!==o?o:{},{fontSize:f,fontWeight:v,textAlign:b,fontStyle:w}=x,j="string"==typeof n?n:"",{saveStatus:N,handleBlur:C,handleChange:k}=ez({getContent:()=>{var e;return((null===(e=m.current)||void 0===e?void 0:e.innerHTML)||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()},onSave:async e=>{e!==(j||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()&&await s(t,{content:e})},debounceMs:2e3,compareContent:(e,t)=>(e||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()===(t||"").replace(/\s+/g," ").replace(/>\s+</g,"><").trim()});(0,a.useEffect)(()=>{m.current&&j!==m.current.innerHTML&&document.activeElement!==m.current&&(m.current.innerHTML=j||"")},[j]),eL({elementRef:m,isListening:c||!1,liveTranscript:d||"",finalTranscript:u||"",interimTranscript:p||"",isSelected:i||!1,enabled:!0});let E=async()=>{g(!1),await C()};return(0,r.jsxs)("div",{className:"relative w-full h-full",children:[(0,r.jsx)(e7(),{innerRef:m,html:j||"",disabled:!h,onChange:e=>{k()},onBlur:E,onDoubleClick:()=>{g(!0),l(t)},className:(0,y.cn)("w-full h-full outline-none break-words",h||i?"cursor-text":"cursor-grab drag-handle active:cursor-grabbing"),style:{fontSize:"".concat(f||24,"px"),fontWeight:v||"normal",textAlign:b||"left",fontStyle:w||"normal",color:x.color||"#000000",backgroundColor:x.backgroundColor||"#ffffff"}}),h&&(0,r.jsx)("div",{className:"absolute top-2 right-2 z-10",children:(0,r.jsx)(eI,{status:N,size:"sm"})})]})},container:function(e){let{id:t,properties:n,isSelected:o,onSelectElement:s,onEditElement:l,content:i,onUpdate:c,deleteElement:d,allElements:u=[],onLocateElement:p,unanchorElement:m}=e,h="object"==typeof n&&null!==n?n:{},g="object"==typeof i&&null!==i&&"elementIds"in i?i:{title:"Nuevo Contenedor",elementIds:[],layout:"single"},x=(null==h?void 0:h.backgroundColor)||"#ffffff",f=g.layout||"single",[v,b]=(0,a.useState)(!1),w=(0,a.useRef)(null),N=(0,a.useRef)(null),C=g.elementIds.map(e=>{let t=u.find(t=>t.id===e);return t?{elementId:e,element:t}:null}).filter(e=>null!==e),{saveStatus:k,handleBlur:E,handleChange:z}=ez({getContent:()=>{var e;return(null===(e=w.current)||void 0===e?void 0:e.value)||g.title||""},onSave:async e=>{e!==g.title&&c(t,{content:{...g,title:e}})},debounceMs:1e3}),T=(0,a.useCallback)(e=>{c(t,{properties:{...h,backgroundColor:e.hex}}),b(!1)},[t,h,c]),D=(0,a.useCallback)(()=>{c(t,{content:{...g,layout:"single"===f?"two-columns":"single"}})},[t,g,f,c]),S=(0,a.useCallback)(()=>{c(t,{hidden:!0})},[t,c]),I=(0,a.useCallback)(e=>{let n=g.elementIds.filter(t=>t!==e);c(t,{content:{...g,elementIds:n}});let r=u.find(e=>e.id===t);if(r&&m){let t="object"==typeof r.properties&&null!==r.properties?r.properties:{},n=t.position||{x:0,y:0},a=t.size||{width:378,height:567},o=u.find(t=>t.id===e);if(o){let t={x:n.x+("number"==typeof a.width?a.width:parseInt(String(a.width)))+20,y:n.y};c(e,{parentId:void 0,hidden:!1,properties:{..."object"==typeof o.properties&&null!==o.properties?o.properties:{},position:t}})}}},[t,g,u,c,m]),P=e=>{if("text"===e.type)return"string"==typeof e.content?e.content.substring(0,30):"Texto";if("sticky"===e.type)return"string"==typeof e.content?e.content.substring(0,30):"Nota";if("notepad"===e.type||"notepad-simple"===e.type){let t=e.content;return(null==t?void 0:t.title)||"Cuaderno"}if("todo"===e.type){let t=e.content;return(null==t?void 0:t.title)||"Lista de Tareas"}return"image"===e.type?"Imagen":e.type.charAt(0).toUpperCase()+e.type.slice(1)},R=e=>{let t="object"==typeof e.properties&&null!==e.properties&&e.properties.size?e.properties.size:{width:e.width||100,height:e.height||100},n=("number"==typeof t.width?t.width:parseInt(String(t.width)))/("number"==typeof t.height?t.height:parseInt(String(t.height))),a=100,o=100;if(n>1?o=100/n:a=100*n,"image"===e.type){let t=e.content;return(0,r.jsx)("div",{className:"relative w-full h-full rounded overflow-hidden bg-gray-100",children:(0,r.jsx)("img",{src:(null==t?void 0:t.url)||"",alt:"Preview",className:"w-full h-full object-cover",style:{width:a,height:o},onError:e=>{e.target.style.display="none"}})})}if("sticky"===e.type){var s;let t=(null===(s=e.properties)||void 0===s?void 0:s.color)||e.color||"yellow",n={yellow:"#fffb8b",pink:"#ffc2d4",blue:"#bce8f1",green:"#d4edda",orange:"#ffeeba",purple:"#e9d5ff"}[t]||(t.startsWith("#")?t:"#fffb8b"),a="string"==typeof e.content?e.content.substring(0,50):"Nota";return(0,r.jsx)("div",{className:"w-full h-full rounded p-2 text-xs overflow-hidden flex items-center justify-center",style:{backgroundColor:n,minHeight:o},children:(0,r.jsx)("p",{className:"line-clamp-3 text-center",children:a})})}if("text"===e.type){let t="string"==typeof e.content?e.content.substring(0,100):"Texto";return(0,r.jsx)("div",{className:"w-full h-full rounded p-2 bg-white border border-gray-200 flex items-center justify-center text-xs text-gray-600",children:(0,r.jsx)("p",{className:"line-clamp-4 text-center",children:t})})}if("notepad"===e.type||"notepad-simple"===e.type||"super-notebook"===e.type){let t=e.content,n=(null==t?void 0:t.title)||"Cuaderno",a=(null==t?void 0:t.content)||(null==t?void 0:t.text)||"";return(0,r.jsxs)("div",{className:"w-full h-full rounded p-2 bg-white border border-gray-200 flex flex-col",children:[(0,r.jsx)("div",{className:"font-semibold text-xs mb-1 truncate",children:n}),(0,r.jsx)("div",{className:"text-xs text-gray-500 line-clamp-2",children:a.substring(0,60)})]})}if("todo"===e.type){let t=e.content,n=(null==t?void 0:t.items)||[],a=n.filter(e=>e.completed).length;return(0,r.jsxs)("div",{className:"w-full h-full rounded p-2 bg-white border border-gray-200 flex flex-col",children:[(0,r.jsx)("div",{className:"font-semibold text-xs mb-1",children:(null==t?void 0:t.title)||"Lista"}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:[a,"/",n.length," completadas"]})]})}return(0,r.jsxs)("div",{className:"bg-gradient-to-br from-gray-100 to-gray-200 rounded flex flex-col items-center justify-center text-xs text-gray-500 p-2",style:{minHeight:o},children:[(0,r.jsx)("div",{className:"text-lg mb-1",children:e.type.charAt(0).toUpperCase()}),(0,r.jsx)("div",{className:"text-center capitalize",children:e.type})]})};return(0,r.jsxs)(G,{id:t,"data-element-type":"container","data-element-id":t,ref:N,className:(0,y.cn)("w-full h-full flex flex-col overflow-hidden","min-w-[200px] min-h-[300px]","rounded-lg shadow-lg border border-gray-200/50",o?"ring-2 ring-blue-500 ring-offset-2":"","hover:shadow-xl transition-shadow"),style:{backgroundColor:"transparent"===x?"#ffffff":x,pointerEvents:"auto"},onClick:e=>{if(!e.target.closest(".drag-handle")){if("K85hC8M5spfsgRITnEQR"===t){let e=(null==h?void 0:h.zIndex)||-1;c(t,{properties:{...h,zIndex:9999}}),l(t),setTimeout(()=>{c(t,{properties:{...h,zIndex:e}})},1e3)}else l(t)}},onMouseDown:e=>{if(!e.target.closest(".drag-handle")){if(e.stopPropagation(),"K85hC8M5spfsgRITnEQR"===t){let n=(null==h?void 0:h.zIndex)||-1;c(t,{properties:{...h,zIndex:9999}}),s(t,e.shiftKey||e.ctrlKey||e.metaKey),setTimeout(()=>{o||c(t,{properties:{...h,zIndex:n}})},2e3)}else s(t,e.shiftKey||e.ctrlKey||e.metaKey)}},onDrop:e=>{e.preventDefault(),e.stopPropagation()},onDragOver:e=>{e.preventDefault(),e.stopPropagation(),e.currentTarget&&(e.currentTarget.style.opacity="0.9")},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),e.currentTarget&&(e.currentTarget.style.opacity="1")},children:[(0,r.jsxs)(J,{className:"p-3 border-b border-gray-200 bg-white flex flex-row items-center justify-between group/header",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,r.jsx)("div",{className:"drag-handle cursor-grab active:cursor-grabbing flex-shrink-0",children:(0,r.jsx)(et.Z,{className:"h-4 w-4 text-gray-400"})}),(0,r.jsx)("input",{ref:w,type:"text",value:g.title||"",onChange:e=>{z(),c(t,{content:{...g,title:e.target.value}})},onBlur:E,className:"flex-1 min-w-0 text-sm font-semibold bg-transparent border-none outline-none focus:outline-none focus:ring-0 p-1",placeholder:"T\xedtulo del contenedor...",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation()})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",children:[(0,r.jsx)(eI,{status:k,size:"sm"}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-7 w-7",title:"single"===f?"Dividir en dos columnas":"Una sola columna",onClick:e=>{e.stopPropagation(),D()},children:(0,r.jsx)(e6.Z,{className:(0,y.cn)("h-4 w-4","two-columns"===f&&"text-blue-600")})}),(0,r.jsxs)(eH,{open:v,onOpenChange:b,children:[(0,r.jsx)(e_,{asChild:!0,children:(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-7 w-7",title:"Cambiar color de fondo",onClick:e=>e.stopPropagation(),children:(0,r.jsx)(eX.Z,{className:"h-4 w-4"})})}),(0,r.jsx)(eK,{className:"w-auto p-0",onClick:e=>e.stopPropagation(),children:(0,r.jsx)(eq.e8,{colors:te.map(e=>e.value),color:x,onChange:T,triangle:"hide"})})]}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-7 w-7 text-gray-400 hover:text-gray-600",title:"Cerrar contenedor",onClick:e=>{e.stopPropagation(),S()},children:(0,r.jsx)(em.Z,{className:"h-4 w-4"})})]})]}),(0,r.jsx)(Y,{className:"flex-1 p-3 overflow-y-auto",style:{minHeight:0},onDrop:e=>{e.preventDefault(),e.stopPropagation(),console.log("\uD83D\uDCE6 Drop en CardContent del contenedor")},onDragOver:e=>{e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="move"},children:0===C.length?(0,r.jsx)("div",{className:"flex items-center justify-center h-full text-sm text-gray-400",children:"Arrastra elementos aqu\xed para guardarlos"}):(0,r.jsx)("div",{className:(0,y.cn)("grid gap-3","two-columns"===f?"grid-cols-2":"grid-cols-1"),children:C.map(e=>{let{elementId:t,element:n}=e;return(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 flex flex-col gap-2 group/card hover:shadow-md transition-shadow",children:[(0,r.jsx)("div",{className:"flex items-center justify-center bg-gray-50 rounded p-2 min-h-[80px]",children:R(n)}),(0,r.jsx)("div",{className:"text-xs font-medium text-gray-700 truncate",children:P(n)}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-6 w-6 self-end opacity-0 group-hover/card:opacity-100 transition-opacity",title:"Soltar elemento del contenedor",onClick:e=>{e.stopPropagation(),I(t)},children:(0,r.jsx)(e9.Z,{className:"h-3 w-3"})})]},t)})})})]})},comment:function(e){let{content:t,properties:n,onEditComment:o,onUpdate:s,onLocateElement:l,id:i,type:c,x:d,y:u,width:p,height:m,rotation:h,zIndex:g,color:x,backgroundColor:f,hidden:v,parentId:b,isSelected:w,onSelectElement:N,isListening:C,liveTranscript:k,finalTranscript:E,interimTranscript:z}=e,[T,D]=(0,a.useState)(!1),S=(0,a.useRef)(null),I="object"==typeof t&&null!==t?t:"string"==typeof t?{text:t}:{};I.text||I.title||I.label;let P=I.label||I.title||"Localizador",{saveStatus:R,handleBlur:M,handleChange:F}=ez({getContent:()=>{var e;return(null===(e=S.current)||void 0===e?void 0:e.value)||P},onSave:async e=>{e!==P&&s(i,{content:{...I,label:e,title:e}})},debounceMs:1e3}),B=()=>{S.current&&M(),D(!1)};return eL({elementRef:S,isListening:C||!1,liveTranscript:k||"",finalTranscript:E||"",interimTranscript:z||"",isSelected:w||!1,enabled:T}),(0,r.jsxs)("div",{onClick:e=>{e.stopPropagation(),T||(w&&l?l(i):N(i,!1))},onDoubleClick:e=>{e.stopPropagation(),D(!0),setTimeout(()=>{var e,t;null===(e=S.current)||void 0===e||e.focus(),null===(t=S.current)||void 0===t||t.select()},0)},className:(0,y.cn)("w-full h-full cursor-move relative group","flex flex-col items-center justify-center gap-1",w&&"ring-2 ring-blue-500 ring-offset-2 rounded-lg"),style:{minWidth:"80px",minHeight:"80px"},children:[(0,r.jsxs)("div",{className:(0,y.cn)("relative flex items-center justify-center","transition-transform hover:scale-110"),children:[(0,r.jsx)("div",{className:"absolute inset-0 rounded-full",style:{backgroundColor:"#b7ddda",backgroundImage:"\n              repeating-linear-gradient(45deg, transparent, transparent 4px, rgba(0,0,0,0.05) 4px, rgba(0,0,0,0.05) 8px),\n              repeating-linear-gradient(-45deg, transparent, transparent 4px, rgba(0,0,0,0.05) 4px, rgba(0,0,0,0.05) 8px)\n            ",backgroundSize:"8px 8px",width:"48px",height:"48px"}}),(0,r.jsx)("div",{className:"w-12 h-12 rounded-full flex items-center justify-center relative z-10",style:{backgroundColor:"#4a5568"},children:(0,r.jsx)(tt.Z,{className:"w-6 h-6 text-white",strokeWidth:2.5,style:{filter:"drop-shadow(0 0 1px rgba(0,0,0,0.3))"}})})]}),T?(0,r.jsxs)("div",{className:"flex items-center gap-1 mt-1",onClick:e=>e.stopPropagation(),children:[(0,r.jsx)(eY.I,{ref:S,type:"text",value:P,onChange:e=>{F(),s(i,{content:{...I,label:e.target.value,title:e.target.value}})},onBlur:B,onKeyDown:e=>{"Enter"===e.key?B():"Escape"===e.key&&D(!1)},className:"h-6 text-xs px-2 w-24",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),autoFocus:!0}),(0,r.jsx)(eI,{status:R,size:"sm"})]}):(0,r.jsx)("div",{className:"mt-1 text-xs font-medium text-gray-700 text-center max-w-[100px] truncate px-1",children:P||"Localizador"}),!T&&(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"absolute top-0 right-0 h-5 w-5 opacity-0 group-hover:opacity-100 transition-opacity z-50",onClick:e=>{e.preventDefault(),e.stopPropagation(),D(!0),setTimeout(()=>{var e,t;null===(e=S.current)||void 0===e||e.focus(),null===(t=S.current)||void 0===t||t.select()},0)},onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},children:(0,r.jsx)(tn.Z,{className:"h-3 w-3"})})]})},moodboard:function(e){let{id:t,properties:n,isSelected:o,onSelectElement:s,onEditElement:l,content:i,onUpdate:c,deleteElement:d,isListening:u,liveTranscript:p}=e,m="object"==typeof n&&null!==n?n:{},h="object"==typeof i&&null!==i&&"images"in i?i:{title:"Nuevo Moodboard",images:[],annotations:[],layout:"grid"},[g,x]=(0,a.useState)(!1),[f,v]=(0,a.useState)(""),[b,w]=(0,a.useState)(null),N=(0,a.useRef)(null),C=(0,a.useRef)(null),{saveStatus:k,handleBlur:E,handleChange:z}=ez({getContent:()=>{var e;return(null===(e=N.current)||void 0===e?void 0:e.value)||h.title||""},onSave:async e=>{e!==h.title&&c(t,{content:{...h,title:e}})},debounceMs:1e3}),T=(0,a.useCallback)(()=>{if(!f.trim())return;let e={id:"img-".concat(Date.now()),url:f.trim()};c(t,{content:{...h,images:[...h.images,e]}}),v(""),x(!1)},[t,h,f,c]),D=(0,a.useCallback)(e=>{c(t,{content:{...h,images:h.images.filter(t=>t.id!==e),annotations:h.annotations.filter(t=>t.imageId!==e)}})},[t,h,c]),S=(0,a.useCallback)((e,n)=>{let r=n.currentTarget.getBoundingClientRect(),a=(n.clientX-r.left)/r.width*100,o=(n.clientY-r.top)/r.height*100,s={id:"ann-".concat(Date.now()),imageId:e,x:Math.max(0,Math.min(100,a)),y:Math.max(0,Math.min(100,o)),text:"Nueva anotaci\xf3n",color:"#fffb8b"};c(t,{content:{...h,annotations:[...h.annotations,s]}}),w(s.id)},[t,h,c]),I=(0,a.useCallback)((e,n)=>{c(t,{content:{...h,annotations:h.annotations.map(t=>t.id===e?{...t,...n}:t)}})},[t,h,c]);(0,a.useCallback)(e=>{c(t,{content:{...h,annotations:h.annotations.filter(t=>t.id!==e)}}),w(null)},[t,h,c]);let P=(0,a.useCallback)(()=>{c(t,{hidden:!0})},[t,c]),R=(null==m?void 0:m.backgroundColor)||"#ffffff";return h.layout,(0,r.jsxs)(G,{id:t,"data-element-type":"moodboard","data-element-id":t,ref:C,className:(0,y.cn)("w-full h-full flex flex-col overflow-hidden","min-w-[400px] min-h-[300px]","rounded-lg shadow-lg border border-gray-200/50",o?"ring-2 ring-blue-500 ring-offset-2":"","hover:shadow-xl transition-shadow"),style:{backgroundColor:"transparent"===R?"#ffffff":R,pointerEvents:"auto"},onClick:e=>{e.target.closest(".drag-handle")||l(t)},onMouseDown:e=>{e.target.closest(".drag-handle")||(e.stopPropagation(),s(t,!1))},children:[(0,r.jsxs)(J,{className:"p-3 border-b border-gray-200 bg-white flex flex-row items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,r.jsx)("div",{className:"drag-handle cursor-grab active:cursor-grabbing flex-shrink-0",children:(0,r.jsx)(et.Z,{className:"h-4 w-4 text-gray-400"})}),(0,r.jsx)("input",{ref:N,type:"text",value:h.title||"",onChange:e=>{z(),c(t,{content:{...h,title:e.target.value}})},onBlur:E,className:"flex-1 min-w-0 text-sm font-semibold bg-transparent border-none outline-none focus:outline-none focus:ring-0 p-1",placeholder:"T\xedtulo del moodboard...",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation()})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",children:[(0,r.jsx)(eI,{status:k,size:"sm"}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-7 w-7",title:"Agregar imagen",onClick:e=>{e.stopPropagation(),x(!0)},children:(0,r.jsx)(ts.Z,{className:"h-4 w-4"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-7 w-7 text-gray-400 hover:text-gray-600",title:"Cerrar moodboard",onClick:e=>{e.stopPropagation(),P()},children:(0,r.jsx)(em.Z,{className:"h-4 w-4"})})]})]}),(0,r.jsxs)(Y,{className:"flex-1 p-3 overflow-y-auto",style:{minHeight:0},children:[g&&(0,r.jsx)("div",{className:"mb-3 p-3 bg-gray-50 rounded-lg border border-gray-200",children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(eY.I,{type:"url",placeholder:"URL de la imagen...",value:f,onChange:e=>v(e.target.value),onKeyDown:e=>{"Enter"===e.key?T():"Escape"===e.key&&(x(!1),v(""))},className:"flex-1",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation()}),(0,r.jsx)(j.z,{size:"sm",onClick:e=>{e.stopPropagation(),T()},children:"Agregar"}),(0,r.jsx)(j.z,{size:"sm",variant:"ghost",onClick:e=>{e.stopPropagation(),x(!1),v("")},children:"Cancelar"})]})}),0===h.images.length?(0,r.jsx)("div",{className:"flex items-center justify-center h-full text-sm text-gray-400",children:"Haz clic en el bot\xf3n de imagen para agregar im\xe1genes al moodboard"}):(0,r.jsx)("div",{className:(0,y.cn)("grid gap-4","grid-cols-2"),children:h.images.map(e=>{let t=h.annotations.filter(t=>t.imageId===e.id);return(0,r.jsxs)("div",{className:"relative group rounded-lg overflow-hidden border border-gray-200 bg-gray-50",children:[(0,r.jsxs)("div",{className:"relative w-full aspect-square cursor-crosshair",onClick:t=>{t.target.closest(".annotation")||S(e.id,t)},children:[(0,r.jsx)("img",{src:e.url,alt:"Moodboard image",className:"w-full h-full object-cover",onError:e=>{e.target.style.display="none"}}),t.map(e=>(0,r.jsx)("div",{className:(0,y.cn)("annotation absolute p-2 rounded shadow-lg cursor-move min-w-[80px]",b===e.id?"z-10 ring-2 ring-blue-500":""),style:{left:"".concat(e.x,"%"),top:"".concat(e.y,"%"),backgroundColor:e.color||"#fffb8b",transform:"translate(-50%, -50%)"},onClick:t=>{t.stopPropagation(),w(e.id)},onMouseDown:e=>e.stopPropagation(),children:b===e.id?(0,r.jsx)(eY.I,{type:"text",value:e.text,onChange:t=>{I(e.id,{text:t.target.value})},onBlur:()=>w(null),className:"text-xs h-6 px-1",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),"data-annotation-id":e.id,autoFocus:!0}):(0,r.jsx)("div",{className:"text-xs font-medium",children:e.text})},e.id))]}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity bg-red-500 hover:bg-red-600 text-white",onClick:t=>{t.stopPropagation(),D(e.id)},children:(0,r.jsx)(em.Z,{className:"h-3 w-3"})})]},e.id)})})]})]})},"tabbed-notepad":function(e){var t;let{id:n,properties:o,isSelected:s,onSelectElement:l,onEditElement:i,content:c,onUpdate:d,deleteElement:u,isListening:p,liveTranscript:m,finalTranscript:g,interimTranscript:x}=e,{toast:f}=(0,h.pm)(),v="object"==typeof o&&null!==o?o:{},b="object"==typeof c&&null!==c&&"tabs"in c?c:{title:"Bloc de Notas",tabs:[{id:"tab-1",title:"Pesta\xf1a 1",content:""}],activeTabId:"tab-1"},[N,C]=(0,a.useState)(!1),k=(0,a.useRef)(null),E=(0,a.useRef)(null),z=(0,a.useRef)({}),T=b.activeTabId||(null===(t=b.tabs[0])||void 0===t?void 0:t.id)||"tab-1",D=b.tabs.find(e=>e.id===T)||b.tabs[0],{saveStatus:S,handleBlur:I,handleChange:P}=ez({getContent:()=>{var e;return(null===(e=k.current)||void 0===e?void 0:e.value)||b.title||""},onSave:async e=>{e!==b.title&&d(n,{content:{...b,title:e}})},debounceMs:1e3}),R=(0,a.useCallback)(()=>{let e={id:"tab-".concat(Date.now()),title:"Pesta\xf1a ".concat(b.tabs.length+1),content:""};d(n,{content:{...b,tabs:[...b.tabs,e],activeTabId:e.id}})},[n,b,d]),M=(0,a.useCallback)(e=>{var t;if(b.tabs.length<=1){f({variant:"destructive",title:"Error",description:"Debe haber al menos una pesta\xf1a."});return}let r=b.tabs.filter(t=>t.id!==e),a=e===T?(null===(t=r[0])||void 0===t?void 0:t.id)||"tab-1":T;d(n,{content:{...b,tabs:r,activeTabId:a}})},[n,b,T,d,f]),F=(0,a.useCallback)(e=>{d(n,{content:{...b,activeTabId:e}})},[n,b,d]),B=(0,a.useCallback)((e,t)=>{d(n,{content:{...b,tabs:b.tabs.map(n=>n.id===e?{...n,title:t}:n)}})},[n,b,d]),A=(0,a.useCallback)((e,t)=>{d(n,{content:{...b,tabs:b.tabs.map(n=>n.id===e?{...n,content:t}:n)}})},[n,b,d]),Z=(0,a.useCallback)(async()=>{if(!E.current){f({variant:"destructive",title:"Error",description:"No se pudo encontrar el elemento para exportar."});return}C(!0),f({title:"Exportando...",description:"Generando imagen PNG de alta resoluci\xf3n."});try{(await w()(E.current,{backgroundColor:"#ffffff",scale:3,useCORS:!0,logging:!1,allowTaint:!1,windowWidth:E.current.scrollWidth,windowHeight:E.current.scrollHeight})).toBlob(e=>{if(!e){f({variant:"destructive",title:"Error",description:"No se pudo generar la imagen."}),C(!1);return}let t=URL.createObjectURL(e),n=document.createElement("a");n.href=t;let r=b.title||"bloc-notas";n.download="".concat(r,"_").concat(Date.now(),".png"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t),f({title:"Exportado",description:"El bloc de notas se ha exportado como PNG de alta resoluci\xf3n."}),C(!1)},"image/png",1)}catch(e){console.error("Error al exportar:",e),f({variant:"destructive",title:"Error",description:e.message||"Ocurri\xf3 un error al exportar."}),C(!1)}},[b.title,f]),L=(0,a.useCallback)(()=>{d(n,{hidden:!0})},[n,d]),O=(0,a.useRef)(null);(0,a.useEffect)(()=>{let e=document.activeElement;e&&"TEXTAREA"===e.tagName&&E.current&&E.current.contains(e)&&(O.current=e)},[D]),eL({elementRef:O,isListening:p||!1,liveTranscript:m||"",finalTranscript:g||"",interimTranscript:x||"",isSelected:s||!1,enabled:!0}),(0,a.useEffect)(()=>{if(O.current&&D){let e=O.current,t=()=>{A(D.id,e.value)};return e.addEventListener("input",t),()=>e.removeEventListener("input",t)}},[D,A]);let U=(null==v?void 0:v.backgroundColor)||"#ffffff";return(0,r.jsxs)(G,{id:n,"data-element-type":"tabbed-notepad","data-element-id":n,ref:E,className:(0,y.cn)("w-full h-full flex flex-col overflow-hidden","min-w-[400px] min-h-[300px]","rounded-lg shadow-lg border border-gray-200/50",s?"ring-2 ring-blue-500 ring-offset-2":"","hover:shadow-xl transition-shadow"),style:{backgroundColor:"transparent"===U?"#ffffff":U,pointerEvents:"auto"},onClick:e=>{e.target.closest(".drag-handle")||i(n)},onMouseDown:e=>{e.target.closest(".drag-handle")||(e.stopPropagation(),l(n,!1))},children:[(0,r.jsxs)(J,{className:"p-3 border-b border-gray-200 bg-white flex flex-row items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(0,r.jsx)("div",{className:"drag-handle cursor-grab active:cursor-grabbing flex-shrink-0",children:(0,r.jsx)(et.Z,{className:"h-4 w-4 text-gray-400"})}),(0,r.jsx)("input",{ref:k,type:"text",value:b.title||"",onChange:e=>{P(),d(n,{content:{...b,title:e.target.value}})},onBlur:I,className:"flex-1 min-w-0 text-sm font-semibold bg-transparent border-none outline-none focus:outline-none focus:ring-0 p-1",placeholder:"T\xedtulo del bloc...",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation()})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",children:[(0,r.jsx)(eI,{status:S,size:"sm"}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-7 w-7",title:"Exportar a PNG",onClick:e=>{e.stopPropagation(),Z()},disabled:N,children:(0,r.jsx)(e$.Z,{className:"h-4 w-4"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-7 w-7 text-gray-400 hover:text-gray-600",title:"Cerrar bloc",onClick:e=>{e.stopPropagation(),L()},children:(0,r.jsx)(em.Z,{className:"h-4 w-4"})})]})]}),(0,r.jsx)(Y,{className:"flex-1 p-3 overflow-hidden flex flex-col",style:{minHeight:0},children:(0,r.jsxs)(ti,{value:T,onValueChange:F,className:"flex-1 flex flex-col overflow-hidden",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)(tc,{className:"flex-1 justify-start overflow-x-auto",children:b.tabs.map(e=>(0,r.jsxs)(td,{value:e.id,className:"relative group/tab",onClick:e=>e.stopPropagation(),children:[(0,r.jsx)("input",{type:"text",value:e.title,onChange:t=>{t.stopPropagation(),B(e.id,t.target.value)},onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),className:"bg-transparent border-none outline-none text-xs px-1 min-w-[60px] max-w-[120px]"}),b.tabs.length>1&&(0,r.jsx)("span",{className:"inline-flex items-center justify-center h-4 w-4 ml-1 opacity-0 group-hover/tab:opacity-100 transition-opacity cursor-pointer hover:bg-gray-100 rounded",onClick:t=>{t.stopPropagation(),t.preventDefault(),M(e.id)},onMouseDown:e=>{e.stopPropagation(),e.preventDefault()},role:"button",tabIndex:0,onKeyDown:t=>{("Enter"===t.key||" "===t.key)&&(t.preventDefault(),t.stopPropagation(),M(e.id))},children:(0,r.jsx)(em.Z,{className:"h-3 w-3"})})]},e.id))}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-7 w-7 ml-2",title:"Agregar pesta\xf1a",onClick:e=>{e.stopPropagation(),R()},children:(0,r.jsx)(ee.Z,{className:"h-4 w-4"})})]}),b.tabs.map(e=>(0,r.jsx)(tu,{value:e.id,className:"flex-1 overflow-hidden mt-0",children:(0,r.jsx)("textarea",{ref:t=>{z.current[e.id]=t},value:e.content,onChange:t=>{A(e.id,t.target.value)},className:"w-full h-full resize-none border-none outline-none bg-transparent p-2 text-sm",placeholder:"Escribe aqu\xed...",onClick:e=>e.stopPropagation(),onMouseDown:e=>e.stopPropagation(),style:{minHeight:"200px"}})},e.id))]})})]})},accordion:function(e){let{id:t,content:n,properties:o,isSelected:s,onUpdate:l,isListening:i,liveTranscript:c,finalTranscript:d,interimTranscript:u}=e,p="object"==typeof o&&null!==o?o:{},m="object"==typeof n&&null!==n&&"items"in n?n:{items:[{id:"1",title:"Nuevo Item",content:""}]},[h,g]=(0,a.useState)(m.items||[]),[x,f]=(0,a.useState)(h.filter(e=>e.isOpen).map(e=>e.id));(0,a.useEffect)(()=>{"object"==typeof n&&null!==n&&"items"in n&&(g(n.items||[]),f(n.items.filter(e=>e.isOpen).map(e=>e.id)))},[n]);let v=e=>{let n=h.filter(t=>t.id!==e);g(n),f(x.filter(t=>t!==e)),l(t,{content:{items:n}})},b=(e,n)=>{let r=h.map(t=>t.id===e?{...t,...n}:t);g(r),l(t,{content:{items:r}})},w=p.size||{width:320,height:240},N="number"==typeof w.width?w.width:320,C="number"==typeof w.height?w.height:240;return(0,r.jsxs)(G,{className:(0,y.cn)("w-full h-full p-3 bg-white shadow-sm drag-handle",s&&"ring-2 ring-primary"),style:{width:"".concat(N,"px"),height:"".concat(C,"px"),backgroundColor:p.backgroundColor||"#ffffff"},children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2 drag-handle",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 drag-handle",children:[(0,r.jsx)(et.Z,{className:"h-4 w-4 text-slate-400 cursor-move drag-handle"}),(0,r.jsx)("h3",{className:"font-semibold text-slate-800 text-sm drag-handle",children:"Acorde\xf3n"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[s&&(0,r.jsxs)(eH,{children:[(0,r.jsx)(e_,{asChild:!0,children:(0,r.jsx)(j.z,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0",onClick:e=>e.stopPropagation(),children:(0,r.jsx)(eX.Z,{className:"h-4 w-4"})})}),(0,r.jsx)(eK,{className:"w-auto p-0",onClick:e=>e.stopPropagation(),children:(0,r.jsx)(eq.e8,{color:p.backgroundColor||"#ffffff",onChange:e=>l(t,{properties:{...p,backgroundColor:e.hex}})})})]}),(0,r.jsx)(j.z,{size:"sm",variant:"ghost",onClick:()=>{let e=[...h,{id:Date.now().toString(),title:"Nuevo Item",content:"",isOpen:!1}];g(e),l(t,{content:{items:e}})},className:"h-7 w-7 p-0",children:(0,r.jsx)(ee.Z,{className:"h-4 w-4"})})]})]}),(0,r.jsx)(tm,{type:"multiple",value:x,onValueChange:e=>{let n=Array.isArray(e)?e:e?[e]:[];f(n),l(t,{content:{items:h.map(e=>({...e,isOpen:n.includes(e.id)}))}})},className:"w-full",children:h.map(e=>(0,r.jsxs)(th,{value:e.id,children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(tg,{className:"flex-1 text-left",onClick:e=>e.stopPropagation(),children:(0,r.jsx)(tf,{value:e.title,onChange:t=>b(e.id,{title:t}),isListening:i,liveTranscript:c,finalTranscript:d})}),s&&(0,r.jsx)(j.z,{size:"sm",variant:"ghost",onClick:t=>{t.stopPropagation(),v(e.id)},className:"h-7 w-7 p-0 text-destructive hover:text-destructive",children:(0,r.jsx)(em.Z,{className:"h-4 w-4"})})]}),(0,r.jsx)(tx,{children:(0,r.jsx)(tv,{value:e.content,onChange:t=>b(e.id,{content:t}),isListening:i,liveTranscript:c,finalTranscript:d,interimTranscript:u,isSelected:s})})]},e.id))}),0===h.length&&(0,r.jsx)("div",{className:"text-center text-slate-400 py-8",children:(0,r.jsx)("p",{children:"No hay items. Haz clic en + para agregar uno."})})]})},"yellow-notepad":function(e){let{id:t,content:n,properties:o,onUpdate:s,deleteElement:l,isSelected:i,isListening:c,liveTranscript:d,finalTranscript:u,interimTranscript:p}=e,{toast:m}=(0,h.pm)(),g=(0,a.useRef)(null),[x,f]=(0,a.useState)(!1),[v,b]=(0,a.useState)(!1),N=n||{},C=N.text||"",k=N.searchQuery||"",[E,z]=(0,a.useState)(k);(0,a.useEffect)(()=>{void 0!==N.searchQuery&&N.searchQuery!==E&&z(N.searchQuery)},[N.searchQuery]);let{saveStatus:T,handleBlur:D,handleChange:S}=ez({getContent:()=>{var e;return(null===(e=g.current)||void 0===e?void 0:e.innerText)||""},onSave:async e=>{e!==(C||"").trim()&&await s(t,{content:{text:e,searchQuery:E}})},debounceMs:2e3,compareContent:(e,t)=>(e||"").trim()===(t||"").trim()});(0,a.useEffect)(()=>{g.current&&C!==g.current.innerText&&document.activeElement!==g.current&&(g.current.innerText=C||"")},[C]),eL({elementRef:g,isListening:c||!1,liveTranscript:d||"",finalTranscript:u||"",interimTranscript:p||"",isSelected:i||!1,enabled:!0});let I=(0,a.useCallback)(async e=>{e.stopPropagation(),e.preventDefault();try{let e=document.querySelector('[data-element-id="'.concat(t,'"]'));if(!e){m({variant:"destructive",title:"Error",description:"No se pudo encontrar el elemento para exportar."});return}b(!0),m({title:"Exportando...",description:"Generando imagen PNG de alta resoluci\xf3n."}),(await w()(e,{backgroundColor:"#FFFFE0",scale:3,useCORS:!0,logging:!1,allowTaint:!1,windowWidth:e.scrollWidth,windowHeight:e.scrollHeight})).toBlob(e=>{if(!e){m({variant:"destructive",title:"Error",description:"No se pudo generar la imagen."}),b(!1);return}let t=URL.createObjectURL(e),n=document.createElement("a");n.href=t,n.download="yellow-notepad_".concat(Date.now(),".png"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t),m({title:"Exportado",description:"El cuaderno se ha exportado como PNG de alta resoluci\xf3n."}),b(!1)},"image/png",1)}catch(e){console.error("Error al exportar:",e),m({variant:"destructive",title:"Error",description:e.message||"No se pudo exportar."}),b(!1)}},[m,t]),P=(0,a.useCallback)(()=>{S()},[S]),M=(0,a.useCallback)(async()=>{await D()},[D]),F=(0,a.useCallback)(e=>{let n=e.target.value;z(n),s(t,{content:{...N,searchQuery:n}})},[t,s,N]),B=(0,a.useCallback)(()=>{x||(f(!0),l(t))},[t,l,x]),A=(0,a.useCallback)(()=>{B()},[B]);return(0,r.jsxs)("div",{"data-element-id":t,className:(0,y.cn)("relative w-full h-full flex flex-col overflow-hidden"),style:{backgroundColor:"#FFFFE0",borderRadius:"4px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},onMouseDown:e=>{var t;let n=e.target;n===g.current||(null===(t=g.current)||void 0===t?void 0:t.contains(n))?e.currentTarget.classList.remove("drag-handle"):e.currentTarget.classList.add("drag-handle")},children:[(0,r.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 drag-handle",style:{backgroundColor:"#e9e490",color:"#000000"},children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-6 w-6 hover:bg-black/10 p-0",style:{color:"#000000"},children:(0,r.jsx)(tb.Z,{className:"h-4 w-4"})}),(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("span",{className:"text-sm font-bold leading-tight",style:{color:"#000000"},children:"Nuevo"}),(0,r.jsx)("span",{className:"text-sm font-bold leading-tight",style:{color:"#000000"},children:"Notepad"})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-1 max-w-xs mx-4",children:[(0,r.jsx)(tr.Z,{className:"h-4 w-4",style:{color:"#000000"}}),(0,r.jsx)(eY.I,{type:"text",placeholder:"Buscar...",value:E,onChange:F,className:"h-7 text-sm bg-transparent border-none text-black placeholder:text-gray-600 focus-visible:ring-0 focus-visible:ring-offset-0",style:{color:"#000000"}})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)(ef,{children:[(0,r.jsx)(ev,{asChild:!0,children:(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-6 w-6 hover:bg-black/10 p-0",style:{color:"#000000"},children:(0,r.jsx)(ec.Z,{className:"h-4 w-4"})})}),(0,r.jsx)(ej,{children:(0,r.jsxs)(eN,{onMouseDown:e=>{e.preventDefault(),e.stopPropagation(),I(e)},disabled:v,children:[(0,r.jsx)(ed.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:v?"Exportando...":"Exportar a PNG: alta resoluci\xf3n"})]})})]}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-6 w-6 hover:bg-black/10 p-0",onClick:B,style:{color:"#000000"},children:(0,r.jsx)(R.Z,{className:"h-4 w-4"})}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-6 w-6 hover:bg-black/10 p-0",onClick:A,style:{color:"#000000"},children:(0,r.jsx)(em.Z,{className:"h-4 w-4"})})]})]}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto relative",style:{backgroundColor:"#FFFFE0",position:"relative"},children:[(0,r.jsx)("div",{className:"absolute left-0 top-0 bottom-0",style:{width:"15px",borderLeft:"1px solid #ADD8E6"}}),(0,r.jsx)("div",{className:"absolute inset-0 pointer-events-none",style:{backgroundImage:"repeating-linear-gradient(to bottom, transparent, transparent 24px, #ADD8E6 24px, #ADD8E6 25px)",backgroundPosition:"15px 0",backgroundSize:"100% 25px"}}),(0,r.jsx)("div",{ref:g,contentEditable:!0,onInput:P,onBlur:M,onMouseDown:e=>{(e.target===e.currentTarget||e.target.isContentEditable)&&e.stopPropagation()},className:(0,y.cn)("relative z-10 w-full min-h-full","outline-none","text-black","whitespace-pre-wrap","break-words","select-text"),style:{paddingLeft:"20px",paddingRight:"15px",paddingTop:"12px",paddingBottom:"12px",fontFamily:"system-ui, -apple-system, sans-serif",fontSize:"14px",lineHeight:"25px",color:"#000000",minHeight:"100%",userSelect:"text",WebkitUserSelect:"text"}}),i&&(0,r.jsx)("div",{className:"absolute top-2 right-2 z-20",children:(0,r.jsx)(eI,{status:T,size:"sm"})})]})]})},stopwatch:function(e){let{id:t,onUpdate:n,onSelectElement:o,isSelected:s}=e,[l,i]=(0,a.useState)(0),[c,d]=(0,a.useState)(!1),u=(0,a.useRef)(null);(0,a.useEffect)(()=>(c?u.current=setInterval(()=>{i(e=>e+10)},10):u.current&&(clearInterval(u.current),u.current=null),()=>{u.current&&clearInterval(u.current)}),[c]);let p=(0,a.useCallback)(()=>{d(!0)},[]),m=(0,a.useCallback)(()=>{d(!1)},[]),h=(0,a.useCallback)(()=>{d(!1),i(0)},[]),g=(0,a.useCallback)(()=>{n(t,{hidden:!0})},[t,n]);return(0,r.jsxs)("div",{className:"bg-black text-white rounded-lg p-4 flex flex-col items-center justify-center gap-2 shadow-lg",style:{width:"100%",height:"100%"},onClick:()=>o(t,!1),children:[(0,r.jsx)("div",{className:"text-3xl font-mono font-bold",children:(e=>{let t=Math.floor(e/1e3);return"".concat(Math.floor(t/60).toString().padStart(2,"0"),":").concat((t%60).toString().padStart(2,"0"),".").concat(Math.floor(e%1e3/10).toString().padStart(2,"0"))})(l)}),(0,r.jsxs)("div",{className:"flex gap-2",children:[c?(0,r.jsx)(j.z,{size:"icon",variant:"outline",className:"bg-white text-black hover:bg-gray-200 h-7 w-7",onClick:m,children:(0,r.jsx)(tj.Z,{className:"h-3 w-3"})}):(0,r.jsx)(j.z,{size:"icon",variant:"outline",className:"bg-white text-black hover:bg-gray-200 h-7 w-7",onClick:p,children:(0,r.jsx)(ty.Z,{className:"h-3 w-3"})}),(0,r.jsx)(j.z,{size:"icon",variant:"outline",className:"bg-white text-black hover:bg-gray-200 h-7 w-7",onClick:h,children:(0,r.jsx)(tN.Z,{className:"h-3 w-3"})}),(0,r.jsx)(j.z,{size:"icon",variant:"outline",className:"bg-white text-black hover:bg-gray-200 h-7 w-7",onClick:g,children:(0,r.jsx)(em.Z,{className:"h-3 w-3"})})]})]})},countdown:function(e){let{id:t,onUpdate:n,onSelectElement:o,isSelected:s}=e,[l,i]=(0,a.useState)(0),[c,d]=(0,a.useState)(!1),[u,p]=(0,a.useState)(5),[m,h]=(0,a.useState)(!1),g=(0,a.useRef)(null);(0,a.useEffect)(()=>(c&&l>0?g.current=setInterval(()=>{i(e=>e<=1e3?(d(!1),h(!0),setTimeout(()=>h(!1),5e3),0):e-1e3)},1e3):g.current&&(clearInterval(g.current),g.current=null),()=>{g.current&&clearInterval(g.current)}),[c,l]);let x=(0,a.useCallback)(()=>{0===l&&i(6e4*u),d(!0)},[l,u]),f=(0,a.useCallback)(()=>{d(!1)},[]),v=(0,a.useCallback)(()=>{d(!1),i(6e4*u)},[u]),b=(0,a.useCallback)(()=>{n(t,{hidden:!0})},[t,n]);return(0,r.jsxs)("div",{className:"bg-black text-white rounded-lg p-4 flex flex-col items-center justify-center gap-2 shadow-lg ".concat(m?"animate-pulse":""),style:{width:"100%",height:"100%"},onClick:()=>o(t,!1),children:[0!==l||c?(0,r.jsx)("div",{className:"text-3xl font-mono font-bold",children:(e=>{let t=Math.floor(e/1e3);return"".concat(Math.floor(t/60).toString().padStart(2,"0"),":").concat((t%60).toString().padStart(2,"0"))})(l)}):(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)("div",{className:"text-sm mb-2",children:"Seleccionar tiempo:"}),(0,r.jsx)("div",{className:"grid grid-cols-3 gap-1",children:tC.map(e=>(0,r.jsxs)(j.z,{size:"sm",variant:u===e?"default":"outline",className:u===e?"bg-white text-black":"bg-gray-800 text-white",onClick:()=>p(e),children:[e,"m"]},e))})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[c?(0,r.jsx)(j.z,{size:"icon",variant:"outline",className:"bg-white text-black hover:bg-gray-200 h-7 w-7",onClick:f,children:(0,r.jsx)(tj.Z,{className:"h-3 w-3"})}):(0,r.jsx)(j.z,{size:"icon",variant:"outline",className:"bg-white text-black hover:bg-gray-200 h-7 w-7",onClick:x,children:(0,r.jsx)(ty.Z,{className:"h-3 w-3"})}),(0,r.jsx)(j.z,{size:"icon",variant:"outline",className:"bg-white text-black hover:bg-gray-200 h-7 w-7",onClick:v,children:(0,r.jsx)(tN.Z,{className:"h-3 w-3"})}),(0,r.jsx)(j.z,{size:"icon",variant:"outline",className:"bg-white text-black hover:bg-gray-200 h-7 w-7",onClick:b,children:(0,r.jsx)(em.Z,{className:"h-3 w-3"})})]})]})},"highlight-text":function(e){let{id:t,content:n,properties:o,onUpdate:s,onSelectElement:l,isSelected:i,isListening:c,liveTranscript:d,finalTranscript:u,interimTranscript:p}=e,[m,h]=(0,a.useState)((null==n?void 0:n.text)||""),[g,x]=(0,a.useState)((null==o?void 0:o.backgroundColor)||tk[0].value);(0,a.useRef)(null);let f=(0,a.useRef)(null);eL({elementRef:f,isListening:c||!1,liveTranscript:d||"",finalTranscript:u||"",interimTranscript:p||"",isSelected:i||!1,enabled:!0}),(0,a.useEffect)(()=>{(null==n?void 0:n.text)!==m&&h((null==n?void 0:n.text)||""),(null==o?void 0:o.backgroundColor)!==g&&x((null==o?void 0:o.backgroundColor)||tk[0].value)},[n,null==o?void 0:o.backgroundColor]);let v=(0,a.useCallback)(e=>{let r=e.currentTarget.textContent||"";h(r),s(t,{content:{...n,text:r}})},[t,n,s]),b=(0,a.useCallback)(e=>{x(e),s(t,{properties:{...o,backgroundColor:e}})},[t,o,s]);return(0,r.jsxs)("div",{className:"rounded-lg p-4 shadow-lg",style:{width:"100%",height:"100%",backgroundColor:g,border:i?"2px solid #3b82f6":"1px solid #e5e7eb"},onClick:()=>l(t,!1),children:[i&&(0,r.jsx)("div",{className:"mb-2 flex gap-1 flex-wrap",children:tk.map(e=>(0,r.jsx)("button",{className:"w-6 h-6 rounded border border-gray-300 hover:scale-110 transition-transform",style:{backgroundColor:e.value},onClick:t=>{t.stopPropagation(),b(e.value)},title:e.label},e.name))}),(0,r.jsx)(e7(),{innerRef:f,html:m,onChange:v,className:"outline-none min-h-[100px] w-full",style:{backgroundColor:"transparent"}})]})}},tz=e=>{var t,n;if("object"==typeof e.properties&&null!==e.properties&&"position"in e.properties&&"size"in e.properties&&"zIndex"in e.properties)return e;let r="object"==typeof e.properties&&null!==e.properties?e.properties:{},a="x"in e?e.x:void 0,o="y"in e?e.y:void 0,s="width"in e?e.width:void 0,l="height"in e?e.height:void 0,i="zIndex"in e?e.zIndex:void 0;return{...e,properties:{position:r.position||{x:a||100,y:o||100},size:r.size||{width:s||200,height:l||150},zIndex:null!==(n=null!==(t=r.zIndex)&&void 0!==t?t:i)&&void 0!==n?n:1,rotation:r.rotation||0,...r}}};function tT(e){var t,n,o,s;let{element:l,allElements:i,scale:c,offset:d={x:0,y:0},isSelected:u,updateElement:p,unanchorElement:m,deleteElement:h,onFormatToggle:g,onChangeNotepadFormat:x,onLocateElement:f,onSelectElement:v,onBringToFront:b,onSendToBack:w,onMoveBackward:N,onEditElement:C,onGroupElements:k,addElement:E,activatedElementId:z,onActivateDrag:T,onEditComment:D,onDuplicateElement:S,onUngroup:I,setIsDirty:P,boardId:F,isListening:B,liveTranscript:A,finalTranscript:Z="",interimTranscript:L=""}=e,O=tz(l),[U,H]=(0,a.useState)(!1),_="object"==typeof O.properties&&null!==O.properties?O.properties:{},K=O.parentId&&_.relativePosition?_.relativePosition:_.position||{x:O.x||0,y:O.y||0},q=_.size||{width:O.width||200,height:O.height||150},W=null!==(n=null!==(t=_.rotation)&&void 0!==t?t:O.rotation)&&void 0!==n?n:0,G=null!==(s=null!==(o=_.zIndex)&&void 0!==o?o:O.zIndex)&&void 0!==s?s:1,J={width:"number"==typeof q.width&&q.width>0?q.width:200,height:"number"==typeof q.height&&q.height>0?q.height:150},Y=(0,a.useCallback)((e,t)=>{var n,r,a,o,s,l;let c={x:t.x,y:t.y},d="object"==typeof O.properties&&null!==O.properties?O.properties:{};if("container"!==O.type){let t=e.clientX||(null===(r=e.touches)||void 0===r?void 0:null===(n=r[0])||void 0===n?void 0:n.clientX)||0,l=e.clientY||(null===(o=e.touches)||void 0===o?void 0:null===(a=o[0])||void 0===a?void 0:a.clientY)||0,u=t,m=l;if(!u||!m){let e=document.querySelector('[data-element-id="'.concat(O.id,'"]'));if(e){let t=e.getBoundingClientRect();u=t.left+t.width/2,m=t.top+t.height/2}}for(let e of[{x:u,y:m},{x:u-10,y:m},{x:u+10,y:m},{x:u,y:m-10},{x:u,y:m+10}]){let t=document.elementFromPoint(e.x,e.y);if(t){let n=t.closest('[data-element-type="container"]');if(n){let t=n.getAttribute("data-element-id");if(t&&t!==O.id){let r=i.find(e=>e.id===t&&"container"===e.type);if(r){let a=r.content,o=n.getBoundingClientRect(),l=e.x,i=e.y;if(l>=o.left&&l<=o.right&&i>=o.top&&i<=o.bottom&&a&&!(null===(s=a.elementIds)||void 0===s?void 0:s.includes(O.id))){let e=[...a.elementIds||[],O.id];p(r.id,{content:{...a,elementIds:e}}),p(O.id,{parentId:r.id,hidden:!0,properties:{...d,position:c}}),console.log("✅ Elemento guardado en contenedor:",{elementId:O.id,containerId:t,dropX:l,dropY:i,containerRect:o});return}}}}}}}if(O.parentId){let e=i.find(e=>e.id===O.parentId);if(e&&"container"===e.type){let t=e.content;if(t&&(null===(l=t.elementIds)||void 0===l?void 0:l.includes(O.id))){let n=t.elementIds.filter(e=>e!==O.id);p(e.id,{content:{...t,elementIds:n}})}}p(O.id,{parentId:void 0,hidden:!1,properties:{...d,position:c}})}else p(O.id,{properties:{...d,position:c}})},[O,i,p,J]),X=(0,a.useCallback)((e,t,n,r,a)=>{let o="object"==typeof O.properties&&null!==O.properties?O.properties:{},s={width:parseFloat(n.style.width),height:parseFloat(n.style.height)},l=O.parentId?a:{x:a.x,y:a.y},i={properties:{...o,size:s,...O.parentId?{relativePosition:l}:{position:l}}};p(O.id,i)},[O,p]),Q=(0,a.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),H(!0)},[]),$=(0,a.useCallback)(()=>{h&&h(O.id),H(!1)},[h,O.id]),ee=tE[O.type];if(!ee)return console.warn("ElementComponent no encontrado para tipo: ".concat(O.type)),null;if(!J||"number"!=typeof J.width||"number"!=typeof J.height)return console.warn("Tama\xf1o inv\xe1lido para elemento ".concat(O.id,":"),J),null;let et={style:{zIndex:G,border:u?"2px solid hsl(var(--primary))":"none",boxSizing:"border-box",transform:"rotate(".concat(W,"deg)"),transformOrigin:"center center"},size:{width:J.width,height:J.height},position:K,onDragStop:Y,onResizeStop:X,minWidth:50,minHeight:50,dragHandleClassName:"drag-handle",className:(0,y.cn)("focus:outline-none"),onMouseDown:e=>{v(O.id,e.altKey||e.shiftKey||e.metaKey||e.ctrlKey)},enableResizing:!0,scale:c,bounds:O.parentId&&"container"!==O.type?'[data-element-id="'.concat(O.parentId,'"]'):void 0};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(M.s,{...et,children:(0,r.jsxs)("div",{"data-element-id":O.id,"data-element-type":O.type,className:"w-full h-full relative group",children:[u&&(0,r.jsx)(j.z,{variant:"destructive",size:"icon",className:"absolute -top-3 -right-3 z-50 h-8 w-8 rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-opacity",onClick:Q,onMouseDown:e=>e.stopPropagation(),children:(0,r.jsx)(R.Z,{className:"h-4 w-4"})}),(0,r.jsx)(ee,{id:O.id,type:O.type,x:K.x,y:K.y,width:q.width,height:q.height,rotation:W,zIndex:G,content:O.content,properties:O.properties,color:O.color,backgroundColor:O.backgroundColor,hidden:O.hidden,minimized:"notepad"===O.type?O.minimized:void 0,tags:"sticky"===O.type?O.tags:void 0,parentId:O.parentId,isSelected:u,onUpdate:p,deleteElement:h,onSelectElement:v,onEditElement:C,onFormatToggle:g,onChangeNotepadFormat:x,onLocateElement:f,allElements:i,onBringToFront:b,onSendToBack:w,onMoveBackward:N,onGroupElements:k,addElement:E,activatedElementId:z,onActivateDrag:T,onEditComment:D,onDuplicateElement:S,onUngroup:()=>I(O.id),setIsDirty:()=>{},scale:c,offset:d,boardId:F,isListening:B,liveTranscript:A,finalTranscript:Z,interimTranscript:L,..."container"===O.type&&{unanchorElement:m}})]})}),(0,r.jsx)(V,{isOpen:U,onOpenChange:H,onConfirm:$})]})}function tD(e){return"number"!=typeof e.x||"number"!=typeof e.y||"number"!=typeof e.width||"number"!=typeof e.height?null:{x:e.x+e.width/2,y:e.y+e.height/2}}function tS(e){let{allElements:t,isSelected:n,content:a,scale:o,offset:s,onSelectElement:l,id:i}=e,{fromElementId:c,toElementId:d,label:u,color:p}=a;if(!c||!d||!t)return null;let m=t.find(e=>e.id===c),h=t.find(e=>e.id===d);if(!m||!h)return null;let g=tD(m),x=tD(h);if(!g||!x)return null;let f=g.x*o+((null==s?void 0:s.x)||0),v=g.y*o+((null==s?void 0:s.y)||0),b=x.x*o+((null==s?void 0:s.x)||0),w=x.y*o+((null==s?void 0:s.y)||0);return(0,r.jsxs)("g",{className:(0,y.cn)("connector",{selected:n}),onMouseDown:e=>l(i,e.shiftKey||e.ctrlKey||e.metaKey),children:[(0,r.jsx)("line",{x1:f,y1:v,x2:b,y2:w,stroke:p||"hsl(var(--foreground))",strokeWidth:2,markerEnd:"url(#arrowhead)"}),u&&(0,r.jsx)("text",{x:(f+b)/2,y:(v+w)/2,fill:p||"hsl(var(--foreground))",textAnchor:"middle",dominantBaseline:"middle",fontSize:"12",className:"pointer-events-none",children:u})]})}let tI=(0,a.forwardRef)((e,t)=>{let{elements:n,board:o,selectedElementIds:s,onSelectElement:l,updateElement:i,unanchorElement:c,deleteElement:d,onBringToFront:u,onSendToBack:p,onMoveBackward:m,onFormatToggle:h,onChangeNotepadFormat:g,onLocateElement:x,onGoToHome:f,onCenterView:v,onEditElement:b,onGroupElements:w,addElement:j,saveLastView:N,selectedElement:C,activatedElementId:k,onActivateDrag:E,onEditComment:z,onDuplicateElement:T,onUngroup:D,setIsDirty:S,isMobile:I,isListening:R,liveTranscript:M,finalTranscript:F,interimTranscript:B}=e,[A,Z]=(0,a.useState)(1),[L,O]=(0,a.useState)(null),[U,H]=(0,a.useState)(!1),_=(0,a.useRef)(null),K=(0,a.useRef)(null),q=(0,a.useMemo)(()=>{if(0===n.length)return{width:window.innerWidth+2e3,height:window.innerHeight+2e3};let e=0,t=0;return n.forEach(n=>{let r="number"==typeof n.width?n.width:parseFloat(n.width||"0"),a="number"==typeof n.height?n.height:parseFloat(n.height||"0");isFinite(r)&&isFinite(a)&&(e=Math.max(e,n.x+r),t=Math.max(t,n.y+a))}),{width:Math.max(e+2e3,window.innerWidth),height:Math.max(t+2e3,window.innerHeight)}},[n]),W=(0,a.useRef)(L),V=(0,a.useRef)(N),G=(0,a.useRef)(_.current);(0,a.useEffect)(()=>{W.current=L,V.current=N,G.current=_.current},[L,N]);let J=(0,a.useCallback)(e=>{let t=W.current,n=G.current;if(t&&n&&(e.preventDefault(),t.isPanning)){let r=e.clientX-t.startPoint.x,a=e.clientY-t.startPoint.y;n.scrollLeft=t.initialScroll.x-.7*r,n.scrollTop=t.initialScroll.y-.7*a}},[]),Y=(0,a.useCallback)(()=>{W.current&&V.current(),O(null)},[]);(0,a.useEffect)(()=>(L?(window.addEventListener("mousemove",J),window.addEventListener("mouseup",Y)):(window.removeEventListener("mousemove",J),window.removeEventListener("mouseup",Y)),()=>{window.removeEventListener("mousemove",J),window.removeEventListener("mouseup",Y)}),[L,J,Y]);let X=(0,a.useCallback)(e=>{e.scrollLeft=0,e.scrollTop=0,(0!==e.scrollLeft||0!==e.scrollTop)&&e.scrollTo(0,0)},[]),Q=(0,a.useCallback)(()=>{let e=_.current;e&&(Z(I?.3:1),requestAnimationFrame(()=>{e&&X(e)}))},[I,X]);(0,a.useEffect)(()=>{let e=_.current;if(!e)return;Z(I?.3:1),X(e),requestAnimationFrame(()=>{e&&X(e)});let t=setTimeout(()=>{e&&(0!==e.scrollLeft||0!==e.scrollTop)&&(console.warn("⚠️ Scroll no est\xe1 en (0,0), forzando correcci\xf3n..."),X(e))},100),n=setTimeout(()=>{e&&(0!==e.scrollLeft||0!==e.scrollTop)&&(console.warn("⚠️ Scroll a\xfan no est\xe1 en (0,0) despu\xe9s de 500ms, forzando correcci\xf3n final..."),X(e))},500);return()=>{clearTimeout(t),clearTimeout(n)}},[o.id,I,X]);let $=(0,a.useCallback)(()=>{if(!_.current)return{x:window.innerWidth/2,y:window.innerHeight/2};let{scrollLeft:e,scrollTop:t,clientWidth:n,clientHeight:r}=_.current,a=(e+n/2)/A,o=(t+r/2)/A;return{x:Math.max(n/(2*A),a),y:Math.max(r/(2*A),o)}},[A]),ee=(0,a.useCallback)((e,t)=>{let n=_.current;if(!n)return;e=Math.max(.1,Math.min(e,5));let{clientWidth:r,clientHeight:a,scrollLeft:o,scrollTop:s}=n,l=t||{x:r/2,y:a/2},i=o+l.x,c=s+l.y,d=i*e/A-l.x,u=c*e/A-l.y;Z(e),requestAnimationFrame(()=>{n.scrollLeft=d,n.scrollTop=u})},[A]),et=(0,a.useCallback)((e,t)=>{let n=_.current;if(!n)return;let r=t?Math.max(.1,Math.min(t,5)):A,{clientWidth:a,clientHeight:o}=n,s=e.x*r-a/2,l=e.y*r-o/2;t&&Z(r),requestAnimationFrame(()=>{n.scrollTo({left:s,top:l,behavior:"smooth"})})},[A]),en=(0,a.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!e)return;let n="number"==typeof e.width?e.width:parseFloat(e.width||"0"),r="number"==typeof e.height?e.height:parseFloat(e.height||"0");et({x:e.x+n/2,y:e.y+r/2},t)},[et]),er=(0,a.useCallback)(e=>{if(!n||0===n.length){Q();return}let t=1/0,r=1/0,a=-1/0,o=-1/0;n.forEach(e=>{let n="number"==typeof e.width?e.width:parseFloat(e.width||"0"),s="number"==typeof e.height?e.height:parseFloat(e.height||"0");t=Math.min(t,e.x),r=Math.min(r,e.y),a=Math.max(a,e.x+n),o=Math.max(o,e.y+s)});let s=a-t,l=o-r;if(0===s||0===l){et({x:t,y:r},1);return}_.current&&et({x:t+s/2,y:r+l/2},e?.3:.4)},[n,Q,et]),ea=()=>ee(1);(0,a.useImperativeHandle)(t,()=>({getCanvasContainer:()=>_.current,getCanvasContent:()=>K.current,getTransform:()=>{var e,t;return{scale:A,x:(null===(e=_.current)||void 0===e?void 0:e.scrollLeft)||0,y:(null===(t=_.current)||void 0===t?void 0:t.scrollTop)||0}},getViewportCenter:$,centerOnElement:en,centerOnPoint:et,centerOnElements:er,resetZoom:ea,goToHome:Q,activatePanMode:()=>(H(e=>!e),U)}),[U]),(0,a.useEffect)(()=>{let e=_.current;if(!e)return;let t=t=>{t.ctrlKey||t.metaKey?(t.preventDefault(),ee(A+(t.deltaY>0?-.1:.1),{x:t.clientX,y:t.clientY})):t.altKey&&(t.preventDefault(),e.scrollLeft-=t.deltaX,e.scrollTop-=t.deltaY)},n=t=>{1===t.button&&(t.preventDefault(),O({isPanning:!0,startPoint:{x:t.clientX,y:t.clientY},initialScroll:{x:e.scrollLeft,y:e.scrollTop}}))},r=e=>{var t,n,r;"Space"!==e.code||e.repeat||(null===(t=document.activeElement)||void 0===t?void 0:t.tagName)==="INPUT"||(null===(n=document.activeElement)||void 0===n?void 0:n.tagName)==="TEXTAREA"||(null===(r=document.activeElement)||void 0===r?void 0:r.isContentEditable)||(e.preventDefault(),H(!0))},a=e=>{"Space"===e.code&&(e.preventDefault(),H(!1))};return e.addEventListener("wheel",t,{passive:!1}),e.addEventListener("mousedown",n),window.addEventListener("keydown",r),window.addEventListener("keyup",a),()=>{e.removeEventListener("wheel",t),e.removeEventListener("mousedown",n),window.removeEventListener("keydown",r),window.removeEventListener("keyup",a)}},[A,ee]);let eo=(0,a.useMemo)(()=>n.filter(e=>"connector"!==e.type),[n]),es=(0,a.useMemo)(()=>n.filter(e=>"connector"===e.type),[n]),el=(0,a.useMemo)(()=>n,[n]),ei=(0,a.useRef)({x:0,y:0}),[ec,ed]=(0,a.useState)({x:0,y:0}),eu=(0,a.useRef)(null);return(0,a.useEffect)(()=>{let e=_.current;if(!e)return;let t=()=>{eu.current&&clearTimeout(eu.current),eu.current=setTimeout(()=>{let t={x:e.scrollLeft||0,y:e.scrollTop||0},n=Math.abs(t.x-ei.current.x),r=Math.abs(t.y-ei.current.y);(n>10||r>10)&&(ei.current=t,ed(t))},50)};return e.addEventListener("scroll",t,{passive:!0}),()=>{e.removeEventListener("scroll",t),eu.current&&clearTimeout(eu.current)}},[]),(0,r.jsxs)("div",{className:"relative w-full h-screen",children:[(0,r.jsx)("div",{ref:_,className:(0,y.cn)("relative w-full h-screen overflow-auto bg-canvas-teal",U&&"cursor-grab",(null==L?void 0:L.isPanning)&&"cursor-grabbing"),style:{backgroundColor:"#96e4e6",backgroundImage:"radial-gradient(#ffffff 1px, transparent 0)",backgroundSize:"".concat(20*A,"px ").concat(20*A,"px")},onMouseDown:e=>{if((1===e.button||0===e.button&&e.altKey)&&_.current){e.preventDefault(),O({isPanning:!0,startPoint:{x:e.clientX,y:e.clientY},initialScroll:{x:_.current.scrollLeft,y:_.current.scrollTop}});return}if(0===e.button){let t=e.target;(t===K.current||t===_.current)&&l(null,!1)}U&&_.current&&0===e.button&&(e.preventDefault(),O({isPanning:!0,startPoint:{x:e.clientX,y:e.clientY},initialScroll:{x:_.current.scrollLeft,y:_.current.scrollTop}}))},children:(0,r.jsxs)("div",{ref:K,className:"relative canvas-content",style:{width:"".concat(q.width,"px"),height:"".concat(q.height,"px"),transform:"scale(".concat(A,")"),transformOrigin:"top left"},children:[(0,r.jsxs)("svg",{className:"absolute top-0 left-0 w-full h-full pointer-events-none",style:{width:q.width,height:q.height},children:[(0,r.jsx)("defs",{children:(0,r.jsx)("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"0",refY:"3.5",orient:"auto",children:(0,r.jsx)("polygon",{points:"0 0, 10 3.5, 0 7",fill:"hsl(var(--foreground))"})})}),es.map(e=>(0,r.jsx)(tS,{...e,scale:A,offset:ec,allElements:el,onUpdate:i,deleteElement:d,onSelectElement:l,onEditElement:b,onLocateElement:x,onEditComment:z},e.id))]}),eo.filter(e=>!e.hidden).map(e=>{let t=null==s?void 0:s.includes(e.id);return(0,r.jsx)(tT,{element:e,allElements:el,scale:A,offset:ec,isSelected:t,updateElement:i,unanchorElement:c,deleteElement:d,onFormatToggle:h,onChangeNotepadFormat:g,onLocateElement:x,onSelectElement:l,onBringToFront:u,onSendToBack:p,onMoveBackward:m,onEditElement:b,onGroupElements:w,addElement:j,activatedElementId:k,onActivateDrag:E,onEditComment:z,onDuplicateElement:T,onUngroup:D,setIsDirty:S,boardId:o.id,isListening:R,liveTranscript:M,finalTranscript:F,interimTranscript:B},e.id)})]})}),(0,r.jsx)(P,{zoomIn:()=>ee(A+.1),zoomOut:()=>ee(A-.1),resetZoom:ea,scale:A,centerOnElements:er,goToHome:Q,selectedElement:C,onBringToFront:u,onSendToBack:p,onMoveBackward:m,isMobile:I})]})});tI.displayName="Canvas";var tP=n(43335),tR=n(39702),tM=n(157),tF=n(85291),tB=n(9172),tA=n(73254),tZ=n(53927),tL=n(47054),tO=n(87928),tU=n(24739),tH=n(81475),t_=n(17789),tK=n(55672),tq=n(3683),tW=n(33931),tV=n(71077);class tG extends Error{withUser(e){return new tG(this.context,e)}constructor(e,t=null){super("Firestore Permission Denied: The following request was denied by Firestore Security Rules:\n".concat(JSON.stringify({auth:t?function(e){var t;let n=e.providerData||[];return{uid:e.uid,token:{name:e.displayName,picture:e.photoURL,email:e.email,email_verified:e.emailVerified,phone_number:e.phoneNumber,firebase:{identities:n.reduce((e,t)=>(t.providerId&&(e[t.providerId]=[t.uid]),e),{}),sign_in_provider:e.isAnonymous?"anonymous":(null===(t=n[0])||void 0===t?void 0:t.providerId)||"custom"}}}}(t):null,method:e.operation,path:"/databases/(default)/documents/".concat(e.path),request:e.requestResourceData?{data:e.requestResourceData}:void 0},null,2))),this.name="FirestorePermissionError",this.context=e,this.user=t,Object.setPrototypeOf(this,tG.prototype)}}function tJ(e){let{isOpen:t,onOpenChange:n}=e,[s,i]=(0,a.useState)(""),[d,u]=(0,a.useState)(!1),p=(0,l.CU)(),{user:m}=(0,l.aF)();(0,o.useRouter)();let{toast:g}=(0,h.pm)(),x=async()=>{if(!p||!m||!s.trim()){g({variant:"destructive",title:"Error",description:"El nombre del tablero no puede estar vac\xedo."});return}u(!0);let e=(0,c.hJ)(p,"users",m.uid,"canvasBoards"),t={name:s,userId:m.uid,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)()};try{await (0,c.ET)(e,t),g({title:"Tablero Creado",description:'Se ha creado el tablero "'.concat(s,'".')}),n(!1),i("")}catch(n){console.error("Error creating new board:",n),m&&tV.s.emit("permission-error",new tG({path:e.path,operation:"create",requestResourceData:t},m))}finally{u(!1)}};return(0,r.jsx)(eR.Vq,{open:t,onOpenChange:n,children:(0,r.jsxs)(eR.cZ,{children:[(0,r.jsxs)(eR.fK,{children:[(0,r.jsx)(eR.$N,{children:"Crear Nuevo Tablero"}),(0,r.jsx)(eR.Be,{children:"Dale un nombre a tu nuevo lienzo de ideas."})]}),(0,r.jsx)("div",{className:"grid gap-4 py-4",children:(0,r.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,r.jsx)(eB._,{htmlFor:"boardName",className:"text-right",children:"Nombre"}),(0,r.jsx)(eY.I,{id:"boardName",name:"boardName",value:s,onChange:e=>i(e.target.value),className:"col-span-3",placeholder:"Ej: Ideas para mi proyecto",onKeyDown:e=>"Enter"===e.key&&x()})]})}),(0,r.jsxs)(eR.cN,{children:[(0,r.jsx)(j.z,{variant:"ghost",onClick:()=>n(!1),children:"Cancelar"}),(0,r.jsx)(j.z,{onClick:x,disabled:!s.trim()||d,children:d?"Creando...":"Crear Tablero"})]})]})})}let tY=[{name:"yellow",label:"Amarillo",className:"bg-yellow-200"},{name:"pink",label:"Rosa",className:"bg-pink-200"},{name:"blue",label:"Azul",className:"bg-blue-200"},{name:"green",label:"Verde",className:"bg-green-200"},{name:"orange",label:"Naranja",className:"bg-orange-200"},{name:"purple",label:"Morado",className:"bg-purple-200"}],tX=(0,a.forwardRef)((e,t)=>{let{label:n,icon:a,className:o,isActive:s,children:l,...i}=e,c=null==o?void 0:o.includes("bg-red-500");return(0,r.jsxs)(j.z,{ref:t,variant:"ghost",className:(0,y.cn)("flex flex-col items-center justify-center h-auto py-2 px-2 w-full text-[11px] gap-1","hover:bg-white/20 focus-visible:bg-white/20","text-white border border-white",s&&"bg-white/30 text-white hover:bg-white/40",!c&&"text-white",o),style:{backgroundColor:c?void 0:s?"rgba(255, 255, 255, 0.3)":"transparent",color:c?void 0:"#FFFFFF",border:"1px solid #FFFFFF"},...i,children:[l||a&&(0,r.jsx)(a,{className:(0,y.cn)("size-[18px]","text-white"),style:c?void 0:{color:"#FFFFFF"}}),(0,r.jsx)("span",{className:(0,y.cn)("mt-0.5 text-center leading-tight text-[9px]","text-white"),style:c?void 0:{color:"#FFFFFF",fontSize:"9px"},children:n})]})});tX.displayName="SidebarButton";let tQ=e=>{let{comments:t,onLocateElement:n}=e,[o,s]=(0,a.useState)(""),l=(0,a.useMemo)(()=>o?t.filter(e=>{let t=e.content;return((null==t?void 0:t.label)||(null==t?void 0:t.title)||(null==t?void 0:t.text)||"").toLowerCase().includes(o.toLowerCase())}):t,[t,o]);return(0,r.jsxs)(ef,{children:[(0,r.jsx)(ev,{asChild:!0,children:(0,r.jsx)(tX,{icon:e4.Z,label:"Localizadores"})}),(0,r.jsx)(ej,{side:"right",align:"start",sideOffset:5,className:"w-64",children:t.length>0?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"px-2 py-1.5 border-b",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(tr.Z,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,r.jsx)("input",{type:"text",placeholder:"Buscar localizador...",value:o,onChange:e=>s(e.target.value),className:"w-full pl-8 pr-2 py-1.5 text-sm border rounded focus:outline-none focus:ring-2 focus:ring-primary",onClick:e=>e.stopPropagation()})]})}),(0,r.jsx)("div",{className:"max-h-64 overflow-y-auto",children:l.length>0?l.map(e=>{let t=e.content,a=(null==t?void 0:t.label)||(null==t?void 0:t.title)||(null==t?void 0:t.text)||"Sin nombre";return(0,r.jsxs)(eN,{onClick:()=>n(e.id),className:"cursor-pointer",children:[(0,r.jsx)(tt.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{className:"truncate",children:a})]},e.id)}):(0,r.jsx)(eN,{disabled:!0,children:(0,r.jsx)("span",{className:"text-muted-foreground",children:"No se encontraron localizadores"})})})]}):(0,r.jsx)(eN,{disabled:!0,children:(0,r.jsx)("span",{className:"text-muted-foreground",children:"No hay localizadores"})})})]})};function t$(e){let{elements:t,boards:n,onUploadImage:s,onAddImageFromUrl:i,onPanToggle:c,isListening:d=!1,onToggleDictation:u,onRenameBoard:p,onDeleteBoard:m,onOpenNotepad:x,onLocateElement:f,addElement:v,clearCanvas:b,onExportBoardToPng:w,onFormatToggle:j,isFormatToolbarOpen:N,isPanningActive:C=!1}=e,k=(0,l.aC)(),{toast:E}=(0,h.pm)(),z=(0,o.useRouter)();g("(max-width: 768px)");let[D,S]=(0,a.useState)(!1),[I,P]=(0,a.useState)({x:20,y:80});(0,a.useEffect)(()=>{try{let e=localStorage.getItem("toolsSidebarPosition");e&&P(JSON.parse(e))}catch(e){console.error("Failed to load sidebar position from localStorage",e)}},[]);let F=(0,a.useMemo)(()=>(Array.isArray(t)?t:[]).filter(e=>"notepad"===e.type||"notepad-simple"===e.type||"test-notepad"===e.type),[t]),Z=(0,a.useMemo)(()=>(Array.isArray(F)?F:[]).filter(e=>!0!==e.hidden),[F]),L=(0,a.useMemo)(()=>(Array.isArray(F)?F:[]).filter(e=>!0===e.hidden),[F]),V=(0,a.useMemo)(()=>(Array.isArray(t)?t:[]).filter(e=>{if("comment"!==e.type)return!1;let t=e.content;return!!t&&(!!t.title||!!t.label||!!t.text)}),[t]),G=async(e,t)=>{try{await v(e,t),E({title:"Elemento creado",description:"Se ha creado un nuevo ".concat(e,".")})}catch(t){console.error("Error al crear elemento ".concat(e,":"),t),E({variant:"destructive",title:"Error",description:t.message||"No se pudo crear el elemento ".concat(e,".")})}},J=async()=>{if(k)try{await (0,tW.w7)(k),E({title:"Sesi\xf3n Cerrada",description:"Has cerrado sesi\xf3n correctamente."}),z.push("/?logout=true")}catch(e){console.error("Error al cerrar sesi\xf3n:",e),E({variant:"destructive",title:"Error",description:"No se pudo cerrar la sesi\xf3n."})}};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(tJ,{isOpen:D,onOpenChange:S}),(0,r.jsx)(M.s,{default:{x:I.x,y:I.y,width:144,height:"auto"},minWidth:144,maxWidth:144,bounds:"window",dragHandleClassName:"drag-handle",onDragStop:(e,t)=>{let n={x:t.x,y:t.y};P(n);try{localStorage.setItem("toolsSidebarPosition",JSON.stringify(n))}catch(e){console.error("Failed to save sidebar position to localStorage",e)}},className:"z-[10001]",children:(0,r.jsxs)("div",{className:"rounded-lg shadow-lg border border-white/30 p-2 flex flex-col gap-1",style:{backgroundColor:"#0b8384"},children:[(0,r.jsx)("div",{className:"drag-handle cursor-grab active:cursor-grabbing py-1 flex justify-center",children:(0,r.jsx)(et.Z,{className:"size-5",style:{color:"#FFFFFF"}})}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-1",children:[(0,r.jsxs)(ef,{children:[(0,r.jsx)(ev,{asChild:!0,children:(0,r.jsx)(tX,{icon:tP.Z,label:"Tableros"})}),(0,r.jsxs)(ej,{side:"right",align:"start",sideOffset:5,children:[(0,r.jsxs)(eN,{onClick:()=>S(!0),children:[(0,r.jsx)(ee.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Nuevo Tablero"})]}),(0,r.jsxs)(eN,{onClick:m,className:"text-destructive",children:[(0,r.jsx)(R.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Eliminar Tablero"})]}),(0,r.jsx)(eC,{}),n.length>0&&(0,r.jsxs)(eb,{children:[(0,r.jsx)(ew,{children:(0,r.jsx)("span",{children:"Abrir Tablero..."})}),(0,r.jsx)(ey,{children:n.map(e=>(0,r.jsx)(eN,{onClick:()=>z.push("/board/".concat(e.id)),children:(0,r.jsx)("span",{children:e.name||"Sin nombre"})},e.id))})]})]})]}),(0,r.jsx)(tX,{icon:tR.Z,label:d?"Detener":"Dictar",onClick:u,onMouseDown:e=>e.preventDefault(),className:(0,y.cn)(d&&"bg-red-500 text-white hover:bg-red-600 animate-pulse")}),(0,r.jsxs)(ef,{children:[(0,r.jsx)(ev,{asChild:!0,children:(0,r.jsx)(tX,{icon:tM.Z,label:"Cuadernos"})}),(0,r.jsxs)(ej,{side:"right",align:"start",sideOffset:5,children:[(0,r.jsxs)(eN,{onClick:()=>G("notepad"),children:[(0,r.jsx)(ee.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Agregar notepad"})]}),(0,r.jsxs)(eN,{onClick:()=>G("yellow-notepad"),children:[(0,r.jsx)(ee.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Nuevo Notepad Yellow"})]}),(0,r.jsxs)(eN,{onClick:()=>f("rzBhqCTd8wwZmD8JCNEk"),children:[(0,r.jsx)(ee.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Nuevo Block de Notas"})]}),Z.length>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eC,{}),(0,r.jsxs)(eb,{children:[(0,r.jsx)(ew,{children:(0,r.jsxs)("span",{children:["Cuadernos Abiertos (",Z.length,")"]})}),(0,r.jsx)(ey,{children:Z.map(e=>{let t=e.content,n=(null==t?void 0:t.title)||"Sin t\xedtulo";return(0,r.jsx)(eN,{onClick:()=>f(e.id),children:(0,r.jsx)("span",{children:n})},e.id)})})]})]}),L.length>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eC,{}),(0,r.jsxs)(eb,{children:[(0,r.jsx)(ew,{children:(0,r.jsxs)("span",{children:["Cerrados (",L.length,")"]})}),(0,r.jsx)(ey,{children:L.map(e=>{let t=e.content,n=(null==t?void 0:t.title)||"Sin t\xedtulo";return(0,r.jsxs)(eN,{onClick:()=>x(e.id),children:[(0,r.jsx)(tF.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:n})]},e.id)})})]})]})]})]}),(0,r.jsxs)(ef,{children:[(0,r.jsx)(ev,{asChild:!0,children:(0,r.jsx)(tX,{icon:tB.Z,label:"Notas"})}),(0,r.jsx)(ej,{side:"right",align:"start",sideOffset:5,children:tY.map(e=>(0,r.jsxs)(eN,{onClick:()=>G("sticky",{color:e.name}),children:[(0,r.jsx)("div",{className:(0,y.cn)("w-4 h-4 rounded-sm mr-2 border border-slate-300",e.className)}),(0,r.jsx)("span",{className:"capitalize",children:e.label})]},e.name))})]}),(0,r.jsx)(tX,{icon:tA.Z,label:"To-do",onClick:()=>G("todo")}),(0,r.jsx)(tX,{icon:el.Z,label:"Tools",onClick:j,isActive:N}),(0,r.jsxs)(ef,{children:[(0,r.jsx)(ev,{asChild:!0,children:(0,r.jsx)(tX,{icon:ts.Z,label:"Imagen"})}),(0,r.jsxs)(ej,{side:"right",align:"start",sideOffset:5,children:[(0,r.jsxs)(eN,{onClick:i,children:[(0,r.jsx)(e9.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Desde URL"})]}),(0,r.jsxs)(eN,{onClick:s,children:[(0,r.jsx)(tZ.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Subir"})]})]})]}),(0,r.jsx)(tX,{icon:tL.Z,label:"Moodboard",onClick:()=>G("moodboard")}),(0,r.jsx)(tX,{icon:tO.Z,label:"Bloc Tabs",onClick:()=>G("tabbed-notepad")}),(0,r.jsxs)(eH,{children:[(0,r.jsx)(e_,{asChild:!0,children:(0,r.jsx)(tX,{icon:tO.Z,label:"Texto"})}),(0,r.jsxs)(eK,{className:"w-auto p-2",children:[(0,r.jsx)("div",{className:"text-xs text-gray-600 mb-2",children:"Color de fondo"}),(0,r.jsx)("div",{className:"grid grid-cols-4 gap-2",children:[{name:"white",value:"#ffffff",label:"Blanco"},{name:"yellow",value:"#fffb8b",label:"Amarillo"},{name:"pink",value:"#ffc2d4",label:"Rosa"},{name:"blue",value:"#bce8f1",label:"Azul"},{name:"green",value:"#d4edda",label:"Verde"},{name:"orange",value:"#ffeeba",label:"Naranja"},{name:"purple",value:"#e9d5ff",label:"Morado"}].map(e=>(0,r.jsx)("button",{className:"w-8 h-8 rounded border border-gray-300 hover:scale-110 transition-transform",style:{backgroundColor:e.value},onClick:()=>G("text",{properties:{backgroundColor:e.value}}),title:e.label},e.name))})]})]}),(0,r.jsx)(tX,{icon:T.Z,label:"Acorde\xf3n",onClick:()=>G("accordion",{content:{items:[{id:"1",title:"Nuevo Item",content:""}]},properties:{position:{x:200,y:100},size:{width:320,height:240}}})}),(0,r.jsx)(tQ,{comments:V,onLocateElement:f}),(0,r.jsx)(tX,{icon:tU.Z,label:"Cron\xf3metro",onClick:()=>G("stopwatch")}),(0,r.jsx)(tX,{icon:tH.Z,label:"Temporizador",onClick:()=>G("countdown")}),(0,r.jsx)(tX,{icon:t_.Z,label:"Destacador",onClick:()=>G("highlight-text")}),(0,r.jsx)(tX,{icon:ed.Z,label:"Exportar Tablero",onClick:w}),(0,r.jsxs)(ef,{children:[(0,r.jsx)(ev,{asChild:!0,children:(0,r.jsx)(tX,{icon:tK.Z,label:"M\xe1s"})}),(0,r.jsxs)(ej,{side:"right",align:"start",sideOffset:5,children:[(0,r.jsxs)(eN,{onClick:j,children:[(0,r.jsx)(el.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Formato de Texto"})]}),(0,r.jsxs)(eN,{onClick:w,children:[(0,r.jsx)(ed.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Exportar a PNG: alta resoluci\xf3n"})]}),(0,r.jsx)(eC,{}),(0,r.jsxs)(B,{children:[(0,r.jsx)(A,{asChild:!0,children:(0,r.jsxs)(eN,{onSelect:e=>e.preventDefault(),children:[(0,r.jsx)(R.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Eliminar Tablero"})]})}),(0,r.jsxs)(O,{children:[(0,r.jsxs)(U,{children:[(0,r.jsx)(_,{children:"\xbfEst\xe1s seguro?"}),(0,r.jsx)(K,{children:"Esta acci\xf3n eliminar\xe1 permanentemente este tablero y todo su contenido. Esta acci\xf3n no se puede deshacer."})]}),(0,r.jsxs)(H,{children:[(0,r.jsx)(W,{children:"Cancelar"}),(0,r.jsx)(q,{onClick:m,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"S\xed, eliminar tablero"})]})]})]}),(0,r.jsxs)(B,{children:[(0,r.jsx)(A,{asChild:!0,children:(0,r.jsxs)(eN,{onSelect:e=>e.preventDefault(),children:[(0,r.jsx)(R.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Limpiar Tablero"})]})}),(0,r.jsxs)(O,{children:[(0,r.jsxs)(U,{children:[(0,r.jsx)(_,{children:"\xbfEst\xe1s seguro?"}),(0,r.jsx)(K,{children:"Esta acci\xf3n eliminar\xe1 todos los elementos del tablero. Esta acci\xf3n no se puede deshacer."})]}),(0,r.jsxs)(H,{children:[(0,r.jsx)(W,{children:"Cancelar"}),(0,r.jsx)(q,{onClick:b,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"S\xed, limpiar tablero"})]})]})]}),(0,r.jsx)(eC,{}),(0,r.jsxs)(eN,{onClick:J,children:[(0,r.jsx)(tq.Z,{className:"mr-2 h-4 w-4"}),(0,r.jsx)("span",{children:"Cerrar Sesi\xf3n"})]})]})]})]})]})})]})}var t0=n(17290),t1=n(40769),t2=n(53622),t4=n(63382),t3=n(81952),t5=n(42229),t8=n(32157),t7=n(94594),t6=n(38755),t9=n(80422),ne=n(77497),nt=e=>{var t;let{isOpen:n,onClose:o,onAddComment:s,onEditComment:l,isMobileSheet:i,elements:c,onLocateElement:d,onPanToggle:u,addElement:p,isPanningActive:m=!1}=e,[h,g]=(0,a.useState)(null),[x,f]=(0,a.useState)("18px"),[v,b]=(0,a.useState)({x:0,y:0}),[w,j]=(0,a.useState)(!1),[N,C]=(0,a.useState)("");(0,a.useEffect)(()=>{if(n&&!i){let e=localStorage.getItem("formattingToolbarPosition");if(e)try{b(JSON.parse(e))}catch(e){console.error("Failed to load formatting toolbar position",e)}else b({x:(window.innerWidth-600)/2,y:20})}},[n,i]);let k=async()=>{if(p)try{await p("container",{content:{title:"Lienzo",elementIds:[]},properties:{position:{x:100,y:100},size:{width:794,height:1021},backgroundColor:"white"}})}catch(e){console.error("Error creating lienzo:",e)}},E=(e,t,n)=>{e.preventDefault();let r=window.getSelection();if(!r||0===r.rangeCount){let e=document.activeElement;e&&(e.isContentEditable||"DIV"===e.tagName)&&(e.focus(),n?document.execCommand(t,!1,n):document.execCommand(t,!1));return}n?document.execCommand(t,!1,n):document.execCommand(t,!1),g(null)},z=(e,t)=>{e.preventDefault();let n=window.getSelection();if(!n||0===n.rangeCount||n.isCollapsed)return;let r=n.getRangeAt(0),a=document.createElement("span");a.style.textDecoration="underline",a.style.textDecorationColor=t,a.style.textDecorationThickness="2px",a.appendChild(r.extractContents()),r.insertNode(a),g(null)},D=(e,t)=>{e.preventDefault(),e.stopPropagation();let n=window.getSelection();if(!n||0===n.rangeCount){let e=document.activeElement;e&&e.isContentEditable&&(e.style.color=t,e.dispatchEvent(new Event("input",{bubbles:!0}))),g(null);return}if(n.isCollapsed){let e=n.getRangeAt(0).commonAncestorContainer,r=e.nodeType===Node.TEXT_NODE?e.parentElement:e;r&&r.isContentEditable&&(r.style.color=t,r.dispatchEvent(new Event("input",{bubbles:!0}))),g(null);return}let r=n.getRangeAt(0),a=document.createElement("span");a.style.color=t;try{a.appendChild(r.extractContents()),r.insertNode(a),r.setStartAfter(a),r.collapse(!0),n.removeAllRanges(),n.addRange(r);let e=document.activeElement;e&&e.dispatchEvent(new Event("input",{bubbles:!0}))}catch(e){console.error("Error aplicando color:",e)}g(null)};if(!n)return null;let S=(0,y.cn)("bg-black text-white py-1.5 px-2.5","flex items-center justify-center w-full min-h-[38px] gap-0.5","text-sm"),I=(0,y.cn)("bg-white border-none rounded-md px-2.5 py-1.5","cursor-pointer flex items-center justify-center","min-w-[29px] h-7 transition-colors","hover:bg-gray-100"),P="w-[14px] h-[14px] text-black",R=(0,y.cn)("bg-[#2a2a2a] border-none rounded","cursor-pointer flex items-center justify-center","w-7 h-7 p-1.5 transition-colors","hover:bg-[#3a3a3a]"),F=c.length>0&&(null===(t=c[0])||void 0===t?void 0:t.type)==="comment"?c[0]:null,B=(0,r.jsxs)("div",{className:S,children:[F&&l&&(0,r.jsx)("button",{className:I,onClick:e=>{e.preventDefault(),e.stopPropagation(),l(F)},title:"Fijar posici\xf3n en el tablero / Editar Etiqueta",children:(0,r.jsx)(tt.Z,{className:P})}),(0,r.jsxs)(ef,{children:[(0,r.jsx)(ev,{asChild:!0,children:(0,r.jsx)("button",{className:R,title:"M\xe1s opciones",onClick:e=>{e.preventDefault(),e.stopPropagation()},children:(0,r.jsx)(ec.Z,{className:"w-[14px] h-[14px] text-white"})})}),(0,r.jsx)(ej,{children:(0,r.jsx)(eN,{onClick:e=>{e.preventDefault(),e.stopPropagation()},children:(0,r.jsx)("span",{children:"Opciones"})})})]}),(0,r.jsx)("button",{className:I,onClick:e=>{e.preventDefault(),e.stopPropagation(),s&&s()},title:"Crear etiqueta de posici\xf3n",children:(0,r.jsx)(e4.Z,{className:P})}),(0,r.jsxs)(eH,{open:"fontSize"===h,onOpenChange:e=>g(e?"fontSize":null),children:[(0,r.jsx)(e_,{asChild:!0,children:(0,r.jsx)("button",{className:I,title:"Tama\xf1o de Texto",onMouseDown:e=>e.preventDefault(),children:(0,r.jsx)(t0.Z,{className:P})})}),(0,r.jsx)(eK,{className:"w-auto p-2 bg-white",onMouseDown:e=>e.preventDefault(),children:(0,r.jsx)("div",{className:"space-y-1",children:["12px","14px","16px","18px","20px","24px","32px"].map(e=>(0,r.jsx)("button",{className:"w-full text-left px-2 py-1 text-sm hover:bg-gray-100 rounded",onClick:t=>{t.preventDefault(),t.stopPropagation(),f(e);let n=window.getSelection();if(n&&n.rangeCount>0){let t=n.getRangeAt(0),r=document.createElement("span");r.style.fontSize=e;try{t.surroundContents(r)}catch(e){r.appendChild(t.extractContents()),t.insertNode(r)}}g(null)},children:e},e))})})]}),(0,r.jsx)("div",{className:"w-px h-6 bg-white/30 mx-1"}),(0,r.jsx)("button",{className:I,onClick:e=>{e.preventDefault(),e.stopPropagation();let t=window.getSelection(),n=prompt("Ingresa la URL del enlace:");if(n){if(t&&t.rangeCount>0&&!t.isCollapsed){let e=t.getRangeAt(0),r=document.createElement("a");r.href=n,r.target="_blank",r.rel="noopener noreferrer",r.appendChild(e.extractContents()),e.insertNode(r)}else{let e=document.createElement("a");e.href=n,e.target="_blank",e.rel="noopener noreferrer",e.textContent=n,document.execCommand("insertHTML",!1,e.outerHTML)}}},title:"Insertar Enlace",children:(0,r.jsx)(e9.Z,{className:P})}),(0,r.jsx)("div",{className:"w-px h-6 bg-white/30 mx-1"}),(0,r.jsxs)(eH,{open:"textColor"===h,onOpenChange:e=>g(e?"textColor":null),children:[(0,r.jsx)(e_,{asChild:!0,children:(0,r.jsx)("button",{className:I,title:"Color de Texto",onMouseDown:e=>e.preventDefault(),children:(0,r.jsx)(eW.Z,{className:P})})}),(0,r.jsxs)(eK,{className:"w-auto p-2 bg-white",onMouseDown:e=>e.preventDefault(),children:[(0,r.jsx)("div",{className:"text-xs text-gray-600 mb-2 px-1",children:"Color de texto"}),(0,r.jsx)("div",{className:"grid grid-cols-4 gap-2",children:[{value:"#14b8a6"},{value:"#f97316"},{value:"#84cc16"},{value:"#eab308"},{value:"#f59e0b"},{value:"#3b82f6"},{value:"#1f2937"},{value:"#475569"}].map((e,t)=>(0,r.jsx)("button",{className:"w-8 h-8 rounded border border-gray-300 hover:scale-110 transition-transform",style:{backgroundColor:e.value},onMouseDown:t=>D(t,e.value),title:"Color ".concat(t+1)},t))})]})]}),(0,r.jsx)("div",{className:"w-px h-6 bg-white/30 mx-1"}),(()=>{let e=window.getSelection();return e&&e.rangeCount>0&&!e.isCollapsed?(0,r.jsxs)(eH,{open:"highlight"===h,onOpenChange:e=>g(e?"highlight":null),children:[(0,r.jsx)(e_,{asChild:!0,children:(0,r.jsx)("button",{className:I,title:"Resaltar Texto",onMouseDown:e=>e.preventDefault(),children:(0,r.jsx)(eW.Z,{className:P})})}),(0,r.jsxs)(eK,{className:"w-auto p-2 bg-white",onMouseDown:e=>e.preventDefault(),children:[(0,r.jsx)("div",{className:"text-xs text-gray-600 mb-2 px-1",children:"Color de fondo"}),(0,r.jsx)("div",{className:"grid grid-cols-4 gap-2",children:[{value:"#fef08a"},{value:"#fde68a"},{value:"#fed7aa"},{value:"#fecaca"},{value:"#fbcfe8"},{value:"#e9d5ff"},{value:"#ddd6fe"},{value:"#c7d2fe"}].map((e,t)=>(0,r.jsx)("button",{className:"w-8 h-8 rounded border border-gray-300 hover:scale-110 transition-transform",style:{backgroundColor:e.value},onMouseDown:t=>{t.preventDefault();let n=window.getSelection();if(n&&n.rangeCount>0&&!n.isCollapsed){let t=n.getRangeAt(0),r=document.createElement("span");r.style.backgroundColor=e.value;try{r.appendChild(t.extractContents()),t.insertNode(r),t.setStartAfter(r),t.collapse(!0),n.removeAllRanges(),n.addRange(t);let e=document.activeElement;e&&e.dispatchEvent(new Event("input",{bubbles:!0}))}catch(e){console.error("Error aplicando resaltado:",e)}}g(null)},title:"Resaltado ".concat(t+1)},t))})]})]}):null})(),(0,r.jsx)("div",{className:"w-px h-6 bg-white/30 mx-1"}),(0,r.jsxs)(eH,{open:"underlineColor"===h,onOpenChange:e=>g(e?"underlineColor":null),children:[(0,r.jsx)(e_,{asChild:!0,children:(0,r.jsx)("button",{className:I,title:"Subrayado",onMouseDown:e=>e.preventDefault(),children:(0,r.jsx)(t1.Z,{className:P})})}),(0,r.jsxs)(eK,{className:"w-auto p-2 bg-white",onMouseDown:e=>e.preventDefault(),children:[(0,r.jsx)("div",{className:"text-xs text-gray-600 mb-2 px-1",children:"Subrayado de"}),(0,r.jsx)("div",{className:"grid grid-cols-4 gap-2",children:[{value:"#14b8a6"},{value:"#f97316"},{value:"#84cc16"},{value:"#eab308"},{value:"#f59e0b"},{value:"#3b82f6"},{value:"#1f2937"},{value:"#475569"}].map((e,t)=>(0,r.jsx)("button",{className:"w-8 h-8 rounded border border-gray-300 hover:scale-110 transition-transform",style:{backgroundColor:e.value},onMouseDown:t=>z(t,e.value),title:"Color ".concat(t+1)},t))})]})]}),(0,r.jsx)("button",{className:I,onMouseDown:e=>E(e,"bold"),title:"Negrita",children:(0,r.jsx)(t2.Z,{className:P})}),(0,r.jsx)("button",{className:I,onMouseDown:e=>E(e,"italic"),title:"Cursiva",children:(0,r.jsx)(t4.Z,{className:P})}),(0,r.jsx)("button",{className:I,onMouseDown:e=>E(e,"strikeThrough"),title:"Tachado",children:(0,r.jsx)(t3.Z,{className:P})}),(0,r.jsx)("div",{className:"w-px h-6 bg-white/30 mx-1"}),(0,r.jsxs)(ef,{children:[(0,r.jsx)(ev,{asChild:!0,children:(0,r.jsxs)("button",{className:I,title:"Alinear Texto",children:[(0,r.jsx)(t5.Z,{className:P}),(0,r.jsx)(T.Z,{className:"h-3 w-3 ml-0.5"})]})}),(0,r.jsxs)(ej,{children:[(0,r.jsxs)(eN,{onMouseDown:e=>E(e,"justifyLeft"),children:[(0,r.jsx)(t5.Z,{className:"h-4 w-4 mr-2"}),"Alinear Izquierda"]}),(0,r.jsxs)(eN,{onMouseDown:e=>E(e,"justifyCenter"),children:[(0,r.jsx)(t8.Z,{className:"h-4 w-4 mr-2"}),"Centrar"]}),(0,r.jsxs)(eN,{onMouseDown:e=>E(e,"justifyRight"),children:[(0,r.jsx)(t7.Z,{className:"h-4 w-4 mr-2"}),"Alinear Derecha"]}),(0,r.jsxs)(eN,{onMouseDown:e=>E(e,"justifyFull"),children:[(0,r.jsx)(t6.Z,{className:"h-4 w-4 mr-2"}),"Justificar"]})]})]}),(0,r.jsx)("div",{className:"w-px h-6 bg-white/30 mx-1"}),(0,r.jsx)("button",{className:I,onClick:e=>{e.preventDefault();let t=document.createElement("span");t.style.color="#a0a1a6",t.textContent="-- ".concat((0,ek.WU)(new Date,"dd/MM/yy")," "),document.execCommand("insertHTML",!1,t.outerHTML)},title:"Insertar Fecha",children:(0,r.jsx)(ta.Z,{className:P})}),(0,r.jsx)("div",{className:"w-px h-6 bg-white/30 mx-1"}),(0,r.jsx)("button",{className:I,onMouseDown:e=>{e.preventDefault(),document.execCommand("removeFormat",!1);let t=window.getSelection();if(t&&t.rangeCount>0){let e=t.getRangeAt(0).commonAncestorContainer;e.nodeType===Node.ELEMENT_NODE&&e.querySelectorAll('span[style*="text-decoration"]').forEach(e=>{let t=e.parentNode;t&&(t.replaceChild(document.createTextNode(e.textContent||""),e),t.normalize())})}},title:"Limpiar Formato",children:(0,r.jsx)(es.Z,{className:P})}),(0,r.jsx)("button",{className:(0,y.cn)(I,m&&"bg-gray-200"),onClick:u,title:"Mover",children:(0,r.jsx)(t9.Z,{className:P})}),(0,r.jsx)("button",{className:I,onClick:k,title:"Lienzo",children:(0,r.jsx)(ne.Z,{className:P})}),(0,r.jsx)("button",{className:R,onClick:o,title:"Cerrar",children:(0,r.jsx)(em.Z,{className:"w-[14px] h-[14px] text-white"})})]});return i?B:(0,r.jsxs)(M.s,{size:{width:"auto",height:"auto"},position:v,onDragStop:(e,t)=>{let n={x:t.x,y:t.y};b(n);try{localStorage.setItem("formattingToolbarPosition",JSON.stringify(n))}catch(e){console.error("Failed to save formatting toolbar position",e)}},dragHandleClassName:"drag-handle",bounds:"window",enableResizing:!1,className:"z-[60000] pointer-events-auto",children:[(0,r.jsx)("div",{className:"drag-handle cursor-grab active:cursor-grabbing py-1 text-slate-800 flex justify-center mb-1",children:(0,r.jsx)(et.Z,{className:"size-4"})}),B]})};function nn(e){let{isOpen:t,onOpenChange:n,onAddImage:o}=e,[s,l]=(0,a.useState)("");return(0,r.jsx)(eR.Vq,{open:t,onOpenChange:n,children:(0,r.jsxs)(eR.cZ,{children:[(0,r.jsxs)(eR.fK,{children:[(0,r.jsx)(eR.$N,{children:"A\xf1adir Imagen desde URL"}),(0,r.jsx)(eR.Be,{children:"Pega la URL completa de la imagen que deseas a\xf1adir al lienzo."})]}),(0,r.jsx)("div",{className:"grid gap-4 py-4",children:(0,r.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,r.jsx)(eB._,{htmlFor:"imageUrl",className:"text-right",children:"URL"}),(0,r.jsx)(eY.I,{id:"imageUrl",name:"imageUrl",value:s,onChange:e=>l(e.target.value),className:"col-span-3",placeholder:"https://..."})]})}),(0,r.jsxs)(eR.cN,{children:[(0,r.jsx)(j.z,{variant:"ghost",onClick:()=>n(!1),children:"Cancelar"}),(0,r.jsx)(j.z,{onClick:()=>{s&&o(s)},disabled:!s,children:"A\xf1adir Imagen"})]})]})})}var nr=n(42325);let na=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(nr.fC,{className:(0,y.cn)("grid gap-2",n),...a,ref:t})});na.displayName=nr.fC.displayName;let no=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(nr.ck,{ref:t,className:(0,y.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),...a,children:(0,r.jsx)(nr.z$,{className:"flex items-center justify-center",children:(0,r.jsx)(ex.Z,{className:"h-2.5 w-2.5 fill-current text-current"})})})});no.displayName=nr.ck.displayName;let ns=[{id:"letter",label:'Carta (8.5" x 11")',description:"Formato est\xe1ndar para documentos."},{id:"10x15",label:"Ficha (10cm x 15cm)",description:"Ideal para notas r\xe1pidas y fichas de estudio."}];function nl(e){let{isOpen:t,onOpenChange:n,notepad:o,onSaveFormat:s}=e,[l,i]=(0,a.useState)("letter");return(0,a.useEffect)(()=>{if(o){var e;i((null===(e=o.properties)||void 0===e?void 0:e.format)||"letter")}},[o]),(0,r.jsx)(eR.Vq,{open:t,onOpenChange:n,children:(0,r.jsxs)(eR.cZ,{children:[(0,r.jsx)(eR.fK,{children:(0,r.jsx)(eR.$N,{children:"Cambiar Formato del Cuaderno"})}),(0,r.jsx)("div",{className:"py-4",children:(0,r.jsx)(na,{value:l,onValueChange:e=>i(e),children:ns.map(e=>(0,r.jsxs)(eB._,{htmlFor:e.id,className:"flex items-start space-x-3 p-4 rounded-md border hover:bg-accent cursor-pointer",children:[(0,r.jsx)(no,{value:e.id,id:e.id}),(0,r.jsxs)("div",{className:"grid gap-1.5",children:[(0,r.jsx)("span",{className:"font-semibold",children:e.label}),(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:e.description})]})]},e.id))})}),(0,r.jsxs)(eR.cN,{children:[(0,r.jsx)(j.z,{variant:"outline",onClick:()=>n(!1),children:"Cancelar"}),(0,r.jsx)(j.z,{onClick:()=>{(null==o?void 0:o.id)&&s(o.id,l)},children:"Guardar Cambios"})]})]})})}let ni=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)("textarea",{className:(0,y.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",n),ref:t,...a})});function nc(e){let{isOpen:t,onOpenChange:n,comment:o,onUpdate:s,onDelete:l}=e,[i,c]=(0,a.useState)(""),[d,u]=(0,a.useState)(""),[p,m]=(0,a.useState)(""),{toast:g}=(0,h.pm)(),x=(0,a.useRef)(null),f=(0,a.useRef)(null),v=(0,a.useRef)(null);(0,a.useEffect)(()=>{if(t&&o&&o.content){let e=o.content;c(e.title||""),u(e.label||""),m(e.text||"")}else c(""),u(""),m("")},[t,o]);let{saveStatus:b,handleBlur:w,handleChange:y}=ez({getContent:()=>{var e;return(null===(e=x.current)||void 0===e?void 0:e.value)||i},onSave:async e=>{if(e!==i&&o){let t=o.content;s(o.id,{content:{...t,title:e}})}},debounceMs:2e3,compareContent:(e,t)=>e===t,disabled:!t}),{saveStatus:N,handleBlur:C,handleChange:k}=ez({getContent:()=>{var e;return(null===(e=f.current)||void 0===e?void 0:e.value)||d},onSave:async e=>{if(e!==d&&o){let t=o.content;s(o.id,{content:{...t,label:e}})}},debounceMs:2e3,compareContent:(e,t)=>e===t,disabled:!t}),{saveStatus:E,handleBlur:z,handleChange:T}=ez({getContent:()=>{var e;return(null===(e=v.current)||void 0===e?void 0:e.value)||p},onSave:async e=>{if(e!==p&&o){let t=o.content;s(o.id,{content:{...t,text:e}})}},debounceMs:2e3,compareContent:(e,t)=>e===t,disabled:!t});return(0,r.jsx)(eR.Vq,{open:t,onOpenChange:n,children:(0,r.jsxs)(eR.cZ,{className:"sm:max-w-[425px]",children:[(0,r.jsxs)(eR.fK,{children:[(0,r.jsx)(eR.$N,{children:"Editar Comentario"}),(0,r.jsx)(eR.Be,{children:"Realiza cambios en tu comentario aqu\xed. Haz clic en guardar cuando hayas terminado."})]}),(0,r.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,r.jsx)(eB._,{htmlFor:"title",className:"text-right",children:"T\xedtulo"}),(0,r.jsxs)("div",{className:"col-span-3 relative",children:[(0,r.jsx)(eY.I,{ref:x,id:"title",value:i,onChange:e=>{c(e.target.value),y()},onBlur:w,className:"pr-8",placeholder:"T\xedtulo del comentario (opcional)"}),(0,r.jsx)("div",{className:"absolute top-2 right-2",children:(0,r.jsx)(eI,{status:b,size:"sm"})})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,r.jsx)(eB._,{htmlFor:"label",className:"text-right",children:"Etiqueta"}),(0,r.jsxs)("div",{className:"col-span-3 relative",children:[(0,r.jsx)(eY.I,{ref:f,id:"label",value:d,onChange:e=>{u(e.target.value),k()},onBlur:C,className:"pr-8",placeholder:"Etiqueta corta (opcional)"}),(0,r.jsx)("div",{className:"absolute top-2 right-2",children:(0,r.jsx)(eI,{status:N,size:"sm"})})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-4 items-start gap-4",children:[" ",(0,r.jsx)(eB._,{htmlFor:"commentText",className:"text-right mt-2",children:"Texto"}),(0,r.jsxs)("div",{className:"col-span-3 relative",children:[(0,r.jsx)(ni,{ref:v,id:"commentText",value:p,onChange:e=>{m(e.target.value),T()},onBlur:z,className:"h-24 pr-8",placeholder:"Escribe tu comentario aqu\xed..."}),(0,r.jsx)("div",{className:"absolute top-2 right-2",children:(0,r.jsx)(eI,{status:E,size:"sm"})})]})]})]}),(0,r.jsxs)(eR.cN,{children:[(0,r.jsxs)(B,{children:[(0,r.jsx)(A,{asChild:!0,children:(0,r.jsxs)(j.z,{variant:"destructive",className:"mr-auto",children:[(0,r.jsx)(R.Z,{className:"mr-2 h-4 w-4"})," Eliminar"]})}),(0,r.jsxs)(O,{children:[(0,r.jsxs)(U,{children:[(0,r.jsx)(_,{children:"\xbfEst\xe1s seguro de eliminar este comentario?"}),(0,r.jsx)(K,{children:"Esta acci\xf3n no se puede deshacer. Esto eliminar\xe1 permanentemente tu comentario."})]}),(0,r.jsxs)(H,{children:[(0,r.jsx)(W,{children:"Cancelar"}),(0,r.jsx)(q,{onClick:()=>{o&&(l(o.id),g({variant:"destructive",title:"Comentario Eliminado",description:"El comentario ha sido borrado permanentemente."}),n(!1))},className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Eliminar"})]})]})]}),(0,r.jsx)(j.z,{variant:"outline",onClick:()=>n(!1),children:"Cancelar"}),(0,r.jsx)(j.z,{onClick:()=>{o&&(w(),C(),z(),s(o.id,{content:{...o.content,title:i,label:d,text:p}}),g({title:"Comentario Actualizado",description:"El comentario ha sido guardado."}),n(!1))},children:"Guardar cambios"})]})]})})}function nd(e){let{element:t,isVisible:n,onClose:o}=e,[s,l]=(0,a.useState)(!1);if(!n||!t)return null;let i=async()=>{try{await navigator.clipboard.writeText(t.id),l(!0),setTimeout(()=>l(!1),2e3)}catch(e){console.error("Error al copiar ID:",e)}},c="object"==typeof t.properties&&null!==t.properties?t.properties:{},d=c.position||{x:t.x||0,y:t.y||0},u=c.size||{width:t.width||0,height:t.height||0};return(0,r.jsxs)(G,{className:"fixed top-4 right-4 w-80 z-[9999] shadow-xl border-2 border-blue-500 bg-white",children:[(0,r.jsx)(J,{className:"pb-2",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h3",{className:"text-sm font-semibold text-gray-800 flex items-center gap-2",children:"\uD83D\uDCCB Informaci\xf3n del Elemento"}),(0,r.jsx)(j.z,{variant:"ghost",size:"icon",className:"h-5 w-5",onClick:o,children:(0,r.jsx)(em.Z,{className:"h-4 w-4"})})]})}),(0,r.jsxs)(Y,{className:"space-y-3 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium text-gray-600",children:"Tipo:"}),(0,r.jsx)("span",{className:"ml-2 text-gray-800 capitalize",children:t.type})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium text-gray-600",children:"ID:"}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,r.jsx)("code",{className:"text-xs bg-gray-100 px-2 py-1 rounded flex-1 truncate",children:t.id}),(0,r.jsx)(j.z,{variant:"outline",size:"icon",className:"h-7 w-7 flex-shrink-0",onClick:i,title:"Copiar ID",children:s?(0,r.jsx)(eg.Z,{className:"h-3 w-3 text-green-600"}):(0,r.jsx)(eQ.Z,{className:"h-3 w-3"})})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium text-gray-600",children:"Posici\xf3n:"}),(0,r.jsxs)("div",{className:"ml-2 mt-1 text-gray-800",children:[(0,r.jsxs)("div",{children:["X: ",Math.round(d.x),"px"]}),(0,r.jsxs)("div",{children:["Y: ",Math.round(d.y),"px"]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium text-gray-600",children:"Tama\xf1o:"}),(0,r.jsxs)("div",{className:"ml-2 mt-1 text-gray-800",children:[(0,r.jsxs)("div",{children:["Ancho: ",Math.round("number"==typeof u.width?u.width:0),"px"]}),(0,r.jsxs)("div",{children:["Alto: ",Math.round("number"==typeof u.height?u.height:0),"px"]})]})]}),void 0!==t.zIndex&&(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium text-gray-600",children:"Z-Index:"}),(0,r.jsx)("span",{className:"ml-2 text-gray-800",children:t.zIndex})]}),t.parentId&&(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium text-gray-600",children:"Padre:"}),(0,r.jsxs)("code",{className:"ml-2 text-xs bg-gray-100 px-2 py-1 rounded",children:[t.parentId.substring(0,8),"..."]})]}),"container"===t.type&&(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium text-gray-600",children:"Elementos:"}),(0,r.jsx)("span",{className:"ml-2 text-gray-800",children:"object"==typeof t.content&&null!==t.content&&"elementIds"in t.content?t.content.elementIds.length:0})]}),"sticky"===t.type&&t.color&&(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-medium text-gray-600",children:"Color:"}),(0,r.jsxs)("div",{className:"ml-2 mt-1 flex items-center gap-2",children:[(0,r.jsx)("div",{className:"w-4 h-4 rounded border border-gray-300",style:{backgroundColor:t.color}}),(0,r.jsx)("span",{className:"text-gray-800",children:t.color})]})]})]})]})}function nu(e){let{isOpen:t,onOpenChange:n,currentBoardName:o,onSave:s}=e,[l,i]=(0,a.useState)(o);(0,a.useEffect)(()=>{t&&i(o)},[t,o]);let c=()=>{l.trim()&&s(l),n(!1)};return(0,r.jsx)(eR.Vq,{open:t,onOpenChange:e=>{e?n(!0):c()},children:(0,r.jsxs)(eR.cZ,{onInteractOutside:c,children:[(0,r.jsxs)(eR.fK,{children:[(0,r.jsx)(eR.$N,{children:"Renombrar Tablero"}),(0,r.jsx)(eR.Be,{children:"El tablero se guardar\xe1 autom\xe1ticamente cuando cierres este di\xe1logo o presiones Enter."})]}),(0,r.jsx)("div",{className:"grid gap-4 py-4",children:(0,r.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,r.jsx)(eB._,{htmlFor:"boardName",className:"text-right",children:"Nombre"}),(0,r.jsx)(eY.I,{id:"boardName",name:"boardName",value:l,onChange:e=>i(e.target.value),className:"col-span-3",onKeyDown:e=>{"Enter"===e.key&&c()},onBlur:c,autoFocus:!0})]})})]})})}ni.displayName="Textarea";let np=["pero","sin embargo","aunque","adem\xe1s","tambi\xe9n","porque","cuando","donde","como","mientras","despu\xe9s","antes","aunque","mientras que","por lo tanto","en cambio"],nm=["fin","final","terminado","listo","hecho","completado","eso es todo","eso es","termin\xe9","acab\xe9"],nh=[/\b(qué|cuál|cuándo|dónde|quién|por qué|cómo)\b/gi,/\b(es|son|está|están|tiene|tienen)\s+\w+\s*\?/gi],ng=[/\b(¡|wow|genial|excelente|perfecto|increíble)\b/gi],nx=()=>window.SpeechRecognition||window.webkitSpeechRecognition||null,nf=async()=>{if("undefined"==typeof navigator||!navigator.permissions)return null;try{return(await navigator.permissions.query({name:"microphone"})).state}catch(e){return null}},nv=()=>{let[e,t]=(0,a.useState)(!1),[n,r]=(0,a.useState)(""),[o,s]=(0,a.useState)(""),[l,i]=(0,a.useState)(!1),[c,d]=(0,a.useState)(null),u=(0,a.useRef)(null),p=(0,a.useRef)(""),m=(0,a.useRef)(!1),h=(0,a.useRef)(null),g=(0,a.useRef)(!1),x=(0,a.useRef)(!1),f=(0,a.useRef)(null);(0,a.useEffect)(()=>{let e=nx();if(!e){i(!1);return}i(!0);let n=new e;n.continuous=!0,n.interimResults=!0,n.lang="es-MX";let a=()=>{f.current&&(clearTimeout(f.current),f.current=null),g.current&&!m.current&&(f.current=setTimeout(()=>{if(console.log("⏱️ Dictado detenido autom\xe1ticamente por inactividad (3 minutos)"),m.current=!0,u.current)try{u.current.stop()}catch(e){console.error("Error al detener por inactividad:",e)}g.current=!1,t(!1),h.current&&(clearTimeout(h.current),h.current=null)},18e4))};return n.onstart=()=>{console.log("\uD83C\uDFA4 Reconocimiento de voz iniciado"),g.current=!0,t(!0),m.current=!1,d(null),a()},n.onresult=e=>{let t="",n="";for(let r=e.resultIndex;r<e.results.length;r++){let a=e.results[r][0].transcript;e.results[r].isFinal?n+=a:t+=a}if(n){let e=function(e){if(!e||"string"!=typeof e||0===e.trim().length)return e;try{let t=e.trim();return(t=(t=(t=function(e){if(!e||"string"!=typeof e||0===e.trim().length)return e;let t=e.trim();try{t.length>0&&t[0]===t[0].toLowerCase()&&(t=t[0].toUpperCase()+t.slice(1));let e=nh.some(e=>e.test(t)),n=t.endsWith("?")||t.endsWith("\xbf");if(e&&!n&&t.length>5){let e=t[t.length-1];/[.!?]/.test(e)||(t+="?")}if(ng.some(e=>e.test(t))&&!t.endsWith("!")&&t.length>3){let e=t[t.length-1];/[.!?]/.test(e)||(t+="!")}let r=t[t.length-1];if(!/[.!?]/.test(r)){let e=/\b(es|está|son|están|tiene|tienen|hace|hacen|dice|dicen|va|van|viene|vienen|fue|fueron|será|serán)\b/i.test(t),n=nm.some(e=>t.toLowerCase().endsWith(e)||t.toLowerCase().includes(" ".concat(e," ")));(t.length>10||e||n)&&(t+=".")}np.forEach(e=>{let n=RegExp("\\b".concat(e,"\\b"),"gi");t=t.replace(n,(e,n)=>{if(n>0){let r=t.substring(0,n).trim(),a=r[r.length-1];if(!/[.,;:!?]/.test(a)&&r.length>0)return", ".concat(e)}return e})}),t=(t=(t=(t=(t=t.replace(/([.!?])\s+([a-záéíóúñ])/g,(e,t,n)=>t+" "+n.toUpperCase())).replace(/:\s+([a-záéíóúñ])/g,(e,t)=>": "+t.toUpperCase())).replace(/,([^\s])/g,", $1")).replace(/\s+/g," ")).replace(/([.!?])([a-zA-ZáéíóúñÁÉÍÓÚÑ])/g,"$1 $2")}catch(t){return console.warn("Error en procesamiento de texto, retornando texto original:",t),e.trim()}return t.trim()}(t)).replace(/([.!?])\s*([a-záéíóúñ])/g,(e,t,n)=>t+" "+n.toUpperCase())).replace(/:\s+([a-záéíóúñ])/g,(e,t)=>": "+t.toUpperCase())).length>0&&t[0]===t[0].toLowerCase()&&(t=t[0].toUpperCase()+t.slice(1)),t=t.replace(/\s+/g," ").trim()}catch(t){return console.warn("Error en formatFinalText, retornando texto original:",t),e.trim()}}(n);p.current+=(p.current?" ":"")+e,r(p.current)}t&&s(function(e){if(!e||"string"!=typeof e||0===e.trim().length)return e;try{let t=e.trim();return t.length>0&&t[0]===t[0].toLowerCase()&&(t=t[0].toUpperCase()+t.slice(1)),(t=t.replace(/\s+/g," ")).trim()}catch(t){return e.trim()}}(t)),a()},n.onerror=e=>{if(console.error("Error en reconocimiento de voz:",e.error),"no-speech"!==e.error&&"aborted"!==e.error){if("not-allowed"===e.error){g.current=!1,t(!1),m.current=!1,d("Permiso de micr\xf3fono denegado. Por favor, permite el acceso al micr\xf3fono en la configuraci\xf3n de tu navegador."),h.current&&(clearTimeout(h.current),h.current=null);return}if("network"===e.error){g.current=!1,t(!1),m.current=!1,d("Error de red. Verifica tu conexi\xf3n a internet.");return}if("audio-capture"===e.error){g.current=!1,t(!1),d("No se detect\xf3 ning\xfan micr\xf3fono. Verifica que tu micr\xf3fono est\xe9 conectado y funcionando.");return}}},n.onend=()=>{if(console.log("\uD83C\uDFA4 Reconocimiento de voz finalizado"),m.current){f.current&&(clearTimeout(f.current),f.current=null),g.current=!1,t(!1);return}g.current&&!c&&f.current?h.current=setTimeout(()=>{if(!m.current&&u.current&&g.current&&!c&&f.current)try{u.current.start()}catch(e){console.error("Error al reiniciar reconocimiento:",e),g.current=!1,t(!1),f.current&&(clearTimeout(f.current),f.current=null)}},100):(g.current=!1,t(!1),f.current&&(clearTimeout(f.current),f.current=null))},u.current=n,u.current=n,()=>{if(h.current&&clearTimeout(h.current),f.current&&clearTimeout(f.current),u.current){try{u.current.stop()}catch(e){}u.current=null}}},[c]);let v=(0,a.useCallback)(async()=>{if(!l||!u.current)return!1;try{let e=await nf();if("denied"===e)return d("Permiso de micr\xf3fono denegado. Por favor, permite el acceso al micr\xf3fono en la configuraci\xf3n de tu navegador."),!1;if("granted"===e)return d(null),!0;return x.current=!0,!0}catch(e){return console.error("Error verificando permisos:",e),!0}},[l]),b=(0,a.useCallback)(async()=>{if(!l||!u.current){console.warn("Reconocimiento de voz no disponible");return}if(e){console.warn("Ya est\xe1 escuchando");return}if(!c||await v())try{m.current=!1,p.current="",r(""),s(""),d(null),g.current=!0,u.current.start()}catch(e){var n,a;if(console.error("Error al iniciar reconocimiento:",e),"NotAllowedError"===e.name||(null===(n=e.message)||void 0===n?void 0:n.includes("not-allowed"))){d("Permiso de micr\xf3fono denegado. Por favor, permite el acceso al micr\xf3fono en la configuraci\xf3n de tu navegador."),g.current=!1,t(!1);return}if((null===(a=e.message)||void 0===a?void 0:a.includes("already started"))||"InvalidStateError"===e.name)try{u.current.stop(),setTimeout(()=>{u.current&&u.current.start()},100)}catch(e){console.error("Error al reiniciar:",e),g.current=!1,t(!1)}else g.current=!1,t(!1)}},[l,e,c,v]),w=(0,a.useCallback)(()=>{if(u.current){m.current=!0,h.current&&(clearTimeout(h.current),h.current=null),f.current&&(clearTimeout(f.current),f.current=null);try{u.current.stop(),g.current=!1,t(!1),console.log("\uD83C\uDFA4 Reconocimiento detenido por el usuario")}catch(e){console.error("Error al detener reconocimiento:",e),g.current=!1,t(!1)}}},[]),y=(0,a.useCallback)(async()=>{e?w():await b()},[e,b,w]);return{isSupported:l,isListening:e,transcript:n+(o?" "+o:""),finalTranscript:n,interimTranscript:o,permissionError:c,start:b,stop:w,toggle:y,resetTranscript:(0,a.useCallback)(()=>{p.current="",r(""),s("")},[]),requestPermission:v}};function nb(e){let{params:t}=e,{boardId:n}=t;(0,o.useRouter)();let{user:i,isUserLoading:d,userError:u}=(0,l.aF)(),p=(0,l.y$)(),{toast:x}=(0,h.pm)(),f=g("(max-width: 768px)");console.log("\uD83C\uDFAF [BoardPage] Componente iniciado",{boardId:n,hasUser:!!i,userId:null==i?void 0:i.uid,isAnonymous:null==i?void 0:i.isAnonymous,authLoading:d,pathname:window.location.pathname});let b=(0,a.useRef)(null),y=(0,a.useRef)(null),j=(0,a.useRef)(null),N=(0,a.useRef)(x);(0,a.useEffect)(()=>{N.current=x},[x]),a.useEffect(()=>{console.log("\uD83D\uDE80 [BoardPage] Componente montado",{boardId:n})},[n]),a.useEffect(()=>{console.log("\uD83D\uDD0D [BoardPage] Estado del usuario:",{hasUser:!!i,userId:null==i?void 0:i.uid,isUserLoading:d,userError:null==u?void 0:u.message,userEmail:null==i?void 0:i.email,isAnonymous:null==i?void 0:i.isAnonymous,sessionStorage:{hasRecentLogin:sessionStorage.getItem("hasRecentLogin"),loginTimestamp:sessionStorage.getItem("loginTimestamp"),redirectingToBoard:sessionStorage.getItem("redirectingToBoard")}})},[i,d,u]);let{elements:C,board:k,loadBoard:E,createBoard:z,updateElement:T,deleteElement:D,selectedElementIds:S,setSelectedElementIds:I,isLoading:P,error:R,cleanup:M}=m();(0,a.useEffect)(()=>{b.current=E,y.current=z,j.current=M},[E,z,M]);let{boards:F,handleRenameBoard:B,handleDeleteBoard:A,clearCanvas:Z}=function(e){let t=(0,l.CU)(),{user:n}=(0,l.aF)(),{toast:r}=(0,h.pm)(),s=(0,o.useRouter)(),i=(0,a.useRef)(s),d=(0,a.useRef)(r);(0,a.useEffect)(()=>{i.current=s,d.current=r},[s,r]);let[u,p]=(0,a.useState)(null),[m,g]=(0,a.useState)([]),[x,f]=(0,a.useState)([]),[v,b]=(0,a.useState)(!0);(0,a.useEffect)(()=>{if(!t||!n)return;let e=(0,c.IO)((0,c.hJ)(t,"users",n.uid,"canvasBoards"),(0,c.Xo)("updatedAt","desc")),r=(0,c.cf)(e,e=>{g(e.docs.map(e=>({...e.data(),id:e.id})))},e=>{console.error("Error fetching boards list:",e)});return()=>r()},[t,n]),(0,a.useEffect)(()=>{if(!t||!n||!e)return;b(!0);let r=(0,c.JU)(t,"users",n.uid,"canvasBoards",e),a=(0,c.cf)(r,e=>{e.exists()?p({...e.data(),id:e.id}):(d.current({variant:"destructive",title:"Error",description:"Este tablero no existe o no tienes permiso para verlo."}),i.current.push("/")),b(!1)},e=>{console.error("Error fetching board:",e),b(!1),d.current({variant:"destructive",title:"Error de Carga",description:"No se pudo cargar el tablero."}),i.current.push("/")});return()=>{a()}},[t,n,e]);let w=(0,a.useCallback)(async a=>{if(!t||!n||!e||!u||!a.trim()){r({variant:"destructive",title:"Error",description:"No se puede renombrar el tablero. Verifica que est\xe9s autenticado."});return}if(a.trim()!==u.name)try{let o=(0,c.JU)(t,"users",n.uid,"canvasBoards",e);await (0,c.r7)(o,{name:a.trim(),updatedAt:(0,c.Bt)()}),r({title:"Tablero renombrado",description:'El tablero ahora se llama "'.concat(a.trim(),'".')})}catch(e){console.error("Error renombrando tablero:",e),r({variant:"destructive",title:"Error",description:e.message||"No se pudo renombrar el tablero. Verifica tus permisos."})}},[t,n,u,e,r]);return{board:u,boards:m,elements:x,isLoading:v,handleRenameBoard:w,handleDeleteBoard:(0,a.useCallback)(async()=>{if(t&&n&&e){r({title:"Eliminando tablero..."});try{let a=(0,c.JU)(t,"users",n.uid,"canvasBoards",e);await (0,c.oe)(a),r({title:"Tablero eliminado",description:"El tablero y todo su contenido han sido eliminados."}),s.push("/")}catch(e){console.error("Error deleting board:",e),r({variant:"destructive",title:"Error",description:"No se pudo eliminar el tablero."})}}},[t,n,e,s,r]),clearCanvas:(0,a.useCallback)(async a=>{if(!t||!n||!e||!a){r({variant:"destructive",title:"Error",description:"No se puede limpiar el tablero. Verifica que est\xe9s autenticado."});return}if(0===a.length){r({title:"Tablero vac\xedo",description:"El tablero ya est\xe1 vac\xedo."});return}try{let o=(0,c.hJ)(t,"users",n.uid,"canvasBoards",e,"canvasElements"),s=(0,c.qs)(t);a.forEach(e=>s.delete((0,c.JU)(o,e.id)));let l=(0,c.JU)(t,"users",n.uid,"canvasBoards",e);s.update(l,{updatedAt:(0,c.Bt)()}),await s.commit(),r({title:"Tablero Limpio",description:"Se eliminaron ".concat(a.length," elemento(s) del tablero.")})}catch(e){console.error("Error limpiando tablero:",e),r({variant:"destructive",title:"Error",description:e.message||"No se pudo limpiar el tablero. Verifica tus permisos."})}},[t,n,e,r])}}(n),L=(0,a.useRef)(null),O=(0,a.useCallback)(()=>{Q(!0)},[]),U=(0,a.useCallback)(e=>{B(e),Q(!1)},[B]),H=(0,a.useCallback)(()=>{Z(C)},[C,Z]),[_,K]=(0,a.useState)(!0),[q,W]=(0,a.useState)(!1),[V,G]=(0,a.useState)(!1),[J,Y]=(0,a.useState)(!1),[X,Q]=(0,a.useState)(!1),[$,ee]=(0,a.useState)(null),[et,en]=(0,a.useState)(null),[er,ea]=(0,a.useState)(null),[eo,es]=(0,a.useState)(!1),[el,ei]=(0,a.useState)(!1),[ec,ed]=(0,a.useState)(null),[eu,ep]=(0,a.useState)(!1),{micPermission:em}=function(){let e=(0,l.CU)(),{user:t}=(0,l.aF)(),[n,r]=(0,a.useState)("prompt");return(0,a.useEffect)(()=>{if(!e||!t){r("prompt");return}let n=(0,c.JU)(e,"users",t.uid),a=(0,c.cf)(n,e=>{var t;let n=e.data();r((null==n?void 0:null===(t=n.preferences)||void 0===t?void 0:t.microphonePermission)||"prompt")},e=>{console.error("Error fetching user preferences:",e)});return()=>a()},[e,t]),{micPermission:n,updateUserMicPreference:(0,a.useCallback)(async n=>{if(!e||!t)return;let r=(0,c.JU)(e,"users",t.uid);try{await (0,c.pl)(r,{preferences:{microphonePermission:n}},{merge:!0})}catch(e){console.error("Error updating user mic preference:",e)}},[e,t])}}(),{isSupported:eh,isListening:eg,transcript:ex,finalTranscript:ef,interimTranscript:ev,permissionError:eb,toggle:ew,requestPermission:ey}=nv(),ej=(0,a.useMemo)(()=>{let e=ef||"",t=ev||"";return t.trim()?e+(e?" ":"")+t:e},[ef,ev]),eN=(0,a.useCallback)(async()=>{try{await ew()}catch(e){console.error("Error al alternar dictado:",e)}},[ew]);(0,a.useEffect)(()=>{eb&&x({variant:"destructive",title:"Error de Permisos",description:eb,duration:5e3})},[eb,x]);let eC=(0,a.useCallback)(()=>L.current?L.current.getViewportCenter():{x:window.innerWidth/2,y:window.innerHeight/2},[]),{addElement:ek}=function(e,t,n){let r=(0,l.CU)(),{user:o}=(0,l.aF)(),{toast:s}=(0,h.pm)(),i=(0,a.useRef)(t),d=(0,a.useRef)(n);(0,a.useEffect)(()=>{i.current=t,d.current=n},[t,n]);let u=(0,a.useCallback)(async(t,n)=>{var a,s,l,u;let p,m;if(!r||!o||!e)return Promise.reject(Error(r?o?"Board ID no v\xe1lido":"Usuario no autenticado":"Firestore no est\xe1 disponible"));let h=(0,c.hJ)(r,"users",o.uid,"canvasBoards",e,"canvasElements");if("connector"===t)return(await (0,c.ET)(h,{type:"connector",userId:o.uid,properties:{},content:null==n?void 0:n.content,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)()})).id;let g=i.current();p="container"===t?0:d.current();let x=n&&n.properties&&n.properties.position?n.properties.position:g,f=n&&n.properties&&n.properties.size?n.properties.size:{width:200,height:150},v="number"==typeof f.width?f.width:200,b="number"==typeof f.height?f.height:150,w=(e,t)=>{let n=x.x,r=x.y,a=n-e/2,o=r-t/2,s=window.innerWidth,l=window.innerHeight;return{x:Math.max(0,a=e<=s?Math.max(20,Math.min(a,n+s/2-e)):Math.max(20,n-s/4)),y:Math.max(0,o=t<=l?Math.max(20,Math.min(o,r+l/2-t)):Math.max(20,r-l/4))}},y={size:f,zIndex:p,rotation:0};switch(n&&n.properties&&"object"==typeof n.properties&&Object.assign(y,n.properties),t){case"notepad":let j={width:794,height:978},N=w(j.width,j.height);m={type:t,x:N.x,y:N.y,width:j.width,height:j.height,userId:o.uid,properties:{...y,position:N,size:j,format:"letter"},content:{title:"Nuevo Cuaderno",pages:[,,,,,].fill("<div><br></div>"),currentPage:0},zIndex:p,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)()};break;case"notepad-simple":let C={width:302,height:491},k=w(C.width,C.height);m={type:t,x:k.x,y:k.y,width:C.width,height:C.height,userId:o.uid,properties:{...y,position:k,size:C},content:{title:"Nuevo Notepad",text:"<div><br></div>"},zIndex:p,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)()};break;case"super-notebook":let E={width:794,height:1021},z=w(E.width,E.height);m={type:t,x:z.x,y:z.y,width:E.width,height:E.height,userId:o.uid,properties:{...y,position:z,size:E},content:{title:"Super Cuaderno",pages:[,,,,,].fill("<div><br></div>"),currentPage:0},zIndex:p,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)()};break;case"sticky":let T=(null==n?void 0:n.color)||"yellow",D={width:224,height:224},S=w(D.width,D.height);m={type:"sticky",x:S.x,y:S.y,width:D.width,height:D.height,userId:o.uid,properties:{...y,position:S,size:D,color:T},content:"string"==typeof(null==n?void 0:n.content)?n.content:"Escribe algo...",zIndex:p,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)(),...(null==n?void 0:n.tags)&&{tags:n.tags}};break;case"todo":let I={width:300,height:150},P=w(I.width,I.height);m={type:t,x:P.x,y:P.y,width:I.width,height:I.height,userId:o.uid,properties:{...y,position:P,size:I},content:(null==n?void 0:n.content)||{title:"Lista de Tareas",items:[]},zIndex:p,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)()};break;case"image":let R=w(v,b);m={type:t,x:R.x,y:R.y,width:v,height:b,userId:o.uid,properties:{...y,position:R,size:{width:v,height:b}},content:null==n?void 0:n.content,zIndex:p,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)()};break;case"text":let M=w(v,b),F=(null==n?void 0:null===(a=n.properties)||void 0===a?void 0:a.backgroundColor)||"#ffffff";m={type:t,x:M.x,y:M.y,width:v,height:b,userId:o.uid,properties:{...y,position:M,size:{width:v,height:b},backgroundColor:F},content:(null==n?void 0:n.content)||'<div style="font-size: 18px;">Escribe algo...</div>',color:(null==n?void 0:n.color)||"white",zIndex:p,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)()};break;case"container":let B=(null==n?void 0:null===(s=n.properties)||void 0===s?void 0:s.size)?n.properties.size:{width:378,height:567},A=(null==n?void 0:n.content)&&"object"==typeof n.content&&"title"in n.content?n.content:null,Z=(null==A?void 0:A.title)==="Lienzo"||(null==A?void 0:A.title)==="lienzo",L=Z?{width:Math.round(("number"==typeof B.width?B.width:378)*.5),height:"number"==typeof B.height?B.height:567}:B,O=w("number"==typeof L.width?L.width:378,"number"==typeof L.height?L.height:567),U=Z?"#daf4c5":(null==n?void 0:null===(l=n.properties)||void 0===l?void 0:l.backgroundColor)?n.properties.backgroundColor:"white",H=Z?-1:p;m={type:"container",x:O.x,y:O.y,width:"number"==typeof L.width?L.width:378,height:"number"==typeof L.height?L.height:567,userId:o.uid,properties:{...y,position:O,size:L,backgroundColor:U,zIndex:H},content:A||{title:"Nuevo Contenedor",elementIds:[],layout:"single"},zIndex:H,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)()};break;case"comment":let _={width:32,height:32},K=w(_.width,_.height);m={type:t,x:K.x,y:K.y,width:_.width,height:_.height,userId:o.uid,properties:{...y,position:K,size:_},content:(null==n?void 0:n.content)||{title:"",label:"",comment:""},parentId:(null==n?void 0:n.parentId)||void 0,zIndex:p,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)()};break;case"moodboard":let q={width:600,height:500},W=w(q.width,q.height);m={type:t,x:W.x,y:W.y,width:q.width,height:q.height,userId:o.uid,properties:{...y,position:W,size:q,backgroundColor:"#ffffff"},content:(null==n?void 0:n.content)||{title:"Nuevo Moodboard",images:[],annotations:[],layout:"grid"},zIndex:p,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)()};break;case"tabbed-notepad":let V={width:500,height:400},G=w(V.width,V.height);m={type:t,x:G.x,y:G.y,width:V.width,height:V.height,userId:o.uid,properties:{...y,position:G,size:V,backgroundColor:"#ffffff"},content:(null==n?void 0:n.content)||{title:"Bloc de Notas",tabs:[{id:"tab-1",title:"Pesta\xf1a 1",content:""}],activeTabId:"tab-1"},zIndex:p,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)()};break;case"accordion":let J={width:320,height:240},Y=w(J.width,J.height);m={type:t,x:Y.x,y:Y.y,width:J.width,height:J.height,userId:o.uid,properties:{...y,position:Y,size:J,backgroundColor:"#ffffff"},content:(null==n?void 0:n.content)||{items:[{id:"1",title:"Nuevo Item",content:""}]},zIndex:p,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)()};break;case"stopwatch":let X={width:200,height:120},Q=w(X.width,X.height);m={type:t,x:Q.x,y:Q.y,width:X.width,height:X.height,userId:o.uid,properties:{...y,position:Q,size:X,backgroundColor:"#000000"},content:{time:0,isRunning:!1},zIndex:p,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)()};break;case"countdown":let $={width:200,height:180},ee=w($.width,$.height);m={type:t,x:ee.x,y:ee.y,width:$.width,height:$.height,userId:o.uid,properties:{...y,position:ee,size:$,backgroundColor:"#000000"},content:{timeLeft:0,selectedMinutes:5,isRunning:!1},zIndex:p,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)()};break;case"highlight-text":let et={width:300,height:150},en=w(et.width,et.height),er=(null==n?void 0:null===(u=n.properties)||void 0===u?void 0:u.backgroundColor)?n.properties.backgroundColor:"#fffb8b";m={type:t,x:en.x,y:en.y,width:et.width,height:et.height,userId:o.uid,properties:{...y,position:en,size:et,backgroundColor:er},content:{text:""},zIndex:p,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)()};break;case"yellow-notepad":let ea={width:400,height:600},eo=w(ea.width,ea.height);m={type:t,x:eo.x,y:eo.y,width:ea.width,height:ea.height,userId:o.uid,properties:{...y,position:eo,size:ea,backgroundColor:"#FFFFE0"},content:(null==n?void 0:n.content)||{text:"",searchQuery:""},zIndex:p,createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)()};break;default:return Promise.reject(Error("Tipo de elemento inv\xe1lido: ".concat(t)))}return(await (0,c.ET)(h,m)).id},[r,o,e]);return{addElement:u,updateElement:(0,a.useCallback)((t,n)=>{if(!r||!o||!e)return;let a=(0,c.JU)(r,"users",o.uid,"canvasBoards",e,"canvasElements",t),s={updatedAt:(0,c.Bt)()};Object.keys(n).forEach(e=>{let t=n[e];void 0!==t?s[e]=t:"parentId"===e&&(s[e]=null)}),(0,c.r7)(a,s);let l=(0,c.JU)(r,"users",o.uid,"canvasBoards",e);(0,c.r7)(l,{updatedAt:(0,c.Bt)()}).catch(e=>{console.error("Error actualizando tablero:",e)})},[r,o,e]),deleteElement:(0,a.useCallback)(async(t,n)=>{if(!r||!o||!e)return;let a=n.find(e=>e.id===t);if(!a)return;let s=(0,c.hJ)(r,"users",o.uid,"canvasBoards",e,"canvasElements"),l=(0,c.qs)(r),i=(0,c.JU)(s,t);if("container"===a.type){let e=a.content;e&&Array.isArray(e.elementIds)&&e.elementIds.forEach(e=>{let t=(0,c.JU)(s,e);l.delete(t)})}l.delete(i),await l.commit()},[r,o,e]),unanchorElement:(0,a.useCallback)(async t=>{var n,a,l,i,d,u;if(!r||!o||!e)return;let p=(0,c.hJ)(r,"users",o.uid,"canvasBoards",e,"canvasElements"),m=(0,c.JU)(p,t),h=await (0,c.QT)(m);if(!h.exists()){s({variant:"destructive",title:"Error",description:"El elemento no existe."});return}let g=h.data();if(!(null==g?void 0:g.parentId)){s({variant:"destructive",title:"Error",description:"El elemento no est\xe1 anclado a ning\xfan contenedor."});return}let x=g.parentId,f=(0,c.JU)(p,x),v=await (0,c.QT)(f);if(!v.exists()){s({variant:"destructive",title:"Error",description:"No se encontr\xf3 el contenedor padre."});return}let b=v.data();if(!b){s({variant:"destructive",title:"Error",description:"No se pudo obtener datos del contenedor padre."});return}let w=null==b?void 0:b.content,y=null==b?void 0:b.properties,j=((null==w?void 0:w.elementIds)||[]).filter(e=>e!==t),N=null!==(d=null==y?void 0:null===(n=y.position)||void 0===n?void 0:n.x)&&void 0!==d?d:0,C="number"==typeof(null==y?void 0:null===(a=y.size)||void 0===a?void 0:a.width)?y.size.width:((null==y?void 0:null===(l=y.size)||void 0===l?void 0:l.width)?parseFloat(String(y.size.width)):300)||300,k=null!==(u=null==y?void 0:null===(i=y.position)||void 0===i?void 0:i.y)&&void 0!==u?u:0,E=g.properties,z=(null==E?void 0:E.position)||{x:g.x||0,y:g.y||0},T=z.x>0&&z.y>0?z:{x:N+C+20,y:k+50},D=(0,c.qs)(r);D.update(f,{content:{...w,elementIds:j},updatedAt:(0,c.Bt)()});let S=E||{},I="number"==typeof g.width&&"number"==typeof g.height?{width:g.width,height:g.height}:S.size||{width:200,height:150};D.update(m,{parentId:null,hidden:!1,x:T.x,y:T.y,properties:{...S,position:T,size:I},updatedAt:(0,c.Bt)()});try{await D.commit(),s({title:"Elemento desanclado",description:"El elemento ha sido devuelto al lienzo."})}catch(e){console.error("Error al desanclar elemento:",e),s({variant:"destructive",title:"Error",description:"No se pudo desanclar el elemento."})}},[r,o,e,s])}}(n,eC,(0,a.useCallback)(()=>{if(!C||0===C.length)return 1;let e=C.filter(e=>"number"==typeof e.zIndex).map(e=>e.zIndex);return e.length>0?Math.max(...e)+1:2},[C])),eE=1===S.length?S[0]:null,ez=(0,a.useMemo)(()=>eE&&C&&0!==C.length&&C.find(e=>e.id===eE)||null,[eE,C.length]);(0,a.useEffect)(()=>{ee(ez)},[ez]),(0,a.useEffect)(()=>{$?ep(!0):ep(!1)},[$]),(0,a.useEffect)(()=>{let e=e=>{(e.ctrlKey||e.metaKey)&&e.shiftKey&&"D"===e.key&&(e.preventDefault(),ep(e=>!e))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]);let eT=(0,a.useRef)(!1),eD=(0,a.useRef)(!1),eS=(0,a.useRef)(null),eI=(0,a.useRef)(null);(0,a.useEffect)(()=>{if(console.log("\uD83D\uDD04 [BoardPage] useEffect ejecutado",{boardId:n,hasUser:!!i,userId:null==i?void 0:i.uid,isAnonymous:null==i?void 0:i.isAnonymous,authLoading:d,isLoading:eD.current,hasLoaded:eT.current,currentBoardId:eI.current}),eI.current!==n&&(console.log("\uD83D\uDD04 [BoardPage] BoardId cambi\xf3, reseteando flags",{old:eI.current,new:n}),eT.current=!1,eD.current=!1,eI.current=n),eD.current||d){console.log("⏸️ [BoardPage] Saltando ejecuci\xf3n (ya cargando o auth cargando)",{isLoading:eD.current,authLoading:d});return}eS.current&&(clearTimeout(eS.current),eS.current=null);let e="true"===sessionStorage.getItem("hasRecentLogin"),t=sessionStorage.getItem("loginTimestamp"),r=sessionStorage.getItem("redirectingToBoard"),a=e&&t&&Date.now()-parseInt(t)<6e4;if(!i&&!a){sessionStorage.clear(),localStorage.clear(),window.location.replace("/");return}if(a&&!i){let a=r===n?3e4:1e4;console.log("⏳ [BoardPage] Esperando usuario despu\xe9s de login reciente...",{waitTime:a,redirectingToBoard:r,boardId:n,hasRecentLogin:e,loginTimestamp:t}),eS.current=setTimeout(()=>{i||(console.log("⚠️ [BoardPage] Timeout: Usuario no disponible despu\xe9s de esperar, redirigiendo..."),sessionStorage.removeItem("hasRecentLogin"),sessionStorage.removeItem("loginTimestamp"),sessionStorage.removeItem("redirectingToBoard"),window.location.replace("/"))},a);return}if((null==i?void 0:i.uid)&&!eT.current&&b.current&&y.current){console.log("✅ [BoardPage] Usuario disponible, cargando/creando tablero",{userId:i.uid,boardId:n,isAnonymous:i.isAnonymous}),eT.current=!0,eD.current=!0;let e=i.uid;"new"===n?y.current(e).then(e=>{eD.current=!1,e?(sessionStorage.setItem("hasRecentLogin","true"),sessionStorage.setItem("loginTimestamp",Date.now().toString()),window.location.href="/board/".concat(e)):eT.current=!1}).catch(e=>{eD.current=!1,eT.current=!1,console.error("❌ Error al crear tablero:",e)}):b.current(n,e).then(e=>{eD.current=!1,e?setTimeout(()=>{sessionStorage.removeItem("hasRecentLogin"),sessionStorage.removeItem("loginTimestamp"),sessionStorage.removeItem("redirectingToBoard")},2e3):eT.current=!1}).catch(e=>{eD.current=!1,eT.current=!1,console.error("❌ Error al cargar tablero:",e)})}return()=>{eS.current&&(clearTimeout(eS.current),eS.current=null),j.current&&j.current()}},[n,i,d]);let eP=(e,t)=>{null===e?I([]):I([e])},eR=(0,a.useCallback)(async()=>{if(!(null==i?void 0:i.uid)){x({title:"Error",description:"Debes iniciar sesi\xf3n"});return}let e=i.uid,t=document.createElement("input");t.type="file",t.accept="image/*",t.onchange=async t=>{var n;let r=null===(n=t.target.files)||void 0===n?void 0:n[0];if(r)try{let t=await v(r,e,p);t.url&&(await ek("image",{content:{url:t.url},properties:{size:{width:300,height:200}}}),x({title:"Imagen subida"}))}catch(e){x({variant:"destructive",title:"Error al subir imagen"})}},t.click()},[i,p,ek,x]),eM=(0,a.useCallback)(()=>K(e=>!e),[]),eF=(0,a.useCallback)(async()=>{let e=eC();try{await ek("comment",{content:{title:"Nuevo Localizador",label:"Localizador",text:""},properties:{position:e,size:{width:48,height:48}}}),x({title:"Localizador creado",description:"Se ha marcado una nueva ubicaci\xf3n en el tablero. Edita el nombre para identificarlo."})}catch(e){x({variant:"destructive",title:"Error",description:e.message||"No se pudo crear el localizador."})}},[eC,ek,x]),eB=(0,a.useCallback)(e=>{let t=C.find(t=>t.id===e);t&&L.current&&(eP(e,!1),L.current.centerOnElement(t))},[C]),eA=(0,a.useCallback)(async e=>{let t=C.find(t=>t.id===e);t&&(T(e,{hidden:!1}),eP(e,!1),L.current&&L.current.centerOnElement(t))},[C,T]),eZ=(0,a.useCallback)(e=>{let t=C.find(t=>t.id===e);t&&(ea(t),G(!0))},[C]),eL=(0,a.useCallback)((e,t)=>{let n="letter"===t?{width:794,height:1021}:{width:378,height:567};T(e,{width:n.width,height:n.height,properties:{...null==er?void 0:er.properties,format:t,size:n}}),G(!1)},[er,T]),eO=(0,a.useCallback)(e=>{ed(e),ei(!0)},[]),eU=(0,a.useCallback)(async()=>{try{if(!L.current){x({variant:"destructive",title:"Error",description:"No se pudo acceder al lienzo."});return}let e=L.current.getCanvasContainer();if(!e){x({variant:"destructive",title:"Error",description:"No se pudo encontrar el contenedor del lienzo."});return}x({title:"Exportando...",description:"Generando imagen PNG de alta resoluci\xf3n del tablero completo. Esto puede tardar unos segundos..."}),document.body.classList.add("exporting-to-png");let t=e.scrollLeft,n=e.scrollTop,r=window.innerWidth,a=window.innerHeight,o=await w()(e,{backgroundColor:"#96e4e6",scale:4,useCORS:!0,logging:!1,allowTaint:!1,x:t,y:n,width:r,height:a,windowWidth:r,windowHeight:a});document.body.classList.remove("exporting-to-png"),o.toBlob(e=>{if(!e){x({variant:"destructive",title:"Error",description:"No se pudo generar la imagen."});return}let t=URL.createObjectURL(e),n=document.createElement("a");n.href=t;let r=(null==k?void 0:k.name)||"tablero";n.download="".concat(r,"_").concat(Date.now(),".png"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t),x({title:"Exportado",description:"El tablero se ha exportado como PNG de alta resoluci\xf3n."})},"image/png",1)}catch(e){document.body.classList.remove("exporting-to-png"),console.error("Error al exportar tablero:",e),x({variant:"destructive",title:"Error",description:e.message||"No se pudo exportar el tablero."})}},[L,k,x]);if(console.log("\uD83C\uDFA8 [BoardPage] Render:",{boardId:n,hasUser:!!i,userId:null==i?void 0:i.uid,isAnonymous:null==i?void 0:i.isAnonymous,authLoading:d,isBoardLoading:P,hasBoard:!!k,sessionStorage:{hasRecentLogin:sessionStorage.getItem("hasRecentLogin"),loginTimestamp:sessionStorage.getItem("loginTimestamp"),redirectingToBoard:sessionStorage.getItem("redirectingToBoard")}}),d)return(0,r.jsxs)("div",{className:"flex h-screen w-full flex-col items-center justify-center",style:{backgroundColor:"#96e4e6"},children:[(0,r.jsx)(s.Z,{className:"h-8 w-8 animate-spin text-slate-900"}),(0,r.jsx)("p",{className:"mt-4 text-lg font-semibold text-slate-900",children:"Verificando autenticaci\xf3n..."})]});if(!i){{let e="true"===sessionStorage.getItem("hasRecentLogin"),t=sessionStorage.getItem("loginTimestamp"),a=sessionStorage.getItem("redirectingToBoard");if(e&&t&&Date.now()-parseInt(t)<6e4)return console.log("⏳ [BoardPage] Render: Login reciente detectado, esperando usuario...",{hasRecentLogin:e,loginTimestamp:t,redirectingToBoard:a,boardId:n}),(0,r.jsxs)("div",{className:"flex h-screen w-full flex-col items-center justify-center",style:{backgroundColor:"#96e4e6"},children:[(0,r.jsx)(s.Z,{className:"h-8 w-8 animate-spin text-slate-900"}),(0,r.jsx)("p",{className:"mt-4 text-lg font-semibold text-slate-900",children:"Cargando tu tablero..."})]})}return console.log("⚠️ [BoardPage] Render: No hay usuario y no hay login reciente, redirigiendo..."),sessionStorage.clear(),localStorage.clear(),window.location.replace("/"),(0,r.jsxs)("div",{className:"flex h-screen w-full flex-col items-center justify-center",style:{backgroundColor:"#cae3e1"},children:[(0,r.jsx)(s.Z,{className:"h-8 w-8 animate-spin text-slate-900"}),(0,r.jsx)("p",{className:"mt-4 text-lg font-semibold text-slate-900",children:"Redirigiendo..."})]})}return P||"new"===n?(0,r.jsxs)("div",{className:"flex h-screen w-full flex-col items-center justify-center",style:{backgroundColor:"#75e8ce"},children:[(0,r.jsx)(s.Z,{className:"h-8 w-8 animate-spin text-slate-900"}),(0,r.jsx)("p",{className:"mt-4 text-lg font-semibold text-slate-900",children:"Cargando tu lienzo..."})]}):R?(0,r.jsxs)("div",{className:"p-10 text-red-500",children:["Error: ",R]}):!k&&i?(0,r.jsxs)("div",{className:"flex h-screen w-full flex-col items-center justify-center",style:{backgroundColor:"#cae3e1"},children:[(0,r.jsx)(s.Z,{className:"h-8 w-8 animate-spin text-slate-900"}),(0,r.jsx)("p",{className:"mt-4 text-lg font-semibold text-slate-900",children:"Cargando tu tablero..."})]}):k?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(nu,{isOpen:X,onOpenChange:Q,currentBoardName:(null==k?void 0:k.name)||"Sin nombre",onSave:U}),(0,r.jsxs)("div",{className:"h-screen w-screen relative bg-[#3b3b3b] overflow-hidden",children:[(0,r.jsx)(tI,{ref:L,elements:C,board:k,selectedElementIds:S,onSelectElement:eP,updateElement:T,deleteElement:D,unanchorElement:e=>{let t=C.find(t=>t.id===e);t&&t.parentId&&T(e,{parentId:void 0})},addElement:ek,onLocateElement:eB,onFormatToggle:eM,onChangeNotepadFormat:eZ,onEditElement:en,selectedElement:$,activatedElementId:et,isMobile:f,setIsDirty:es,isListening:eg,liveTranscript:ej,finalTranscript:ef,interimTranscript:ev,onBringToFront:()=>{},onSendToBack:()=>{},onMoveBackward:()=>{},onGoToHome:()=>{var e;return null===(e=L.current)||void 0===e?void 0:e.goToHome()},onCenterView:()=>{},onGroupElements:()=>{},saveLastView:()=>{},onActivateDrag:()=>{},onEditComment:eO,onDuplicateElement:()=>{},onUngroup:()=>{}}),(0,r.jsx)(t$,{elements:C||[],boards:F||[],onUploadImage:eR,onAddImageFromUrl:()=>W(!0),onPanToggle:()=>{var e;return null===(e=L.current)||void 0===e?void 0:e.activatePanMode()},onRenameBoard:O,onDeleteBoard:A,isListening:eg,onToggleDictation:eN,onOpenNotepad:eA,onLocateElement:eB,addElement:ek,clearCanvas:H,onExportBoardToPng:eU,onFormatToggle:eM,isFormatToolbarOpen:_}),(0,r.jsx)(nt,{isOpen:_,onClose:()=>K(!1),elements:$?[$]:[],onAddComment:eF,onEditComment:eO,isMobileSheet:f,onLocateElement:eB,onPanToggle:()=>{var e;Y(e=>!e),null===(e=L.current)||void 0===e||e.activatePanMode()},addElement:ek,isPanningActive:J}),(0,r.jsx)(nl,{isOpen:V,onOpenChange:G,notepad:er,onSaveFormat:eL}),(0,r.jsx)(nn,{isOpen:q,onOpenChange:W,onAddImage:async e=>{await ek("image",{content:{url:e},properties:{size:{width:300,height:200}}}),W(!1)}}),ec&&(0,r.jsx)(nc,{isOpen:el,onOpenChange:ei,comment:ec,onUpdate:T,onDelete:D}),(0,r.jsx)(nd,{element:$,isVisible:eu&&!!$,onClose:()=>ep(!1)})]})]}):null}},12381:function(e,t,n){"use strict";n.d(t,{d:function(){return i},z:function(){return c}});var r=n(57437),a=n(2265),o=n(37053),s=n(90535),l=n(93448);let i=(0,s.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef((e,t)=>{let{className:n,variant:a,size:s,asChild:c=!1,...d}=e,u=c?o.g7:"button";return(0,r.jsx)(u,{className:(0,l.cn)(i({variant:a,size:s,className:n})),ref:t,...d})});c.displayName="Button"},74291:function(e,t,n){"use strict";n.d(t,{$N:function(){return h},Be:function(){return g},Vq:function(){return i},cN:function(){return m},cZ:function(){return u},fK:function(){return p}});var r=n(57437),a=n(2265),o=n(70001),s=n(44986),l=n(93448);let i=o.fC;o.xz;let c=o.h_;o.x8;let d=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(o.aV,{ref:t,className:(0,l.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",n),...a})});d.displayName=o.aV.displayName;let u=a.forwardRef((e,t)=>{let{className:n,children:a,...i}=e;return(0,r.jsxs)(c,{children:[(0,r.jsx)(d,{}),(0,r.jsxs)(o.VY,{ref:t,className:(0,l.cn)("fixed left-[50%] top-[50%] z-[50000] grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",n),...i,children:[a,(0,r.jsxs)(o.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,r.jsx)(s.Z,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});u.displayName=o.VY.displayName;let p=e=>{let{className:t,...n}=e;return(0,r.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...n})};p.displayName="DialogHeader";let m=e=>{let{className:t,...n}=e;return(0,r.jsx)("div",{className:(0,l.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...n})};m.displayName="DialogFooter";let h=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(o.Dx,{ref:t,className:(0,l.cn)("text-lg font-semibold leading-none tracking-tight",n),...a})});h.displayName=o.Dx.displayName;let g=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(o.dk,{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",n),...a})});g.displayName=o.dk.displayName},40279:function(e,t,n){"use strict";n.d(t,{I:function(){return s}});var r=n(57437),a=n(2265),o=n(93448);let s=a.forwardRef((e,t)=>{let{className:n,type:a,...s}=e;return(0,r.jsx)("input",{type:a,className:(0,o.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),ref:t,...s})});s.displayName="Input"},75060:function(e,t,n){"use strict";n.d(t,{_:function(){return c}});var r=n(57437),a=n(2265),o=n(370),s=n(90535),l=n(93448);let i=(0,s.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,r.jsx)(o.f,{ref:t,className:(0,l.cn)(i(),n),...a})});c.displayName=o.f.displayName},33931:function(e,t,n){"use strict";n.d(t,{I2:function(){return o},Ry:function(){return s},ol:function(){return l},qj:function(){return a},w7:function(){return i}});var r=n(44752);async function a(e){let t=new r.hJ;t.setCustomParameters({prompt:"select_account",client_id:"917199598510-14h0c930cobfvnig8kdfj5i42untd7rg.apps.googleusercontent.com"});try{console.log("\uD83D\uDD04 Iniciando sesi\xf3n con Google (popup)..."),console.log("\uD83D\uDD04 Llamando a signInWithPopup...");let n=await (0,r.rh)(e,t);return console.log("✅ signInWithPopup exitoso:",n.user.email),n}catch(e){if(console.error("❌ Error during Google sign-in popup:",e),console.error("❌ Error code:",e.code),console.error("❌ Error message:",e.message),e.code&&e.code.startsWith("auth/"))throw e;if("auth/popup-blocked"===e.code)throw Error("El popup fue bloqueado. Por favor, permite popups para este sitio e intenta de nuevo.");if("auth/popup-closed-by-user"===e.code)throw Error("El popup fue cerrado antes de completar el login. Por favor, intenta de nuevo.");throw Error(e.message||"No se pudo completar el inicio de sesi\xf3n con Google. Por favor, intenta de nuevo.")}}let o=async e=>{try{return await (0,r.XB)(e)}catch(e){throw console.error("Error signing in as guest:",e),e}},s=async(e,t,n)=>{try{return await (0,r.e5)(e,t,n)}catch(e){throw console.error("Error signing in with email:",e),e}},l=async(e,t,n)=>{try{return await (0,r.Xb)(e,t,n)}catch(e){throw console.error("Error creating user with email:",e),e}},i=async e=>{try{await (0,r.w7)(e)}catch(e){throw console.error("Error signing out:",e),e}}},89799:function(e,t,n){"use strict";n.d(t,{q:function(){return r}});let r={apiKey:"AIzaSyDnDsbb2jVLZmgpfkrpdzA6yTFRpPo2f9c",authDomain:"canvasmind-app.firebaseapp.com",projectId:"canvasmind-app",storageBucket:"canvasmind-app.firebasestorage.app",messagingSenderId:"917199598510",appId:"1:917199598510:web:73840729e1333a07804e3f"}},71077:function(e,t,n){"use strict";n.d(t,{s:function(){return r}});let r=function(){let e={};return{on(t,n){var r;e[t]||(e[t]=[]),null===(r=e[t])||void 0===r||r.push(n)},off(t,n){var r;e[t]&&(e[t]=null===(r=e[t])||void 0===r?void 0:r.filter(e=>e!==n))},emit(t,n){var r;e[t]&&(null===(r=e[t])||void 0===r||r.forEach(e=>e(n)))}}}()},63996:function(e,t,n){"use strict";n.d(t,{CU:function(){return i},aC:function(){return l},aF:function(){return d},fE:function(){return o},y$:function(){return c}}),n(57437);var r=n(2265);let a={firebaseApp:null,firestore:null,auth:null,storage:null,user:null,isUserLoading:!0,userError:null},o=(0,r.createContext)(a),s=()=>{let e=(0,r.useContext)(o);return void 0===e?(console.error("useFirebaseContext must be used within a FirebaseProvider."),a):e},l=()=>{var e,t;return null!==(t=null===(e=s())||void 0===e?void 0:e.auth)&&void 0!==t?t:null},i=()=>{var e,t;return null!==(t=null===(e=s())||void 0===e?void 0:e.firestore)&&void 0!==t?t:null},c=()=>{var e,t;return null!==(t=null===(e=s())||void 0===e?void 0:e.storage)&&void 0!==t?t:null},d=()=>{let{user:e,isUserLoading:t,userError:n}=s();return{user:e,isUserLoading:t,userError:n}}},23340:function(e,t,n){"use strict";n.d(t,{pm:function(){return p}});var r=n(2265);let a=0,o=new Map,s=e=>{if(o.has(e))return;let t=setTimeout(()=>{o.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);o.set(e,t)},l=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:n}=t;return n?s(n):e.toasts.forEach(e=>{s(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===n||void 0===n?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},i=[],c={toasts:[]};function d(e){c=l(c,e),i.forEach(e=>{e(c)})}function u(e){let{...t}=e,n=(a=(a+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>d({type:"DISMISS_TOAST",toastId:n});return d({type:"ADD_TOAST",toast:{...t,id:n,open:!0,onOpenChange:e=>{e||r()}}}),{id:n,dismiss:r,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:n}})}}function p(){let[e,t]=r.useState(c);return r.useEffect(()=>(i.push(t),()=>{let e=i.indexOf(t);e>-1&&i.splice(e,1)}),[]),{...e,toast:u,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},36692:function(e,t,n){"use strict";function r(e,t,n,r,a){if(!e||!e.isContentEditable||!t)return;let o=a||{lastInsertedText:"",lastFinalText:""},s=window.getSelection();if(!s||0===s.rangeCount)return;let l=s.getRangeAt(0);t.length<o.lastInsertedText.length&&(o.lastInsertedText="",o.lastFinalText="");let i="";if(o.lastInsertedText?t.startsWith(o.lastInsertedText)?i=t.slice(o.lastInsertedText.length):(o.lastInsertedText="",i=t):i=t,i){t.length>n.length&&t.slice(n.length);let e=r||(t.length>n.length?t.slice(n.length):"");if(n&&t===n||!e){let e=document.createTextNode(i);l.insertNode(e),l.setStartAfter(e),l.collapse(!0),s.removeAllRanges(),s.addRange(l),o.lastInsertedText=t,n&&(o.lastFinalText=n)}else{let e=document.createElement("span");e.className="dictation-interim",e.style.color="#888888",e.textContent=i,l.insertNode(e),l.setStartAfter(e),l.collapse(!0),s.removeAllRanges(),s.addRange(l),o.lastInsertedText=t}}let c=new Event("input",{bubbles:!0});e.dispatchEvent(c)}function a(e,t,n,r){if(!e||!t)return;let a=r||{lastInsertedText:"",lastFinalText:""},o=e.value,s=e.selectionStart||o.length,l=e.selectionEnd||s;t.length<a.lastInsertedText.length&&(a.lastInsertedText="",a.lastFinalText="");let i="";if(a.lastInsertedText?t.startsWith(a.lastInsertedText)?i=t.slice(a.lastInsertedText.length):(a.lastInsertedText="",i=t):i=t,i){let r=o.slice(0,s),c=o.slice(l);if(!r.endsWith(t)){e.value=r+i+c;let o=r.length+i.length;e.setSelectionRange(o,o),a.lastInsertedText=t,n&&(a.lastFinalText=n)}}let c=new Event("input",{bubbles:!0});e.dispatchEvent(c)}function o(e){e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement||e.querySelectorAll(".dictation-interim").forEach(e=>{var t;let n=e.textContent||"",r=document.createTextNode(n);r.textContent=n,null===(t=e.parentNode)||void 0===t||t.replaceChild(r,e)})}n.r(t),n.d(t,{finalizeInterimText:function(){return o},insertDictationTextToContentEditable:function(){return r},insertDictationTextToInput:function(){return a}})},93448:function(e,t,n){"use strict";n.d(t,{cn:function(){return o}});var r=n(61994),a=n(53335);function o(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,a.m6)((0,r.W)(t))}},55392:function(){}},function(e){e.O(0,[35,358,637,125,505,337,338,279,343,311,656,142,971,117,744],function(){return e(e.s=58781)}),_N_E=e.O()}]);